zero_util = sum(df$util == 0),zero_rps = sum(df$rps == 0),zero_iopsr = sum(df$iopsr == 0),
zero_wps = sum(df$wps == 0), zero_iopsw = sum(df$iopsw == 0),fn = fname[i]))
r_sta_svrid <- ddply(r_sta_day,.(svrid),function(df)data.frame(dayCount = length(unique(df$time)),count = sum(df$count,na.rm = T),
zero_util = sum(df$zero_util,na.rm = T ),zero_rps = sum(df$zero_rps,na.rm = T),zero_iopsr = sum(df$zero_iopsr,na.rm = T),
zero_wps = sum(df$zero_wps,na.rm = T), zero_iopsw = sum(df$zero_iopsw,na.rm = T),fn = fname[i]))
list(r_sta_day,r_sta_svrid)
}
fname <- list.files(dir_datatendcastClear)
which(fname == 'd1.Rda')
i = 28
fn <- fname[i]
load(file.path(dir_datatendcastClear,fn))
data <- dt_dcast
data <- factorX(subset(dt_dcast,svrid %in% levels(dt_dcast$svrid)[1:10]))
data <- dt_dcast
data$time <- as.Date(data$time)
system.time(r_sta_day <- ddply(data,.(svrid,time),function(df)data.frame(count = length(df$svrid),
zero_util = sum(df$util == 0),zero_rps = sum(df$rps == 0),zero_iopsr = sum(df$iopsr == 0),
zero_wps = sum(df$wps == 0), zero_iopsw = sum(df$iopsw == 0),fn = fname[i]))
r_sta_svrid <- ddply(r_sta_day,.(svrid),function(df)data.frame(dayCount = length(unique(df$time)),count = sum(df$count,na.rm = T),
zero_util = sum(df$zero_util,na.rm = T ),zero_rps = sum(df$zero_rps,na.rm = T),zero_iopsr = sum(df$zero_iopsr,na.rm = T),
zero_wps = sum(df$zero_wps,na.rm = T), zero_iopsw = sum(df$zero_iopsw,na.rm = T),fn = fname[i])))
system.time({
r_sta_day <- ddply(data,.(svrid,time),function(df)data.frame(count = length(df$svrid),
zero_util = sum(df$util == 0),zero_rps = sum(df$rps == 0),zero_iopsr = sum(df$iopsr == 0),
zero_wps = sum(df$wps == 0), zero_iopsw = sum(df$iopsw == 0),fn = fname[i]))
r_sta_svrid <- ddply(r_sta_day,.(svrid),function(df)data.frame(dayCount = length(unique(df$time)),count = sum(df$count,na.rm = T),
zero_util = sum(df$zero_util,na.rm = T ),zero_rps = sum(df$zero_rps,na.rm = T),zero_iopsr = sum(df$zero_iopsr,na.rm = T),
zero_wps = sum(df$zero_wps,na.rm = T), zero_iopsw = sum(df$zero_iopsw,na.rm = T),fn = fname[i]))
})
data$svrid <- fct2ori(data$svrid)
system.time({
r_sta_day <- ddply(data,.(svrid,time),function(df)data.frame(count = length(df$svrid),
zero_util = sum(df$util == 0),zero_rps = sum(df$rps == 0),zero_iopsr = sum(df$iopsr == 0),
zero_wps = sum(df$wps == 0), zero_iopsw = sum(df$iopsw == 0)))
r_sta_svrid <- ddply(r_sta_day,.(svrid),function(df)data.frame(dayCount = length(unique(df$time)),count = sum(df$count,na.rm = T),
zero_util = sum(df$zero_util,na.rm = T ),zero_rps = sum(df$zero_rps,na.rm = T),zero_iopsr = sum(df$zero_iopsr,na.rm = T),
zero_wps = sum(df$zero_wps,na.rm = T), zero_iopsw = sum(df$zero_iopsw,na.rm = T)))
r_sta_day$fn <- fn
r_sta_svrid$fn <- fn
})
source('~/Code/R/attrid/IO_statistic/sta_dcastClear.R')
source('~/Code/R/attrid/IO_statistic/sta_dcastClear.R')
date()
?date
format(Sys.time(), "%a %b %d %H:%M:%S %Y")
format(Sys.time(), "%a-%b-%d-%H-%M-%S-%Y")
format(Sys.time(), "%Y%m%d-%H%M%S")
format(Sys.time(), "%Y%m%d%H%M%S")
path_outname <- file.path(dir_c,outname)
source('~/Code/R/attrid/IO_statistic/sta_dcastClear.R')
source('~/Code/R/attrid/IO_statistic/sta_dcastClear.R')
source('~/Code/R/R_libs_user/R_custom_lib.R')
source('~/Code/R/attrid/IO_statistic/sta_dcastClear.R')
source('~/Code/R/attrid/IO_statistic/sta_dcastClear.R')
source('~/Code/R/R_libs_user/R_custom_lib.R')
source('~/Code/R/attrid/IO_statistic/sta_dcastClear.R')
source('~/Code/R/attrid/IO_statistic/sta_dcastClear.R')
rm(list = ls());source('~/rhead')
load(file.path(dir_datatendcastClear,'d54.Rda'))
a <- subset(dt_dcast,svrid == 19791)
View(a)
load(file.path(dir_datatendcastClear,'b1.Rda'))
a <- subset(dt_dcast,svrid == 1680)
View(a)
115*300/1000
summary(a)
a <- subset(dt_dcast,svrid == 1885)
summary(a)
summary(a)
View(a)
22*300/1e3
321*300/1e3
a1 <- subset(dt_dcast,util == 0)
qua <- cbind(quantileX(a1$xps),quantileX(a1$iopsr))
View(qua)
a1 <- subset(dt_dcast,util == 0 & xps > 100)
View(a1)
install.packages(futile.logger)
install.packages('futile.logger')
library(futile.logger)
?flog.info
flog.threshold(ERROR)
remove.packages('futile.logger')
remove.packages('futile.logger')
library(futile.logger)
install.packages('futile.logger')
library(futile.logger)
?futile.logger
flog.info("hello%s",3)
flog.threshold(WARN)
flog.info("hello%s",3)
flog.warn('heyhey')
flog.info("hello%s",3,name = 'a')
source('~/Code/R/attrid/Other/load_test.R')
source('~/Code/R/R_libs_user/head.R')
source('~/Code/R/attrid/Other/load_test.R')
source('~/Code/R/attrid/Other/load_test.R')
source('~/Code/R/attrid/Other/load_test.R')
?sys.frame
source('~/Code/R/attrid/Other/load_test.R')
source('~/Code/R/attrid/Other/load_test.R')
source('~/Code/R/attrid/IO_statistic/sta_level.R')
View(sta_level_rate)
splitSLR <- split(sta_level_rate,list(sta_level_rate$a1,sta_level_rate$a2))
View(sta_level_rate)
unique(sta_level_rate$a1,sta_level_rate$a2)
table(sta_level_rate$a1,sta_level_rate$a2)
dattrNa
attrName
an = 'util'
difAn <- setdiff(attrName,an)
any = 'rps'
sla <- subset(sta_level_aggre,a1 = an,a2 = any)
View(sla)
sla <- subset(sta_level_aggre,a1 == an,a2 == any)
sla <- subset(sta_level_aggre,a1 == an & a2 == any)
View(sla)
sla_melt <- melt(sla[,c('a1_value','zero','low','median','high')],id.vars = 'a1_value')
View(sla_melt)
sla_melt$a1_value <- factor(sla_melt$a1_value)
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar()
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity')
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity') +
xlab('an') + ylab('any') + scale_fill_manual(values=cbPalette)
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity') +
xlab('an') + ylab('any') + scale_fill_manual(values=colorSet)
source('~/Code/R/attrid/base_var.R')
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity') +
xlab('an') + ylab('any') + scale_fill_manual(values=cbPalette)
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity') +
xlab('an') + ylab('any') + scale_fill_manual(values=cbbPalette)
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity') +
xlab('an') + ylab('any') + scale_fill_manual(values=sample(8,cbPalette,replace = F))
sample(8,cbPalette,replace = F)
cbPalette
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity') +
xlab('an') + ylab('any') + scale_fill_manual(values=cbPalette[sample(1:8,8,F)]))
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity') +
xlab('an') + ylab('any') + scale_fill_manual(values=cbPalette[sample(1:8,8,F)])
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity') +
xlab('an') + ylab('any') + scale_fill_manual(values=cbPalette[sample(1:8,8,F)])
sample(1:8,8,F)
sample(1:8,8,F)
sample(1:8,8,F)
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity') +
xlab('an') + ylab('any') + scale_fill_manual(values=cbPalette[sample(1:8,8,F)])
p <- lapply(difAn,function(any){
sla <- subset(sta_level_aggre,a1 == an & a2 == any)
sla_melt <- melt(sla[,c('a1_value','zero','low','median','high')],id.vars = 'a1_value')
sla_melt$a1_value <- factor(sla_melt$a1_value)
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity') +
xlab('an') + ylab('any') + scale_fill_manual(values=cbPalette[sample(1:8,8,F)])
})
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity') +
xlab('an') + ylab('any') + scale_fill_manual(values=cbPalette[sample(1:8,8,F)])
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity') +
xlab('an') + ylab('any') + scale_fill_manual(values=cbPalette[sample(1:8,8,F)])
source('~/Code/R/R_libs_user/R_custom_lib.R')
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity') +
xlab('an') + ylab('any') + scale_fill_manual(values=rand_palette())
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity') +
xlab('an') + ylab('any') + scale_fill_manual(values=rand_palette())
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity') +
xlab('an') + ylab('any') + scale_fill_manual(values=rand_palette())
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity') +
xlab('an') + ylab('any') + scale_fill_manual(values=rand_palette())
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity') +
xlab('an') + ylab('any') + scale_fill_manual(values=rand_palette())
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity') +
xlab('an') + ylab('any') + scale_fill_manual(values=rand_palette())
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity') +
xlab('an') + ylab('any') + scale_fill_manual(values=rand_palette())
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity') +
xlab('an') + ylab('any') + scale_fill_manual(values=rand_palette())
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity') +
xlab(an) + ylab(any) + scale_fill_manual(values=rand_palette())
difAn <- setdiff(attrName,an)
p <- lapply(difAn,function(any){
sla <- subset(sta_level_aggre,a1 == an & a2 == any)
sla_melt <- melt(sla[,c('a1_value','zero','low','median','high')],id.vars = 'a1_value')
sla_melt$a1_value <- factor(sla_melt$a1_value)
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity') +
xlab(an) + ylab(any) + scale_fill_manual(values=rand_palette())
})
p[[1]]
p[[2]]
p[[3]]
dir_plot <- 'plot_sta_level'
dir_plot <- 'plot_sta_level'
lapply(attrName,function(an){
difAn <- setdiff(attrName,an)
p <- lapply(difAn,function(any){
sla <- subset(sta_level_aggre,a1 == an & a2 == any)
sla_melt <- melt(sla[,c('a1_value','zero','low','median','high')],id.vars = 'a1_value')
sla_melt$a1_value <- factor(sla_melt$a1_value)
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity') +
xlab(an) + ylab(any) + scale_fill_manual(values=rand_palette())
})
plot_path <- file.path(dir_data,dir_plot)
if(!dir.exists(plot_path))dir.create(plot_path)
png(filename = file.path(plot_path,paste(an,'.jpg')),width = 1920, height = 1200)
multiplot(p[[1]],p[[2]],p[[3]],p[[4]],cols = 2)
dev.off()
return(NULL)
})
x <- lapply(attrName,function(an){
difAn <- setdiff(attrName,an)
p <- lapply(difAn,function(any){
sla <- subset(sta_level_aggre,a1 == an & a2 == any)
sla_melt <- melt(sla[,c('a1_value','zero','low','median','high')],id.vars = 'a1_value')
sla_melt$a1_value <- factor(sla_melt$a1_value)
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity') +
xlab(an) + ylab(any) + scale_fill_manual(values=rand_palette())
})
plot_path <- file.path(dir_data,dir_plot)
if(!dir.exists(plot_path))dir.create(plot_path)
png(filename = file.path(plot_path,paste(an,'.jpg')),width = 800, height = 600)
multiplot(p[[1]],p[[2]],p[[3]],p[[4]],cols = 2)
dev.off()
return(p)
})
x <- lapply(attrName,function(an){
difAn <- setdiff(attrName,an)
p <- lapply(difAn,function(any){
sla <- subset(sta_level_aggre,a1 == an & a2 == any)
sla_melt <- melt(sla[,c('a1_value','zero','low','median','high')],id.vars = 'a1_value')
sla_melt$a1_value <- factor(sla_melt$a1_value)
ggplot(sla_melt,aes(x = a1_value,y = value, fill = variable)) + geom_bar(stat = 'identity') +
xlab(an) + ylab(any) + scale_fill_manual(values=rand_palette())
})
plot_path <- file.path(dir_data,dir_plot)
if(!dir.exists(plot_path))dir.create(plot_path)
png(filename = file.path(plot_path,paste(an,'.jpg',sep='')),width = 800, height = 600)
multiplot(p[[1]],p[[2]],p[[3]],p[[4]],cols = 2)
dev.off()
return(p)
})
save(sta_level,sta_level_aggre,sta_level_rate,file = file.path(dir_data,'sta_level_cut3.Rda'))
sla <- subset(sta_level_aggre,a1 == an & a2 == any)
names(sla)[names(sla) == col_level] <- cutList[[paste('cut_',any,sep='')]]
View(sla)
View(sta_level_aggre)
source('~/Code/R/attrid/IO_statistic/sta_level.R')
rm(list = ls());source('~/rhead');source('sta_zeroFunc.R')
dataframe_fill <- function(df,colname,default = 0){
missing_col <- setdiff(colname,names(df))
if(length(missing_col) == 0)return(df)
tmp <- data.frame(matrix(default,length(missing_col)*nrow(df),nrow = nrow(df)))
names(tmp) <- missing_col
df1 <- cbind(df,tmp)
return(df1[,as.character(colname)])
}
sta_level <- function(i,cutList){
fn <- fname[i]
cat(sprintf('[%s]\tfile:%s\tSATRT!!!\n',date(),fn))
load(file.path(dir_datatendcastClear,fn))
dd <- remove_line_byvalue(dt_dcast[,c('svrid','time',attrName)])
dd <- factorX(subset(dd,!(svrid %in% invalid_iopsw$svrid)))
dd$util_level <- fct2num(cut(dd$util,cutList$cut_util,cutList$cut_util[-length(cutList$cut_util)],right = F))
dd$rps_level <- fct2num(cut(dd$rps,cutList$cut_rps,cutList$cut_rps[-length(cutList$cut_rps)],right = F))
dd$iopsr_level <- fct2num(cut(dd$iopsr,cutList$cut_iopsr,cutList$cut_iopsr[-length(cutList$cut_iopsr)],right = F))
dd$wps_level <- fct2num(cut(dd$wps,cutList$cut_wps,cutList$cut_wps[-length(cutList$cut_wps)],right = F))
dd$iopsw_level <- fct2num(cut(dd$iopsw,cutList$cut_iopsw,cutList$cut_iopsw[-length(cutList$cut_iopsw)],right = F))
attr_pair <- data.frame(attr_value = rep(attrName,each = length(attrName)),attr_dist = rep(attrName,length(attrName)))
attr_pair <- subset(attr_pair, attr_value != attr_dist)
r <- mapply(function(attrv,attrd){
# cat(sprintf('%s\t%s\n',attrv,attrd))
attrv_level <- paste(attrv,'_level',sep='')
attrd_level <- paste(attrd,'_level',sep='')
corr_colname <- cutList[[paste('cut_',attrd,sep = '')]]
corr_colname <- corr_colname[-length(corr_colname)]
tmp <- dataframe_fill(as.data.frame.matrix(table(dd[[attrv_level]],dd[[attrd_level]])),
as.character(corr_colname))
names(tmp) <- col_level
data.frame(a1 = attrv,a2 = attrd,a1_value = as.numeric(row.names(tmp)),tmp)
},attr_pair$attr_value,attr_pair$attr_dist,SIMPLIFY = F)
r1 <- do.call(rbind,r);r1$fn <- fn;row.names(r1) <- NULL
cat(sprintf('[%s]\tfile:%s\tEND!!!\n',date(),fn))
r1
}
fname <- list.files(dir_datatendcastClear)
load(file.path(dir_data,'sta_dcastClear_result.Rda'))
fname <- fname[!grepl('a\\d.*',fname)]
attrName <- c('util','rps','iopsr','wps','iopsw')
cutList <- list(cut_util = sort(c(0,3,2^(0:6),95,101)),cut_rps = c(0,2^(seq(0,16,2)),1e6),cut_iopsr = c(0,2^(seq(0,16,2)),1e6),
cut_wps = c(0,2^(seq(0,16,2)),1e6),cut_iopsw = c(0,2^(seq(0,16,2)),1e6))
idx <- seq_len(length(fname))
fname[20]
i = 20
fn <- fname[i]
cat(sprintf('[%s]\tfile:%s\tSATRT!!!\n',date(),fn))
load(file.path(dir_datatendcastClear,fn))
dd <- remove_line_byvalue(dt_dcast[,c('svrid','time',attrName)])
dd <- factorX(subset(dd,!(svrid %in% invalid_iopsw$svrid)))
dd$util_level <- fct2num(cut(dd$util,cutList$cut_util,cutList$cut_util[-length(cutList$cut_util)],right = F))
dd$rps_level <- fct2num(cut(dd$rps,cutList$cut_rps,cutList$cut_rps[-length(cutList$cut_rps)],right = F))
dd$iopsr_level <- fct2num(cut(dd$iopsr,cutList$cut_iopsr,cutList$cut_iopsr[-length(cutList$cut_iopsr)],right = F))
dd$wps_level <- fct2num(cut(dd$wps,cutList$cut_wps,cutList$cut_wps[-length(cutList$cut_wps)],right = F))
dd$iopsw_level <- fct2num(cut(dd$iopsw,cutList$cut_iopsw,cutList$cut_iopsw[-length(cutList$cut_iopsw)],right = F))
attr_pair <- data.frame(attr_value = rep(attrName,each = length(attrName)),attr_dist = rep(attrName,length(attrName)))
attr_pair <- subset(attr_pair, attr_value != attr_dist)
dd1 <- dd
dd <- subset(dd,svrid %in% levels(dd$svrid)[1:10])
r <- mapply(function(attrv,attrd){
# cat(sprintf('%s\t%s\n',attrv,attrd))
attrv_level <- paste(attrv,'_level',sep='')
attrd_level <- paste(attrd,'_level',sep='')
corr_colname <- cutList[[paste('cut_',attrd,sep = '')]]
corr_colname <- corr_colname[-length(corr_colname)]
tmp <- dataframe_fill(as.data.frame.matrix(table(dd[[attrv_level]],dd[[attrd_level]])),
as.character(corr_colname))
names(tmp) <- col_level
data.frame(a1 = attrv,a2 = attrd,a1_value = as.numeric(row.names(tmp)),tmp)
},attr_pair$attr_value,attr_pair$attr_dist,SIMPLIFY = F)
col_level <- c(paste('X',0:9,sep=''))
r <- mapply(function(attrv,attrd){
# cat(sprintf('%s\t%s\n',attrv,attrd))
attrv_level <- paste(attrv,'_level',sep='')
attrd_level <- paste(attrd,'_level',sep='')
corr_colname <- cutList[[paste('cut_',attrd,sep = '')]]
corr_colname <- corr_colname[-length(corr_colname)]
tmp <- dataframe_fill(as.data.frame.matrix(table(dd[[attrv_level]],dd[[attrd_level]])),
as.character(corr_colname))
names(tmp) <- col_level
data.frame(a1 = attrv,a2 = attrd,a1_value = as.numeric(row.names(tmp)),tmp)
},attr_pair$attr_value,attr_pair$attr_dist,SIMPLIFY = F)
r1 <- do.call(rbind,r);r1$fn <- fn;row.names(r1) <- NULL
View(r1)
source('~/Code/R/attrid/IO_statistic/sta_level.R')
source('~/Code/R/attrid/IO_statistic/sta_level.R')
rm(list = ls());source('~/rhead');source('sta_zeroFunc.R')
dataframe_fill <- function(df,colname,default = 0){
missing_col <- setdiff(colname,names(df))
if(length(missing_col) == 0)return(df)
tmp <- data.frame(matrix(default,length(missing_col)*nrow(df),nrow = nrow(df)))
names(tmp) <- missing_col
df1 <- cbind(df,tmp)
return(df1[,as.character(colname)])
}
sta_level <- function(i,cutList){
fn <- fname[i]
cat(sprintf('[%s]\tfile:%s\tSATRT!!!\n',date(),fn))
load(file.path(dir_datatendcastClear,fn))
dd <- remove_line_byvalue(dt_dcast[,c('svrid','time',attrName)])
dd <- factorX(subset(dd,!(svrid %in% invalid_iopsw$svrid)))
dd$util_level <- fct2num(cut(dd$util,cutList$cut_util,cutList$cut_util[-length(cutList$cut_util)],right = F))
dd$rps_level <- fct2num(cut(dd$rps,cutList$cut_rps,cutList$cut_rps[-length(cutList$cut_rps)],right = F))
dd$iopsr_level <- fct2num(cut(dd$iopsr,cutList$cut_iopsr,cutList$cut_iopsr[-length(cutList$cut_iopsr)],right = F))
dd$wps_level <- fct2num(cut(dd$wps,cutList$cut_wps,cutList$cut_wps[-length(cutList$cut_wps)],right = F))
dd$iopsw_level <- fct2num(cut(dd$iopsw,cutList$cut_iopsw,cutList$cut_iopsw[-length(cutList$cut_iopsw)],right = F))
attr_pair <- data.frame(attr_value = rep(attrName,each = length(attrName)),attr_dist = rep(attrName,length(attrName)))
attr_pair <- subset(attr_pair, attr_value != attr_dist)
r <- mapply(function(attrv,attrd){
# cat(sprintf('%s\t%s\n',attrv,attrd))
attrv_level <- paste(attrv,'_level',sep='')
attrd_level <- paste(attrd,'_level',sep='')
corr_colname <- cutList[[paste('cut_',attrd,sep = '')]]
corr_colname <- corr_colname[-length(corr_colname)]
tmp <- dataframe_fill(as.data.frame.matrix(table(dd[[attrv_level]],dd[[attrd_level]])),
as.character(corr_colname))
names(tmp) <- col_level
data.frame(a1 = attrv,a2 = attrd,a1_value = as.numeric(row.names(tmp)),tmp)
},attr_pair$attr_value,attr_pair$attr_dist,SIMPLIFY = F)
r1 <- do.call(rbind,r);r1$fn <- fn;row.names(r1) <- NULL
cat(sprintf('[%s]\tfile:%s\tEND!!!\n',date(),fn))
r1
}
fname <- list.files(dir_datatendcastClear)
load(file.path(dir_data,'sta_dcastClear_result.Rda'))
fname <- fname[!grepl('a\\d.*',fname)]
attrName <- c('util','rps','iopsr','wps','iopsw')
cutList <- list(cut_util = sort(c(0,3,2^(0:6),95,101)),cut_rps = c(0,2^(seq(0,16,2)),1e6),cut_iopsr = c(0,2^(seq(0,16,2)),1e6),
cut_wps = c(0,2^(seq(0,16,2)),1e6),cut_iopsw = c(0,2^(seq(0,16,2)),1e6))
col_level <- c(paste('X',0:(length(cutList$cut_util)-1),sep=''))
idx <- seq_len(length(fname))
i = 20
fn <- fname[i]
cat(sprintf('[%s]\tfile:%s\tSATRT!!!\n',date(),fn))
load(file.path(dir_datatendcastClear,fn))
dd <- remove_line_byvalue(dt_dcast[,c('svrid','time',attrName)])
dd <- factorX(subset(dd,!(svrid %in% invalid_iopsw$svrid)))
dd <- subset(dd,svrid %in% levels(dd$svrid)[1:10])
dd <- factorX(subset(dd,svrid %in% levels(dd$svrid)[1:10]))
dd$util_level <- fct2num(cut(dd$util,cutList$cut_util,cutList$cut_util[-length(cutList$cut_util)],right = F))
dd$rps_level <- fct2num(cut(dd$rps,cutList$cut_rps,cutList$cut_rps[-length(cutList$cut_rps)],right = F))
dd$iopsr_level <- fct2num(cut(dd$iopsr,cutList$cut_iopsr,cutList$cut_iopsr[-length(cutList$cut_iopsr)],right = F))
dd$wps_level <- fct2num(cut(dd$wps,cutList$cut_wps,cutList$cut_wps[-length(cutList$cut_wps)],right = F))
dd$iopsw_level <- fct2num(cut(dd$iopsw,cutList$cut_iopsw,cutList$cut_iopsw[-length(cutList$cut_iopsw)],right = F))
attr_pair <- data.frame(attr_value = rep(attrName,each = length(attrName)),attr_dist = rep(attrName,length(attrName)))
attr_pair <- subset(attr_pair, attr_value != attr_dist)
r <- mapply(function(attrv,attrd){
# cat(sprintf('%s\t%s\n',attrv,attrd))
attrv_level <- paste(attrv,'_level',sep='')
attrd_level <- paste(attrd,'_level',sep='')
corr_colname <- cutList[[paste('cut_',attrd,sep = '')]]
corr_colname <- corr_colname[-length(corr_colname)]
tmp <- dataframe_fill(as.data.frame.matrix(table(dd[[attrv_level]],dd[[attrd_level]])),
as.character(corr_colname))
names(tmp) <- col_level
data.frame(a1 = attrv,a2 = attrd,a1_value = as.numeric(row.names(tmp)),tmp)
},attr_pair$attr_value,attr_pair$attr_dist,SIMPLIFY = F)
col_level
length(cutList$cut_util)-1)
length(cutList$cut_util)-1
length(cutList$cut_util)
col_level <- c(paste('X',0:(length(cutList$cut_util)-2),sep=''))
r <- mapply(function(attrv,attrd){
# cat(sprintf('%s\t%s\n',attrv,attrd))
attrv_level <- paste(attrv,'_level',sep='')
attrd_level <- paste(attrd,'_level',sep='')
corr_colname <- cutList[[paste('cut_',attrd,sep = '')]]
corr_colname <- corr_colname[-length(corr_colname)]
tmp <- dataframe_fill(as.data.frame.matrix(table(dd[[attrv_level]],dd[[attrd_level]])),
as.character(corr_colname))
names(tmp) <- col_level
data.frame(a1 = attrv,a2 = attrd,a1_value = as.numeric(row.names(tmp)),tmp)
},attr_pair$attr_value,attr_pair$attr_dist,SIMPLIFY = F)
r1 <- do.call(rbind,r);r1$fn <- fn;row.names(r1) <- NULL
View(r1)
source('~/Code/R/attrid/IO_statistic/sta_level.R')
load(file.path(dir_data,'sc_wps_idle.Rda'))
wps_idle <- factorX(wps_idle[,c('svrid','count','bts_wtn','maxN','frac_idle','fn','fclass')])
fname <- list.files(dir_datatendcastClear)
fname <- fname[!grepl('a\\d.*',fname)]
attrName <- c('util','rps','iopsr','wps','iopsw')
idx <- seq_len(length(fname))
rm(list = ls());source('~/rhead')
load(file.path(dir_data,'sc_wps_idle.Rda'))
wps_idle <- factorX(wps_idle[,c('svrid','count','bts_wtn','maxN','frac_idle','fn','fclass')])
fname <- list.files(dir_datatendcastClear)
fname <- fname[!grepl('a\\d.*',fname)]
attrName <- c('util','rps','iopsr','wps','iopsw')
idx <- seq_len(length(fname))
fn <- 'd1.Rda'
cat(sprintf('[%s]\tfile:%s\tSATRT!!!\n',date(),fn))
load(file.path(dir_datatendcastClear,fn))
dd <- filter_badiops_NA(dt_dcast,attrName)
dd$time <- as.Date(dd$time)
dd <- factorX(subset(dd,svrid %in% wps_idle$svrid & wps >= 16 & wps < 64))
dd <- factorX(subset(dd,svrid %in% levels(dd$svrid)[1:10]))
dd <- factorX(subset(dd,svrid %in% levels(dd$svrid)[1:5]))
r <- aggregate(dd[,attrName],by = list(dd$svrid,dd$time),summary)
View(r)
class(r)
r1 <- r$util
View(r1)
r <- cbind(r[,c(1,2)],r$util,r$rps,r$iopsr,r$wps,r$iopsw)
r <- cbind(r[,c(1,2)],r$util,r$rps,r$iopsr,r$wps,r$iopsw)
sumName <- c('min','Q1','Q2','mean','Q3','max')
names(r) <- c('svrid','time',paste(rep(attrName,each = length(sumName)),rep(sumName,length(attrName)),paste = '_'))
names(r) <- c('svrid','time',paste(rep(attrName,each = length(sumName)),rep(sumName,length(attrName)),sep = '_'))
View(r)
r1 <- aggregate(dd[,'util']),by = list(dd$svrid,dd$time,length)
r1 <- aggregate(dd[,'util'],by = list(dd$svrid,dd$time,length)
}
###### MAIN ######
load(file.path(dir_data,'sc_wps_idle.Rda'))
wps_idle <- factorX(wps_idle[,c('svrid','count','bts_wtn','maxN','frac_idle','fn','fclass')])
fname <- list.files(dir_datatendcastClear)
fname <- fname[!grepl('a\\d.*',fname)]
attrName <- c('util','rps','iopsr','wps','iopsw')
idx <- seq_len(length(fname))
r <- foreachX(idx,'sta_idlewps')
r1 <- aggregate(dd[,'util'],by = list(dd$svrid,dd$time,length))
r1 <- aggregate(dd[,'util'],by = list(dd$svrid,dd$time),length)
r1 <- aggregate(dd[,attrName],by = list(dd$svrid,dd$time),function(x)summary(x)[1:6])
r2 <- aggregate(dd[,'util'],by = list(dd$svrid,dd$time),length)
r <- cbind(r2[,c(1,3)],r1$util,r1$rps,r1$iopsr,r1$wps,r1$iopsw)
sumName <- c('min','Q1','Q2','mean','Q3','max')
names(r) <- c('svrid','time','count',paste(rep(attrName,each = length(sumName)),rep(sumName,length(attrName)),sep = '_'))
r <- cbind(r2[,c(1:3)],r1$util,r1$rps,r1$iopsr,r1$wps,r1$iopsw)
sumName <- c('min','Q1','Q2','mean','Q3','max')
names(r) <- c('svrid','time','count',paste(rep(attrName,each = length(sumName)),rep(sumName,length(attrName)),sep = '_'))
sta_idlewps <- r
sta_wps <- sta_idlewps[,grepl(c('svrid','time','count','wps','iopsw'))]
sta_wps <- sta_idlewps[,grepl(c('svrid','time','count','wps','iopsw'),names(sta_idlewps))]
sta_wps <- sta_idlewps[,grepl(c('svrid|time|count|wps|iopsw'),names(sta_idlewps))]
View(sta_wps)
ggplot(sta_wps,aes(x = svrid,y = count)) + geom_boxplot()
a <- tapply(sta_wps$count,sta_wps$svrid,summary)
a
a1 <- list2df(a)
View(a1)
a1 <- list2df(a,n = names(a)[[1]])
a1 <- list2df(a,n = names(a[[1]]))
dd <- filter_badiops_NA(dt_dcast,attrName)
dd$time <- as.Date(dd$time)
dd <- factorX(subset(dd,svrid %in% wps_idle$svrid & wps >= 16 & wps < 64))
r1 <- aggregate(dd[,attrName],by = list(dd$svrid,dd$time),function(x)summary(x)[1:6])
r2 <- aggregate(dd[,'util'],by = list(dd$svrid,dd$time),length)
r <- cbind(r2[,c(1:3)],r1$util,r1$rps,r1$iopsr,r1$wps,r1$iopsw)
sumName <- c('min','Q1','Q2','mean','Q3','max')
names(r) <- c('svrid','time','count',paste(rep(attrName,each = length(sumName)),rep(sumName,length(attrName)),sep = '_'))
table(wps_idle$maxN)
source('~/Code/R/attrid/sta_idlewps.R')
sta_wps <- sta_idlewps[,grepl(c('svrid|time|count|wps|iopsw'),names(sta_idlewps))]
ggplot(subset(smp_df(sta_wps,1e5),iopsw_mean < 2000),aes(x = iopsw_mean,y = wps_mean)) + geom_point(alpha = 0.01)
ggplot(subset(smp_df(sta_wps,1e5),iopsw_mean < 2000 & wps_mean > 16 & wps_mean < 64),aes(x = iopsw_mean,y = wps_mean)) + geom_point(alpha = 0.01)
ggplot(subset(smp_df(sta_wps,1e5),iopsw_mean < 2000 & wps_mean > 16 & wps_mean < 64),aes(x = wps_mean,y = iopsw_mean)) + geom_point(alpha = 0.01)
min(sta_wps$wps_min)
min(sta_wps$wps_max)
View(sta_wps)
max(sta_wps$wps_max)
summary(sta_wps$count)
ggplot(sta_wps,aes(count)) + geom_histogram(binwidth = 1)
a <- melt(table(sta_wps$count))
View(a)
a$rate <- array_rate(a$value)
sum(a$rate[a$Var1 > 280])
ggplot(a,aes(Var1,rate)) + geom_bar(stat = 'identity') + xlim(c(250,300))
ggplot(a,aes(Var1,rate)) + geom_bar(stat = 'identity') + xlim(c(250,288))
