ss_wps$fclass <- gsub('\\d.*','',ss_wps$fn)
ss_wps$max <- factor(ss_wps$max)
frac_max <- tapply(ss_wps$max,ss_wps$fclass,table)
frac_max <- do.call(rbind,tapply(ss_wps$max,ss_wps$fclass,table))
View(frac_max)
frac_max <- melt(tapply(ss_wps$max,ss_wps$fclass,table))
View(frac_max)
frac_max <- melt(do.call(rbind,tapply(ss_wps$max,ss_wps$fclass,table)))
View(frac_max)
frac_max <- melt(do.call(rbind,tapply(ss_wps$max,ss_wps$fclass,function(x)array_rate(table(x)))))
View(frac_max)
ggplot(frac_max,aes(x = Var2,y = value,fill = Var1)) + geom_bar(stat = 'identity')
frac_max <- melt(do.call(rbind,tapply(ss_wps$fclass,ss_wps$max,function(x)array_rate(table(x)))))
ggplot(frac_max,aes(x = Var1,y = value,fill = Var2)) + geom_bar(stat = 'identity')
frac_max <- do.call(rbind,tapply(ss_wps$max,ss_wps$fclass,function(x)array_rate(table(x))))
View(frac_max)
rowSums(frac_max)
frac_max <- melt(frac_max)
View(frac_max)
ggplot(frac_max,aes(x = Var1,y = value,fill = Var2)) + geom_bar(stat = 'identity')
ss_wps <- lapplyX(lapply(r,'[[',2),'[[',4)
col_value <- names(ss_wps)[grepl('X\\d+',names(ss_wps))]
ss_wps$count <- apply(ss_wps[,col_value],1,sum)
ss_wps$max <- apply(ss_wps[,col_value],1,function(x)names(ss_wps[,col_value])[which.max(x)])
table_wps <- melt(table(ss_wps$max))
ss_wps$bts_wtn <- as.numeric((as.matrix(ss_wps[,col_value]) %*% cutList$cut_wps[-length(cutList$cut_wps)])*300/1e6)
ss_wps$fn <- factor(r_sta_svrid$fn[match(ss_wps$svrid,r_sta_svrid$svrid)])
ss_wps$fclass <- gsub('\\d.*','',ss_wps$fn)
ss_wps$maxN <- as.numeric(gsub('X','',ss_wps$max))
frac_max <- do.call(rbind,tapply(ss_wps$maxN,ss_wps$fclass,function(x)array_rate(table(x))))
frac_max <- tapply(ss_wps$maxN,ss_wps$fclass,function(x)array_rate(table(x)))
ss_wps$max <- factor(ss_wps$max)
frac_max <- do.call(rbind,tapply(ss_wps$max,ss_wps$fclass,function(x)array_rate(table(x))))
frac_max <- melt(frac_max)
frac_max <- melt(frac_max);frac_max$cut_value <- as.numeric(gsub('X','',frac_max$Var2))
frac_max <- do.call(rbind,tapply(ss_wps$max,ss_wps$fclass,function(x)array_rate(table(x))))
frac_max <- melt(frac_max);frac_max$cut_value <- as.numeric(gsub('X','',frac_max$Var2))
ggplot(frac_max,aes(x = Var1,y = value,fill = factor(cut_value))) + geom_bar(stat = 'identity')
ggplot(frac_max,aes(x = Var1,y = value,fill = factor(cut_value))) + geom_bar(stat = 'identity') + scale_color_manual(sepctrum)
ggplot(frac_max,aes(x = Var1,y = value,fill = factor(cut_value))) + geom_bar(stat = 'identity') + scale_fill_brewer(palette="Spectral")
ss_wps_rate <- ss_wps
ss_wps_rate[,col_value] <- roundX(ss_wps_rate[,col_value]/ss_wps_rate$count)
sub_idle <- subset(ss_wps_rate,max %in% c('X16','X32'))
sub_idle$frac_idle <- sub_idle$X16 + sub_idle$X32
summary(sub_idle$X16 + sub_idle$X32)
nrow(sub_idle)/nrow(ss_wps)
ss_rps_idlewps <- factorX(subset(ss_rps,svrid %in% sub_idle$svrid[sub_idle$frac_idle > median(sub_idle$frac_idle)]))
View(ss_rps_idlewps)
col_value <- names(ss_rps)[grepl('X\\d+',names(ss_rps))]
ss_rps_idlewps <- factorX(subset(ss_rps,svrid %in% sub_idle$svrid[sub_idle$frac_idle > median(sub_idle$frac_idle)]))
sri_rate <- ss_rps_idlewps
sri_rate$count <- apply(sri[,col_value],1,sum)
sri_rate <- ss_rps_idlewps
sri_rate$count <- apply(sri_rate[,col_value],1,sum)
sri_rate[,col_value] <- roundX(sri_rate[,col_value/sri_rate$count])
sri_rate[,col_value] <- roundX(sri_rate[,col_value]/sri_rate$count)
View(sri_rate)
sri_rate <- ss_rps_idlewps
sri_rate$count <- apply(sri_rate[,col_value],1,sum)
sri_rate[,col_value] <- roundX(sri_rate[,col_value]/sri_rate$count)
sri_rate$max <- apply(sri_rate[,col_value],1,function(x)names(sri_rate[,col_value])[which.max(x)])
table_rps <- melt(table(sri_rate$max))
View(table_rps)
2043/2474
View(ss_wps)
View(sub_idle)
wps_idle <- sub_idle
save(wps_idle, file.path(dir_data,'sc_wps_idle.Rda'))
save(wps_idle, file = file.path(dir_data,'sc_wps_idle.Rda'))
wps_idle <- factorX(sub_idle)
save(wps_idle, file = file.path(dir_data,'sc_wps_idle.Rda'))
sub_idle <- subset(ss_wps_rate,max %in% c('X8','X16','X32','X64'))
rm(list = ls());source('~/rhead')
status_last <- function(arr){
arr_diff <- c(0,diff(fct2num(arr)))
idx_start <- c(1,which(arr_diff != 0))
group_len <- c(diff(idx_start),length(arr) - idx_start[length(idx_start)] + 1)
group_ele <- arr[idx_start]
recover <- do.call(c,mapply(function(x,y)rep(x,y),fct2num(group_ele),group_len))
if(all.equal(fct2num(arr),recover)){
return(data.frame(ele = group_ele,len = group_len))
}else{
return(data.frame(ele = -1,len = -1))
}
}
trim_status_last <- function(df){
stat_last <- tapply(df$len,df$ele,summary)
stat_last <- lapplyX(stat_last,function(x){
if(!is.null(x))return(x)
return(summary(-1))
})
stat_last <- data.frame(stat_last[,1:6])
names(stat_last) <- c('min','Q1','Q2','mean','Q3','max')
row.names(stat_last) <- c('low','median','high')
stat_last$level <- row.names(stat_last)
as.numeric(unlist(c(stat_last[stat_last$level == 'low',1:6],stat_last[stat_last$level == 'median',1:6],stat_last[stat_last$level == 'high',1:6])))
}
slx_svrid <- function(df,attrid){
cname_level <- paste(attrid, '_level',sep = '')
count_level <- melt(table(df[[cname_level]]))
ssl <- status_last(df[[cname_level]])
count_change <- nrow(ssl)
stat_last <- trim_status_last(ssl)
data.frame(df$svrid[1],attrid,t(c(nrow(df),as.numeric(count_level$value),count_change,t(stat_last))))
}
sta_status_last <- function(i){
fn <- fname[i]
cat(sprintf('[%s]\tfile:%s\tSATRT!!!\n',date(),fn))
load(file.path(dir_datatendcastClear,fn))
dd <- filter_badiops_NA(dt_dcast,attrName)
# dd <- subsetX(dd,svrid %in% levels(dd$svrid)[1:10])
dd$rps_level <- cut(dd$rps,levelList$cut_rps,levelList$cut_rps[-length(levelList$cut_rps)],right = F)
dd$wps_level <- cut(dd$wps,levelList$cut_wps,levelList$cut_wps[-length(levelList$cut_wps)],right = F)
splitDD <- split(dd,dd$svrid)
level_name <- c('low','median','high')
summary_name <- c('min','Q1','Q2','mean','Q3','max')
col_name <- c('svrid','attrid','count',paste('count',level_name,sep='_'),'count_change',
paste(rep(level_name,each = length(summary_name)),rep(summary_name,length(level_name)),sep = '_'))
status_last_rps <- lapplyX(splitDD,slx_svrid,'rps')
names(status_last_rps) <- col_name
status_last_wps <- lapplyX(splitDD,slx_svrid,'wps')
names(status_last_wps) <- col_name
cat(sprintf('[%s]\tfile:%s\tEND!!!\n',date(),fn))
list(status_last_rps,status_last_wps)
}
load(file.path(dir_data,'sta_dcastClear.Rda'))
fname <- list.files(dir_datatendcastClear)
attrName <- c('util','rps','iopsr','wps','iopsw')
levelList <- list(cut_rps = c(0,1,1024,1e6),cut_wps = c(0,64,4096,1e6))
idx <- seq_len(length(fname))
i = 20
fn <- fname[i]
cat(sprintf('[%s]\tfile:%s\tSATRT!!!\n',date(),fn))
load(file.path(dir_datatendcastClear,fn))
dd <- filter_badiops_NA(dt_dcast,attrName)
1
dd <- subsetX(dd,svrid %in% levels(dd$svrid)[1:50])
dd$rps_level <- cut(dd$rps,levelList$cut_rps,levelList$cut_rps[-length(levelList$cut_rps)],right = F)
dd$wps_level <- cut(dd$wps,levelList$cut_wps,levelList$cut_wps[-length(levelList$cut_wps)],right = F)
splitDD <- split(dd,dd$svrid)
level_name <- c('low','median','high')
summary_name <- c('min','Q1','Q2','mean','Q3','max')
col_name <- c('svrid','attrid','count',paste('count',level_name,sep='_'),'count_change',
paste(rep(level_name,each = length(summary_name)),rep(summary_name,length(level_name)),sep = '_'))
status_last_rps <- lapplyX(splitDD,slx_svrid,'rps')
names(status_last_rps) <- col_name
status_last_wps <- lapplyX(splitDD,slx_svrid,'wps')
names(status_last_wps) <- col_name
cat(sprintf('[%s]\tfile:%s\tEND!!!\n',date(),fn))
View(status_last_wps)
source('~/Code/R/attrid/sta_status_last.R')
slw <- subsetX(status_last_wps,count > 8e4)
slw$cl_round <- roundX(slw$count_low/slw$count)
slw$cm_round <- roundX(slw$count_median/slw$count)
ggplot(slw,aes(x = factor(round(cl_round,digits = 1)),y = cm_round)) + geom_boxplot(outlier.shape = NA) + geom_jitter(alpha = 0.05,width = 0.2)
ggplot(slw,aes(cl_round,cm_round)) + geom_point(alpha = 0.1)
View(status_last_rps)
ggplot(slw,aes(count_change)) + geom_histogram(binwidth = 10)
ggplot(slw,aes(count_change)) + geom_histogram(binwidth = 10) + xlim(c(0,25000))
ggplot(slw,aes(count_change)) + geom_histogram(binwidth = 50) + xlim(c(0,25000))
ggplot(slw,aes(count_change)) + geom_histogram(binwidth = 100) + xlim(c(0,25000))
ggplot(slw,aes(log2(count_change))) + geom_histogram(binwidth = 100) + xlim(c(0,25000))
ggplot(slw,aes(log2(count_change))) + geom_histogram(binwidth = 100)
ggplot(slw,aes(count_change)) + geom_histogram(binwidth = 100) + xlim(c(0,25000))
ggplot(slw,aes(count_change)) + geom_histogram(binwidth = 500) + xlim(c(0,25000))
ggplot(slw,aes(count_change)) + geom_histogram(binwidth = 100) + xlim(c(0,25000))
ggplot(slw[slw$count_change > 0],aes(count_change)) + geom_histogram(binwidth = 100) + xlim(c(0,25000))
ggplot(slw[slw$count_change > 0,],aes(count_change)) + geom_histogram(binwidth = 100) + xlim(c(0,25000))
a <- melt(table(slw$count_change[slw$count_change < 100]))
View(a)
a <- melt(table(slw$count_change[slw$count_change < 1000]))
rm(list = ls());source('~/rhead')
load(file.path(dir_data,'sta_cut.Rda'))
load(file.path(dir_data,'sta_dcastClear.Rda'))
###### ANALYSIS ######
ss_util <- lapplyX(lapply(r,'[[',2),'[[',1)
ss_rps <- lapplyX(lapply(r,'[[',2),'[[',2)
ss_iopsr <- lapplyX(lapply(r,'[[',2),'[[',3)
ss_wps <- lapplyX(lapply(r,'[[',2),'[[',4)
ss_iopsw <- lapplyX(lapply(r,'[[',2),'[[',5)
View(ss_wps)
col_value <- names(ss_wps)[grepl('X\\d+',names(ss_wps))]
ss_wps$count <- apply(ss_wps[,col_value],1,sum)
ss_wps$max <- apply(ss_wps[,col_value],1,function(x)names(ss_wps[,col_value])[which.max(x)])
table_wps <- melt(table(ss_wps$max))
ss_wps$bts_wtn <- as.numeric((as.matrix(ss_wps[,col_value]) %*% cutList$cut_wps[-length(cutList$cut_wps)])*300/1e6)
ss_wps$fn <- factor(r_sta_svrid$fn[match(ss_wps$svrid,r_sta_svrid$svrid)])
ss_wps$fclass <- gsub('\\d.*','',ss_wps$fn)
ss_wps$max <- factor(ss_wps$max)
ss_wps_rate <- ss_wps
ss_wps_rate[,col_value] <- roundX(ss_wps_rate[,col_value]/ss_wps_rate$count)
wps_busy <- subset(ss_wps_rate,!(max %in% c('X16','X32')))
wps_idle <- subset(ss_wps_rate,max %in% c('X16','X32'))
wps_idle$frac_idle <- wps_idle$X16 + wps_idle$X32
summary(wps_idle$X16 + wps_idle$X32)
with(wps_idle,summary(X32 + X16 + X4 + X8 + X64 + X128))
wps_idle <- subsetX(wps_idle, frac_idle >= median(frac_idle))
wps_working <- subsetX(wps_idle, frac_idle < median(frac_idle))
idle_range <- c(8*86400*365/1e6,64*86400*365/1e6)
View(wps_idle)
summary(wps_idle)
load(file.path(dir_data,'sca_wps.Rda'))
rps_idlewps <- subset(ss_rps,svrid %in% wps_idle$svrid)
View(rps_idlewps)
rps_idlewps$count <- apply(rps_idlewps[-1],1,sum)
col_value <- names(rps_idlewps)[grepl('X\\d+',names(rps_idlewps))]
rps_idlewps[,col_value] <- rps_idlewps[,col_value]/rps_idlewps$count
load(file.path(dir_data,'sca_wps.Rda'))
rps_idlewps <- subset(ss_rps,svrid %in% wps_idle$svrid)
rps_idlewps$count <- apply(rps_idlewps[-1],1,sum)
col_value <- names(rps_idlewps)[grepl('X\\d+',names(rps_idlewps))]
rps_idlewps[,col_value] <- roundX(rps_idlewps[,col_value]/rps_idlewps$count)
ggplot(rps_idlewps,aes(X0)) + stat_ecdf()
ggplot(rps_idlewps,aes(X0)) + geom_histogram(binwidth = 0.01)
ggplot(rps_idlewps,aes(X0)) + stat_ecdf()
quantileX(rps_idlewps$X0)
diff(quantileX(rps_idlewps$X0))
a <- as.data.frame(diff(quantileX(rps_idlewps$X0)))
View(a)
a <- as.data.frame.matrix(diff(quantileX(rps_idlewps$X0)))
a <- melt(diff(quantileX(rps_idlewps$X0)))
View(a)
a$frac <- row.names(a)
ggplot(a,aes(frac,value)) + geom_line()
ggplot(a,aes(frac,value,group = 1)) + geom_line()
View(a)
View(rps_idlewps)
table_rps0 <- melt(table(round(rps_idlewps$X0,digits = 2)))
View(table_rps0)
ggplot(table_rps0,aes(Var1,value)) + geom_bar(stat = 'identity')
table_rps0 <- melt(table(round(rps_idlewps$X0,digits = 1)))
ggplot(table_rps0,aes(Var1,value)) + geom_bar(stat = 'identity')
summary(rps_idlewps$X0)
summary(rps_idlewps$X0+rps_idlewps$X1)
rps_idlewps <- subset(ss_rps,svrid %in% wps_working$svrid)
rps_idlewps$count <- apply(rps_idlewps[-1],1,sum)
col_value <- names(rps_idlewps)[grepl('X\\d+',names(rps_idlewps))]
rps_idlewps[,col_value] <- roundX(rps_idlewps[,col_value]/rps_idlewps$count)
ggplot(rps_idlewps,aes(X0)) + stat_ecdf()
summary(rps_idlewps$X0+rps_idlewps$X1)
rps_idlewps <- subset(ss_rps,svrid %in% wps_busy$svrid)
rps_idlewps$count <- apply(rps_idlewps[-1],1,sum)
col_value <- names(rps_idlewps)[grepl('X\\d+',names(rps_idlewps))]
rps_idlewps[,col_value] <- roundX(rps_idlewps[,col_value]/rps_idlewps$count)
ggplot(rps_idlewps,aes(X0)) + stat_ecdf()
summary(rps_idlewps$X0+rps_idlewps$X1)
rate_data <- function(df){
col_value <- names(df)[grepl('X\\d+',names(df))]
df$count <- apply(df[,col_value],1,sum)
df[,col_value] <- roundX(df[,col_value]/df$count)
df
}
rps_idlewps <- subset(ss_rps,svrid %in% wps_busy$svrid)
rps_idlewps <- rate_data(rps_idlewps)
ggplot(rps_idlewps,aes(X0)) + stat_ecdf()
summary(rps_idlewps$X0+rps_idlewps$X1)
table_rps0 <- melt(table(round(rps_idlewps$X0,digits = 1)))
ggplot(table_rps0,aes(Var1,value)) + geom_bar(stat = 'identity')
source('~/Code/R/attrid/base_func.R')
col_idle <- c('svrid','X0')
ss_xps_idle <- merge(rate_data(ss_wps)[,col_idle],rate_data(ss_rps[,col_idle]),by = 'svrid')
rate_data(ss_wps)
a <- rate_data(ss_wps)
ss_xps_idle <- merge(rate_data(ss_wps)[,col_idle],rate_data(ss_rps)[,col_idle],by = 'svrid')
View(ss_xps_idle)
names(ss_xps_idle) <- c('svrid','X0_wps','X0_rps')
ggplot(ss_xps_idle,aes(X0_rps,X0_wps)) + geom_raster()
ggplot(ss_xps_idle,aes(X0_rps,X0_wps)) + geom_raster(stat = 'count')
ggplot(ss_xps_idle,aes(x = X0_rps,y = X0_wps)) + geom_raster(stat = 'count')
table_sxi <- melt_table(round(ss_xps_idle$X0_rps,digits = 2),round(ss_xps_idle$X0_wps,digits = 2))
View(table_wps)
View(table_sxi)
ggplot(table_sxi,aes(x = Var1,y = Var2,fill = value)) + geom_raster()
View(table_sxi)
round(ss_xps_idle$X0_wps,digits = 2)
View(ss_xps_idle)
table(round(ss_xps_idle$X0_wps,digits = 2))
ss_xps_idle$X0_wps
sw_idle <- rate_data(ss_wps)[,c('svrid','X16','X32')];sw_idle$idlew <- sw_idle$X16 + sw_idle$X32
sr_idle <- rate_data(ss_rps)[,c('svrid','X0')];sr_idle$idler <- sr_idle$X0
ss_xps_idle <- merge(sw_idle[,c('svrid','idlew')],sw_idle[,c('svrid','idler')],by = 'svrid')
ss_xps_idle <- merge(sw_idle[,c('svrid','idlew')],sr_idle[,c('svrid','idler')],by = 'svrid')
names(ss_xps_idle) <- c('svrid','idle_wps','idle_rps')
table_sxi <- melt_table(round(ss_xps_idle$idle_rps,digits = 2),round(ss_xps_idle$idle_wps,digits = 2))
View(table_sxi)
ggplot(table_sxi,aes(x = Var1,y = Var2,fill = value)) + geom_raster()
table_sxi <- melt(table(round(ss_xps_idle$idle_rps,digits = 2),round(ss_xps_idle$idle_wps,digits = 2)))
ggplot(table_sxi,aes(x = Var1,y = Var2,fill = value)) + geom_raster()
ggplot(table_sxi,aes(x = Var1,y = Var2,fill = log2(value))) + geom_raster()
table_sxi$value[table_sxi$value == 0] <- 0.5
ggplot(table_sxi,aes(x = Var1,y = Var2,fill = log2(value))) + geom_raster()
ggplot(table_sxi,aes(x = Var1,y = Var2,fill = log10(value))) + geom_raster()
table_sxi <- melt(table(round(ss_xps_idle$idle_rps,digits = 1),round(ss_xps_idle$idle_wps,digits = 1)))
table_sxi$value[table_sxi$value == 0] <- 0.5
ggplot(table_sxi,aes(x = Var1,y = Var2,fill = log10(value))) + geom_raster()
table_sxi <- melt(table(round(ss_xps_idle$idle_rps,digits = 3),round(ss_xps_idle$idle_wps,digits = 3)))
table_sxi$value[table_sxi$value == 0] <- 0.5
ggplot(table_sxi,aes(x = Var1,y = Var2,fill = log10(value))) + geom_raster()
table_sxi <- melt(table(round(ss_xps_idle$idle_rps,digits = 2),round(ss_xps_idle$idle_wps,digits = 2)))
table_sxi$value[table_sxi$value == 0] <- 0.5
ggplot(table_sxi,aes(x = Var1,y = Var2,fill = log10(value))) + geom_raster()
ggplot(table_sxi,aes(x = Var1,y = Var2,fill = log2(value))) + geom_raster()
ggplot(table_sxi,aes(x = Var1,y = Var2,fill = value)) + geom_raster()
ggplot(table_sxi,aes(x = Var1,y = Var2,fill = log2(value))) + geom_raster()
sw_idle <- rate_data(ss_wps)[,c('svrid','X8','X16','X32','X64')];sw_idle$idlew <- with(sw_idle,X8 + X16 + X32 + X64)
sr_idle <- rate_data(ss_rps)[,c('svrid','X0')];sr_idle$idler <- sr_idle$X0
ss_xps_idle <- merge(sw_idle[,c('svrid','idlew')],sr_idle[,c('svrid','idler')],by = 'svrid')
names(ss_xps_idle) <- c('svrid','idle_wps','idle_rps')
table_sxi <- melt(table(round(ss_xps_idle$idle_rps,digits = 2),round(ss_xps_idle$idle_wps,digits = 2)))
table_sxi$value[table_sxi$value == 0] <- 0.5
ggplot(table_sxi,aes(x = Var1,y = Var2,fill = log2(value))) + geom_raster()
View(table_sxi)
rwidle_similar <- melt(table(table_sxi$Var1 - table_sxi$Var2)
)
View(rwidle_similar)
ggplow(rwidle_similar,aes(Var1,value)) + geom_bar(stat = 'identity')
ggplot(rwidle_similar,aes(Var1,value)) + geom_bar(stat = 'identity')
ggplot(rwidle_similar,aes(x = Var1,y = value)) + geom_bar(stat = 'identity')
View(rwidle_similar)
sum(rwidle_similar$value)
table_sxi$diff <- table_sxi$Var1 - table_sxi$Var2
rwidle_similar <- list2df(tapply(table_sxi$value,table_sxi$diff,sum))
View(rwidle_similar)
rwidle_similar <- list2df(tapply(table_sxi$value,table_sxi$diff,sum),n = c('count','diff'))
ggplot(rwidle_similar,aes(x = diff,y = count)) + geom_bar(stat = 'identity')
table_sxi$diff <- round(table_sxi$Var1 - table_sxi$Var2,digits = 1)
rwidle_similar <- list2df(tapply(table_sxi$value,table_sxi$diff,sum),n = c('count','diff'))
ggplot(rwidle_similar,aes(x = diff,y = count)) + geom_bar(stat = 'identity')
View(table_sxi)
View(rwidle_similar)
sw_idle <- rate_data(ss_wps)[,c('svrid','X8','X16','X32','X64')];sw_idle$idlew <- with(sw_idle,X16 + X32)
sr_idle <- rate_data(ss_rps)[,c('svrid','X0')];sr_idle$idler <- sr_idle$X0
ss_xps_idle <- merge(sw_idle[,c('svrid','idlew')],sr_idle[,c('svrid','idler')],by = 'svrid')
names(ss_xps_idle) <- c('svrid','idle_wps','idle_rps')
table_sxi <- melt(table(round(ss_xps_idle$idle_rps,digits = 2),round(ss_xps_idle$idle_wps,digits = 2)))
table_sxi$value[table_sxi$value == 0] <- 0.5
ggplot(table_sxi,aes(x = Var1,y = Var2,fill = log2(value))) + geom_raster()
table_sxi$diff <- round(table_sxi$Var1 - table_sxi$Var2,digits = 1)
rwidle_similar <- list2df(tapply(table_sxi$value,table_sxi$diff,sum),n = c('count','diff'))
ggplot(rwidle_similar,aes(x = diff,y = count)) + geom_bar(stat = 'identity')
rwidle_similar$count <- array_rate(rwidle_similar$count)
ggplot(rwidle_similar,aes(x = diff,y = count)) + geom_bar(stat = 'identity')
View(rwidle_similar)
sum(rwidle_similar$count[abs(rwidle_similar$diff) <= 0.1])
abs(rwidle_similar$diff) <= 0.1
abs(rwidle_similar$diff)
sum(rwidle_similar$count[abs(as.numeric(rwidle_similar$diff)) <= 0.1])
summary(rps_idlewps$X0+rps_idlewps$X1)  #xmind
ggplot(table_sxi,aes(x = Var1,y = Var2,fill = log2(value))) + geom_raster() #useful
col_value <- names(ss_rps)[grepl('X\\d+',names(ss_rps))]
ss_rps_idlewps <- factorX(subset(ss_rps,svrid %in% sub_idle$svrid[sub_idle$frac_idle > median(sub_idle$frac_idle)]))
rps_idlewps <- subset(ss_rps,svrid %in% wps_busy$svrid)
rps_idlewps <- rate_data(rps_idlewps)
ggplot(rps_idlewps,aes(X0)) + stat_ecdf()
summary(rps_idlewps$X0+rps_idlewps$X1)  #xmind
wi <- wps_idle
View(wi)
idle_iopsw <- subset(ss_iopsw,svrid %in% wps_idle$svrid)
View(idle_iopsw)
idle_iopsw <- rate_data(idle_iopsw)
View(idle_iopsw)
colSums(idle_iopsw[,col_value])
array_rate(colSums(idle_iopsw[,col_value]))
0.5895 +0.3197
idle_iopsw <- subset(ss_iopsw,svrid %in% wps_idle$svrid)
array_rate(colSums(idle_iopsw[,col_value]))
0.5856 +0.3277
load(file.path(dir_data,'sca_similar_xps.Rda'))
rm(list = ls());source('~/rhead')
load(file.path(dir_data,'sca_similar_xps.Rda'))
load(file.path(dir_data,'sta_dcastClear.Rda'))
similar_xps$fn <- r_sta_svrid$fn[similar_xps$svrid,r_sta_svrid$svrid]
similar_xps$fn <- r_sta_svrid$fn[match(similar_xps$svrid,r_sta_svrid$svrid)]
View(similar_xps)
a <- melt(table(factor(smimilar_xps$fn)))
a <- melt(table(factor(similar_xps$fn)))
View(a)
load(file.path(dir_datatendcastClear,'b1.Rda'))
dd <- factorX(filter_badiops_NA(dt_dcast,attrName))
dd$flag_idler <- as.numeric(dd$rps < 1) + 2
dd$flag_idlew <- as.numeric(dd$wps < 64)
dd <- subsetX(dd,svrid %in% similar_xps$svrid)
splitDD <- split(dd,dd$svrid)
dd_svrid <- subset(splitDD[[1]],time > as.p('2014-08-01') & time < as.p('2014-08-08'))
table(dd_svrid$flag_idler,dd_svrid$flag_idlew)
dd_svrid <- subset(splitDD[[1]],time > as.p('2014-07-01') & time < as.p('2015-08-01'))
table(dd_svrid$flag_idler,dd_svrid$flag_idlew)
View(dd_svrid)
View(similar_xps)
table(dd$flag_idler,dd$flag_idlew)
a <- table(dd$flag_idler,dd$flag_idlew)
a/sum(a)
ggplot(dd_svrid,aes(x = time)) + geom_line(aes(y = flag_idler),color = 'red') + geom_line(aes(y = flag_idlew),color = 'blue')
dd_svrid <- subset(splitDD[[1]],time > as.p('2014-07-01') & time < as.p('2014-08-01'))
table(dd_svrid$flag_idler,dd_svrid$flag_idlew)
ggplot(dd_svrid,aes(x = time)) + geom_line(aes(y = flag_idler),color = 'red') + geom_line(aes(y = flag_idlew),color = 'blue')
dd_svrid <- subset(splitDD[[1]],time > as.p('2014-07-01') & time < as.p('2014-07-02'))
table(dd_svrid$flag_idler,dd_svrid$flag_idlew)
ggplot(dd_svrid,aes(x = time)) + geom_line(aes(y = flag_idler),color = 'red') + geom_line(aes(y = flag_idlew),color = 'blue')
cor(dd_svrid$flag_idler,dd_svrid$flag_idlew)
rm(list = ls());source('~/rhead')
load(file.path(dir_data,'sta_dcastClear.Rda'))
fname <- list.files(dir_datatendcastClear)
attrName <- c('util','rps','wps')
cutList <- list(cut_util = sort(c(0,3,2^(0:6),95,101)),
cut_rps = c(0,2^(seq(0,16,1)),1e6),cut_iopsr = c(0,2^(seq(0,16,1)),1e6),cut_sizer = roundX(c(0,2^(seq(-6.5,1.5,0.5)),10)),
cut_wps = c(0,2^(seq(0,16,1)),1e6),cut_iopsw = c(0,2^(seq(0,16,1)),1e6),cut_sizew = roundX(c(0,2^(seq(-6.5,1.5,0.5)),10)))
idx <- seq_len(length(fname))
i = 1
fn <- fname[i]
cat(sprintf('[%s]\tfile:%s\tSATRT!!!\n',date(),fn))
load(file.path(dir_datatendcastClear,fn))
dd <- filter_badiops_NA(dt_dcast,attrName)
1
attrName <- c('rps','wps')
load(file.path(dir_data,'sta_dcastClear_result.Rda'))
attrName <- c('util','rps','wps','iopsr','iopsw')
dd <- remove_line_byvalue(df[,c('svrid','time',attrName)])
df <- dt_dcast
dd <- remove_line_byvalue(df[,c('svrid','time',attrName)])
!grepl('a\\d+',fn)
dd <- factorX(subset(dd,svrid %in% levels(dd$svrid)[1:10]))
dd$rps_level <- cut_level(dd$rps,cutList$cut_rps,f2n = F)
dd$wps_level <- cut_level(dd$wps,cutList$cut_wps,f2n = F)
cutList <- list(cut_util = sort(c(0,3,2^(0:6),95,101)),
cut_rps = c(0,64,4096,1e6),cut_iopsr = c(0,2^(seq(0,16,1)),1e6),cut_sizer = roundX(c(0,2^(seq(-6.5,1.5,0.5)),10)),
cut_wps = c(0,1,1024,1e6),cut_iopsw = c(0,2^(seq(0,16,1)),1e6),cut_sizew = roundX(c(0,2^(seq(-6.5,1.5,0.5)),10)))
dd$rps_level <- cut_level(dd$rps,cutList$cut_rps,f2n = F)
dd$wps_level <- cut_level(dd$wps,cutList$cut_wps,f2n = F)
dd$rps_level <- sort_level(cut_level(dd$rps,cutList$cut_rps,f2n = F))
dd$rps_level <- cut_level(dd$rps,cutList$cut_rps,f2n = F)
dd$wps_level <- cut_level(dd$wps,cutList$cut_wps,f2n = F)
dd$rps_level <- sort_level(dd$rps_level)
dd$rps_level <- cut_level(dd$rps,cutList$cut_rps,f2n = F)
f <- dd$rps_level
f1 <- f
sort(unique(fct2num(f)))
dd$rps_level <- sort_level(cut_level(dd$rps,cutList$cut_rps,f2n = F))
source('~/Code/R/R_libs_user/R_custom_lib.R')
dd$rps_level <- sort_level(cut_level(dd$rps,cutList$cut_rps,f2n = F))
dd$wps_level <- sort_level(cut_level(dd$wps,cutList$cut_wps,f2n = F))
source('~/Code/R/R_libs_user/R_custom_lib.R')
dd$rps_level <- sort_level(cut_level(dd$rps,cutList$cut_rps,f2n = F))
dd$rps_level <- cut_level(dd$rps,cutList$cut_rps,f2n = F)
f <- dd$rps_level
f1 <- f
sort((fct2num(levels(f))))
levels(f)
sort((as.numeric(levels(f))))
source('~/Code/R/R_libs_user/R_custom_lib.R')
dd$wps_level <- sort_level(cut_level(dd$wps,cutList$cut_wps,f2n = F))
dd$rps_level <- sort_level(cut_level(dd$rps,cutList$cut_rps,f2n = F))
dd$wps_level <- sort_level(cut_level(dd$wps,cutList$cut_wps,f2n = F))
dd$xps_diff <- factor(as.numeric(dd$rps_level)*10 + as.numeric(dd$wps_level))
table(dd$xps_diff)
table(dd$rps_level,dd$wps_level)
cutList <- list(cut_util = sort(c(0,3,2^(0:6),95,101)),
cut_rps = c(0,1,1024,1e6),cut_iopsr = c(0,2^(seq(0,16,1)),1e6),cut_sizer = roundX(c(0,2^(seq(-6.5,1.5,0.5)),10)),
cut_wps = c(0,64,4096,1e6),cut_iopsw = c(0,2^(seq(0,16,1)),1e6),cut_sizew = roundX(c(0,2^(seq(-6.5,1.5,0.5)),10)))
dd$rps_level <- sort_level(cut_level(dd$rps,cutList$cut_rps,f2n = F))
dd$wps_level <- sort_level(cut_level(dd$wps,cutList$cut_wps,f2n = F))
dd$xps_diff <- factor(as.numeric(dd$rps_level)*10 + as.numeric(dd$wps_level))
dd$xps_diff <- sort_level(dd$xps_diff)
r <- tapply(dd$xps_diff,dd$svrid,function(x)as.data.frame.matrix(table(x)))
r <- tapply(dd$xps_diff,dd$svrid,function(x)table(x))
r[[1]]
r <- tapplyX(dd$xps_diff,dd$svrid,function(x)table(x))
source('~/Code/R/R_libs_user/R_custom_lib.R')
r <- tapplyX(dd$xps_diff,dd$svrid,function(x)table(x))
View(r)
r <- list2df(dd$xps_diff,dd$svrid,function(x)table(x))
r <- tapplyX(dd$xps_diff,dd$svrid,function(x)table(x))
r <- data.frame(tapplyX(dd$xps_diff,dd$svrid,function(x)table(x))
}
load(file.path(dir_data,'sta_dcastClear.Rda'))
fname <- list.files(dir_datatendcastClear)
# fname <- fname[!grepl('a\\d.*',fname)]
attrName <- c('util','rps','wps','iopsr','iopsw')
cutList <- list(cut_util = sort(c(0,3,2^(0:6),95,101)),
cut_rps = c(0,1,1024,1e6),cut_iopsr = c(0,2^(seq(0,16,1)),1e6),cut_sizer = roundX(c(0,2^(seq(-6.5,1.5,0.5)),10)),
cut_wps = c(0,64,4096,1e6),cut_iopsw = c(0,2^(seq(0,16,1)),1e6),cut_sizew = roundX(c(0,2^(seq(-6.5,1.5,0.5)),10)))
idx <- seq_len(length(fname))
r <- foreachX(idx,'sta_xps_level_rela')
save(cutList,r,file = file.path(dir_data,'sta_xps_level_rela'))
r <- data.frame(tapplyX(dd$xps_diff,dd$svrid,function(x)table(x)))
View(r)
r <- cbind(levels(dd$svrid),r)
View(r)
fname <- 'd1.Rda'
fn <- fname[i]
cat(sprintf('[%s]\tfile:%s\tSATRT!!!\n',date(),fn))
load(file.path(dir_datatendcastClear,fn))
dd <- filter_badiops_NA(dt_dcast,attrName,fn)
source('~/Code/R/attrid/base_func.R')
dd <- filter_badiops_NA(dt_dcast,attrName,fn)
1
dd <- subsetX(dd,svrid %in% levels(dd$svrid)[1:50])
dd <- subsetX(dd,svrid %in% levels(dd$svrid)[1:50])
dd$rps_level <- sort_level(cut_level(dd$rps,cutList$cut_rps,f2n = F))
dd$wps_level <- sort_level(cut_level(dd$wps,cutList$cut_wps,f2n = F))
dd$xps_diff <- sort_level(factor(as.numeric(dd$rps_level)*10 + as.numeric(dd$wps_level)))
r <- data.frame(tapplyX(dd$xps_diff,dd$svrid,function(x)table(x)))
r <- cbind(levels(dd$svrid),r)
names(r)[1] <- 'svrid'
View(r)
r1 <- r
col_value <- names(r)[grepl('X\\d+',names(r))]
r[,col_value] <- apply(r[,col_value],1,array_rate)
View(r)
rm(list = ls());source('~/rhead')
load(file.path(dir_data,'sta_dcastClear.Rda'))
load(file.path(dir_data,'sta_level_xps_rela.Rda'))
