cm3 <- AFR_attr_notime(tmp.f,tmp.cmdb,'fsTime','shTime',12,dev = 'TS1T')
cm4 <- AFR_attr_notime(tmp.f,tmp.cmdb,'fsTime','shTime',12,dev = 'TS2T')
cmDev <- AFR_attr_notime(tmp.f,tmp.cmdb,'dev_class_id','dev_class_id',1)
cm <- rbind(cm1,cm2)
cm <- factorX(subset(cm,!is.na(AFR) & item != '6'))
plotCol <- c('item','class','AFR')
naFill <- cbind(expand.grid(item = levels(cm$item),class = levels(factor(cm$class))),AFR = NA)
AFR_plot(rbind(subset(cm,,plotCol),naFill),'Ship Time and Annual Failure Rate',-2)
# 读与写的不同特性对故障的影响
rm(list = ls())
#@@@ CONFIGURE @@@#
source(file.path('D:/Git/attrid','attr_config.R'))
#@@@ Function @@@#
source('D:/Git/R_Function/Rfun.R')
source(file.path(dir_code,'attr_function.R'))
#@@@ LOAD DATA @@@#
load(file.path(dir_data,'load_ftr_attrid.Rda'))
source(file.path(dir_code,'AFR_io_prepare.R'))
#@@@ LOCAL FUNCTION @@@#
############################################################################################
# C1.读写总量与读写比例
ioC1 <- subset(tmp.io,mean_902 != 0 & mean_903 != 0)
ioC1$mean_902 <- log2(ioC1$mean_902*86400*365)
ioC1$mean_903 <- log2(ioC1$mean_903*86400*365)
ioC1$mean_9023 <- log2(2^ioC1$mean_902 + 2^ioC1$mean_903)
ioC1$rwRate <- (2^ioC1$mean_903)/(2^ioC1$mean_9023)*100
View(ioC1)
tableX(ioC1$dClass)
ioC1 <- subset(tmp.io,mean_902 != 0 & mean_903 != 0)
ioC1$mean_902 <- log2(ioC1$mean_902*86400*365)
ioC1$mean_903 <- log2(ioC1$mean_903*86400*365)
ioC1$mean_9023 <- log2(2^ioC1$mean_902 + 2^ioC1$mean_903)
ioC1$rwRate <- (2^ioC1$mean_903)/(2^ioC1$mean_9023)*100
fC1 <- subset(tmp.f, svr_id %in% ioC1$svrid)
fC1$sep902 <- ioC1$sep902[match(fC1$svr_id,ioC1$svrid)]
fC1$sep903 <- ioC1$sep903[match(fC1$svr_id,ioC1$svrid)]
fC1$sep9023 <- ioC1$sep9023[match(fC1$svr_id,ioC1$svrid)]
fC1$sepRate <- ioC1$sepRate[match(fC1$svr_id,ioC1$svrid)]
tableX(fC1$dClass)
ggplot(subset(ioC1,dClass == C),aes(x = mean_9023,fill = shTime)) + geom_histogram()
ggplot(subset(ioC1,dClass == 'C'),aes(x = mean_9023,fill = shTime)) + geom_histogram()
ggplot(subset(ioC1,dClass == 'C'),aes(x = mean_9023,fill = shTime)) + geom_histogram(binwidth = 2)
a <- subset(ioC1,dClass == 'C')
ggplot(subset(ioC1,dClass == 'C'),aes(x = mean_9023)) + geom_histogram(binwidth = 2)
ggplot(subset(ioC1,dClass == 'C'),aes(x = mean_9023)) + geom_histogram(binwidth = 1)
ggplot(subset(ioC1,dClass == 'C'),aes(x = mean_9023)) + geom_bar(binwidth = 1)
ggplot(subset(ioC1,dClass == 'C'),aes(x = mean_9023,fill = class)) + geom_bar(binwidth = 1)
ggplot(subset(ioC1,dClass == 'C'),aes(x = mean_9023,fill = shTime)) + geom_bar(binwidth = 1)
summary(a)
ggplot(subset(ioC1,dClass == 'C'),aes(x = mean_9023,fill = factor(shTime))) + geom_bar(binwidth = 1)
ggplot(subset(ioC1,dClass == 'C'),aes(x = mean_9023,fill = factor(shTime))) + geom_bar(binwidth = 1,position = 'fill' )
ggplot(subset(ioC1,dClass == 'C'),aes(x = mean_9023,fill = factor(shTime))) + geom_bar(stat = 'identity',binwidth = 1,position = 'fill' )
l
ggplot(subset(ioC1,dClass == 'C'),aes(x = mean_9023,fill = factor(shTime))) + geom_bar(binwidth = 1,position = 'fill')
ggplot(subset(ioC1,dClass == 'TS'),aes(x = mean_9023,fill = factor(shTime))) + geom_bar(binwidth = 1,position = 'fill')
a <- subset(ioC1,dClass == 'TS')
ggplot(subset(ioC1,dClass == 'TS1T'),aes(x = mean_9023,fill = factor(shTime))) + geom_bar(binwidth = 1,position = 'fill')
ggplot(subset(ioC1,dClass == 'TS2T'),aes(x = mean_9023,fill = factor(shTime))) + geom_bar(binwidth = 1,position = 'fill')
source('D:/Git/attrid/readWrite.R')
View(AFRRateTS)
AFRRateTS_10 <- ioAFR(div9023,ioC1TS,fC1TS,'sep9023',12)
AFRRateTS_10 <- ioAFR(div9023,subset(ioC1TS,sepRate <= 10),subset(fC1TS,sepRate <= 10),'sep9023',12)
View(AFRRateTS_10)
AFRRateTS_40_60 <- ioAFR(div9023,subset(ioC1TS,sepRate >= 40 & sepRate <= 60),
subset(fC1TS,sepRate >= 40 & sepRate <= 60),'sep9023',12)
View(AFRRateTS_10)
View(AFRRateTS_40_60)
ggplot(AFRRateTS_10,aes(x = sep,y = AFR)) + geom_bar(stat = 'identity')
ggplot(AFRRateTS_40_60,aes(x = sep,y = AFR)) + geom_bar(stat = 'identity')
View(fC1TS)
# 测试用
rm(list = ls())
#@@@ CONFIGURE @@@#
source(file.path('D:/Git/attrid','attr_config.R'))
#@@@ Function @@@#
source('D:/Git/R_Function/Rfun.R')
source(file.path(dir_code,'attr_function.R'))
# 测试用
rm(list = ls())
#@@@ CONFIGURE @@@#
source(file.path('D:/Git/attrid','attr_config.R'))
#@@@ Function @@@#
source('D:/Git/R_Function/Rfun.R')
source(file.path(dir_code,'attr_function.R'))
load(file.path(dir_data,'freqFieldWatch200.Rda'))
quantile(data$a903,sep(0,1,0.01))
quantile(data$a903,seq(0,1,0.01))
ggplot(data,aes(a903)) + geom_histogram()
ggplot(data,aes(log2(a903))) + geom_histogram()
ggplot(data,aes(a902)) + geom_histogram()
quantile(data$a902,seq(0,1,0.01))
ggplot(data,aes(log2(a903))) + geom_histogram()
quantile(log2(data$a903),seq(0,1,0.01))
quantile(log2(data$a903,na.rm = T),seq(0,1,0.01))
quantile(log2(data$a903),seq(0,1,0.01),na.rm = T)
# 测试用
rm(list = ls())
#@@@ CONFIGURE @@@#
source(file.path('D:/Git/attrid','attr_config.R'))
#@@@ Function @@@#
source('D:/Git/R_Function/Rfun.R')
source(file.path(dir_code,'attr_function.R'))
load(file.path(dir_data,'freqFieldWatch200.Rda'))
fs <- 1/300
N <- 17280
#对数值和fft作图
mtplot <- function(sid){
sidp <- gsub('.*_','',sid)
print(sid)
x <- subset(data,svrid == sidp,c('a999','timeNew'))
names(x) <- c('value','time')
x$value[x$value < 0] <- 0
dataVo <- data.frame(time = x$time,value = x$value)
x <- x[x$value <= quantile(x$value,0.99),]
N <- length(x$value);n <- 0:(N-1);t <- n/fs;
f <- n*fs/N;fft <- abs(fft(x$value))
f <- f[2:(N/2)];fft <- fft[2:(N/2)]
dataV <- data.frame(time = x$time,value = x$value)
dataF <- data.frame(freq = f,fft)
p1 <- ggplot(dataV,aes(x = time,y = value)) +
geom_line() + ggtitle(paste(sid,'time field',sep='_'))
p2 <- ggplot(dataF,aes(x = freq,y = fft)) +
geom_line(stat = 'identity') + ggtitle(paste(sid,'freq field',sep='_'))
png(filename = file.path(dir_data,'FailIOCoarse','test200-util',paste(sid,'.jpg',sep = '')),
width = 800, height = 600, bg = "white")
multiplot(p1,p2,cols = 2)
dev.off()
dataF <- dataF[order(dataF$fft,decreasing = T),];
dataF$days <- 1/dataF$freq/86400
dataF$round <- round(dataF$days)
dataF$absR <- abs(dataF$days - dataF$round)
dataF$realPeriod <- dataF$absR <= 0.05
dataF$fftRate <- dataF$fft/sum(dataF$fft)*100
dataFS <- subset(dataF,days > 1/3 & days < 10 & fft > 0 & realPeriod == T)
return(list(dataVo,dataFS,dataF))
}
cut <- c(as.POSIXct('2014-06-01'),as.POSIXct('2014-06-08'),as.POSIXct('2014-06-15'),
as.POSIXct('2014-06-22'),as.POSIXct('2014-06-29'),as.POSIXct('2014-07-06'),as.POSIXct('2014-07-13'),
as.POSIXct('2014-07-20'),as.POSIXct('2014-07-27'),as.POSIXct('2014-08-01'))
mtwplot <- function(sid,attr){
sidp <- gsub('.*_','',sid)
print(sid)
x <- subset(data,svrid == sidp,c(attr,'timeNew'))
names(x) <- c('value','time')
x$value[x$value < 0|is.na(x$value)] <- 0
dataV <- data.frame(time = x$time,value = x$value)
p <- list()
for(i in 1:9){
if(attr == 'a999'){
p[[i]] <- ggplot(subset(dataV,time >= cut[i] & time < cut[i+1]),aes(x = time,y = value)) +
geom_line() + ggtitle(paste(sid,'Week',i,sep='_'))
}else{
p[[i]] <- ggplot(subset(dataV,time >= cut[i] & time < cut[i+1]),aes(x = time,y = log2(value))) +
geom_line() + ggtitle(paste(sid,'Week',i,sep='_')) + ylab('value')
}
}
if(attr == 'a999'){
tarDir <- 'test200-util'
}else if(attr == 'a902'){
tarDir <- 'test200-read'
}else if(attr = 'a903'){
tarDir <- 'test200-write'
}
png(filename = file.path(dir_data,'FailIOCoarse',tarDir,paste(sid,'-Week.jpg',sep = '')),
width = 1200, height = 1200, bg = "white")
multiplot(p[[1]],p[[2]],p[[3]],p[[4]],p[[5]],p[[6]],p[[7]],p[[8]],p[[9]],cols = 1)
dev.off()
return()
}
mtwplot <- function(sid,attr){
sidp <- gsub('.*_','',sid)
print(sid)
x <- subset(data,svrid == sidp,c(attr,'timeNew'))
names(x) <- c('value','time')
x$value[x$value < 0|is.na(x$value)] <- 0
dataV <- data.frame(time = x$time,value = x$value)
p <- list()
for(i in 1:9){
if(attr == 'a999'){
p[[i]] <- ggplot(subset(dataV,time >= cut[i] & time < cut[i+1]),aes(x = time,y = value)) +
geom_line() + ggtitle(paste(sid,'Week',i,sep='_'))
}else{
p[[i]] <- ggplot(subset(dataV,time >= cut[i] & time < cut[i+1]),aes(x = time,y = log2(value))) +
geom_line() + ggtitle(paste(sid,'Week',i,sep='_')) + ylab('value')
}
}
if(attr == 'a999'){
tarDir <- 'test200-util'
}else if(attr == 'a902'){
tarDir <- 'test200-read'
}else if(attr == 'a903'){
tarDir <- 'test200-write'
}
png(filename = file.path(dir_data,'FailIOCoarse',tarDir,paste(sid,'-Week.jpg',sep = '')),
width = 1200, height = 1200, bg = "white")
multiplot(p[[1]],p[[2]],p[[3]],p[[4]],p[[5]],p[[6]],p[[7]],p[[8]],p[[9]],cols = 1)
dev.off()
return()
}
?lapply
a <- lapply(sidset,mtwplot,c('a902'))
sidset <- paste(1:length(levels(data$svrid)),levels(data$svrid),sep='_')
a <- lapply(sidset,mtwplot,c('a902'))
debugSource('D:/Git/attrid/test.R')
n
debugSource('D:/Git/attrid/test.R')
print(p[[1]])
p[[1]]
View(dataV)
debugSource('D:/Git/attrid/test.R')
debugSource('D:/Git/attrid/test.R')
print(p[[1]])
p[[1]]
p
sid <- sidset[2];attr <- 'a902'
sidp <- gsub('.*_','',sid)
print(sid)
x <- subset(data,svrid == sidp,c(attr,'timeNew'))
names(x) <- c('value','time')
x$value[x$value < 0|is.na(x$value)] <- 0
dataV <- data.frame(time = x$time,value = x$value)
p <- list()
for(i in 1:9){
if(attr == 'a999'){
p[[i]] <- ggplot(subset(dataV,time >= cut[i] & time < cut[i+1]),aes(x = time,y = value)) +
geom_line() + ggtitle(paste(sid,'Week',i,sep='_'))
}else{
p[[i]] <- ggplot(subset(dataV,time >= cut[i] & time < cut[i+1]),aes(x = time,y = log2(value))) +
geom_line() + ggtitle(paste(sid,'Week',i,sep='_')) + ylab('value')
}
}
if(attr == 'a999'){
tarDir <- 'test200-util'
}else if(attr == 'a902'){
tarDir <- 'test200-read'
}else if(attr == 'a903'){
tarDir <- 'test200-write'
}
png(filename = file.path(dir_data,'FailIOCoarse',tarDir,'Week',paste(sid,'-Week.jpg',sep = '')),
width = 1200, height = 1200, bg = "white")
multiplot(p[[1]],p[[2]],p[[3]],p[[4]],p[[5]],p[[6]],p[[7]],p[[8]],p[[9]],cols = 1)
dev.off()
sid <- sidset[3]
sidp <- gsub('.*_','',sid)
print(sid)
x <- subset(data,svrid == sidp,c(attr,'timeNew'))
names(x) <- c('value','time')
x$value[x$value < 0|is.na(x$value)] <- 0
dataV <- data.frame(time = x$time,value = x$value)
p <- list()
for(i in 1:9){
if(attr == 'a999'){
p[[i]] <- ggplot(subset(dataV,time >= cut[i] & time < cut[i+1]),aes(x = time,y = value)) +
geom_line() + ggtitle(paste(sid,'Week',i,sep='_'))
}else{
p[[i]] <- ggplot(subset(dataV,time >= cut[i] & time < cut[i+1]),aes(x = time,y = log2(value))) +
geom_line() + ggtitle(paste(sid,'Week',i,sep='_')) + ylab('value')
}
}
if(attr == 'a999'){
tarDir <- 'test200-util'
}else if(attr == 'a902'){
tarDir <- 'test200-read'
}else if(attr == 'a903'){
tarDir <- 'test200-write'
}
png(filename = file.path(dir_data,'FailIOCoarse',tarDir,'Week',paste(sid,'-Week.jpg',sep = '')),
width = 1200, height = 1200, bg = "white")
multiplot(p[[1]],p[[2]],p[[3]],p[[4]],p[[5]],p[[6]],p[[7]],p[[8]],p[[9]],cols = 1)
print(p[[1]])
multiplot(p[[1]],p[[2]],cols = 1)
a <- p[[1]]
a <- p[1]
a <- p[[1]][1]
a <- p[[1]]
for(i in 1:8){
if(attr == 'a999'){
p[[i]] <- ggplot(subset(dataV,time >= cut[i] & time < cut[i+1]),aes(x = time,y = value)) +
geom_line() + ggtitle(paste(sid,'Week',i,sep='_'))
}else{
p[[i]] <- ggplot(subset(dataV,time >= cut[i] & time < cut[i+1]),aes(x = time,y = log2(value))) +
geom_line() + ggtitle(paste(sid,'Week',i,sep='_')) + ylab('value')
}
}
for(i in 1:5){
if(attr == 'a999'){
p[[i]] <- ggplot(subset(dataV,time >= cut[i] & time < cut[i+1]),aes(x = time,y = value)) +
geom_line() + ggtitle(paste(sid,'Week',i,sep='_'))
}else{
p[[i]] <- ggplot(subset(dataV,time >= cut[i] & time < cut[i+1]),aes(x = time,y = log2(value))) +
geom_line() + ggtitle(paste(sid,'Week',i,sep='_')) + ylab('value')
}
}
p <- list()
for(i in 1:5){
if(attr == 'a999'){
p[[i]] <- ggplot(subset(dataV,time >= cut[i] & time < cut[i+1]),aes(x = time,y = value)) +
geom_line() + ggtitle(paste(sid,'Week',i,sep='_'))
}else{
p[[i]] <- ggplot(subset(dataV,time >= cut[i] & time < cut[i+1]),aes(x = time,y = log2(value))) +
geom_line() + ggtitle(paste(sid,'Week',i,sep='_')) + ylab('value')
}
}
a <- p[[1]]
print(p[[1]])
sid <- sidset[2]
sidp <- gsub('.*_','',sid)
print(sid)
x <- subset(data,svrid == sidp,c(attr,'timeNew'))
names(x) <- c('value','time')
x$value[x$value < 0|is.na(x$value)] <- 0
dataV <- data.frame(time = x$time,value = x$value)
p <- list()
for(i in 1:9){
if(attr == 'a999'){
p[[i]] <- ggplot(subset(dataV,time >= cut[i] & time < cut[i+1]),aes(x = time,y = value)) +
geom_line() + ggtitle(paste(sid,'Week',i,sep='_'))
}else{
p[[i]] <- ggplot(subset(dataV,time >= cut[i] & time < cut[i+1]),aes(x = time,y = log2(value))) +
geom_line() + ggtitle(paste(sid,'Week',i,sep='_')) + ylab('value')
}
}
if(attr == 'a999'){
tarDir <- 'test200-util'
}else if(attr == 'a902'){
tarDir <- 'test200-read'
}else if(attr == 'a903'){
tarDir <- 'test200-write'
}
print(p[[1]])
ggplot(subset(dataV,time >= cut[i] & time < cut[i+1]),aes(x = time,y = value)) +
geom_line() + ggtitle(paste(sid,'Week',i,sep='_'))
# 测试用
rm(list = ls())
#@@@ CONFIGURE @@@#
source(file.path('D:/Git/attrid','attr_config.R'))
#@@@ Function @@@#
source('D:/Git/R_Function/Rfun.R')
source(file.path(dir_code,'attr_function.R'))
#@@@ LOAD DATA @@@#
# load(file.path(dir_data,'load_ftr_attrid.Rda'))
############################################################################################
# # T1. data1中三字段分位点
# load(file.path(dir_data,'data1Quan.Rda'))
# q902 <- data.frame(quan = seq(0,100,0.1),value = q902,cl = 'Read')
# q903 <- data.frame(quan = seq(0,100,0.1),value = q903,cl = 'write')
# q999 <- data.frame(quan = seq(0,100,0.1),value = q999,cl = 'Util')
# q <- rbind(q902,q903,q999)
# row.names(q) <- NULL
# ggplot(q,aes(x = quan,y = log2(value),group = cl,color = cl)) + geom_line()
# T2. 频谱图
# load(file.path(dir_data,'failIOSample.Rda'))
# svrid_cpl <- tapply(failIO$svrid,factor(failIO$svrid),length)
# svrid_full <- names(svrid_cpl)[as.numeric(svrid_cpl) == 17280]
# failIOSample <- factorX(subset(failIO,svrid %in% sample(svrid_full,100)))
# save(failIOSample,file = file.path(dir_data,'failIOSample.Rda'))
# failIO <- failIOSample
#
# data <- failIO$a902[failIO$svrid == levels(failIO$svrid)[4]]   #数据选择
# data <- subset(failIO,svrid %in% levels(failIO$svrid)[4])
#
# #FT之后三个字段最高的三种频率
# maxFreq <- function(sid){
#   L <- 3
# #   sprintf(print(sid))
#   data <- subset(failIO,svrid == sid)
#   #计算
#   fftR <- abs(fft(data$a902))[2:(N/2)]
#   fftW <- abs(fft(data$a903))[2:(N/2)]
#   fftU <- abs(fft(data$a999))[2:(N/2)]
#   #数据整理
#   df <- data.frame(f = f[2:(N/2)],fftR,fftW,fftU);
#   Freq <- c(df$f[order(df$fftR,decreasing = T)][1:L],
#             df$f[order(df$fftW,decreasing = T)][1:L],
#             df$f[order(df$fftU,decreasing = T)][1:L],
#             df$fftR[order(df$fftR,decreasing = T)][1:L],
#             df$fftW[order(df$fftW,decreasing = T)][1:L],
#             df$fftU[order(df$fftU,decreasing = T)][1:L])
# }
#
# #参数设置与计算
# fs <- 1/300;N <- 17280;
# n <- 0:(N-1);t <- n/fs;
# f <- n*fs/N
# sidSet <- levels(failIO$svrid)[1:10]
# R <- data.frame(svrid = sidSet,t(sapply(sidSet,maxFreq)))
# R[,2:10] <- 1/R[,2:10]/86400
# row.names(R) <- NULL
#
# load(file.path(dir_data,'fourierTransMThH.Rda'))
# R1 <- subset(frT,svrid %in% R$svrid)
#
# # T3.svm尝试
# simData=function(radius,width,distance,sample_size)
# {
#   aa1=runif(sample_size/2)
#   aa2=runif(sample_size/2)
#   rad=(radius-width/2)+width*aa1
#   theta=pi*aa2
#   x=rad*cos(theta)
#   y=rad*sin(theta)
#   label=1*rep(1,length(x))
#
#   x1=rad*cos(-theta)+rad
#   y1=rad*sin(-theta)-distance
#   label1=-1*rep(1,length(x1))
#
#   n_row=length(x)+length(x1)
#   data=matrix(rep(0,3*n_row),nrow=n_row,ncol=3)
#   data[,1]=c(x,x1)
#   data[,2]=c(y,y1)
#   data[,3]=c(label,label1)
#
#   data
#
# }
# dataSim=simData(radius=10,width=6,distance=-6,sample_size=3000)
# colnames(dataSim)<-c("x","y","label")
# dataSim<-as.data.frame(dataSim)
#
# require('e1071')
# m1 <- svm(label ~x*y, data =dataSim,cross=10,type="C-classification",kernel="sigmoid")
# m1
# summary(m1)
# pred1<-fitted(m1)
# table(pred1,dataSim[,3])
#
# # T4. 傅里叶变换学习
# xs <- seq(-2*pi,2*pi,pi/100)
# wave.1 <- sin(3*xs)
# wave.2 <- sin(10*xs)
# par(mfrow = c(1, 2))
# plot(xs,wave.1,type="l",ylim=c(-1,1)); abline(h=0,lty=3)
# plot(xs,wave.2,type="l",ylim=c(-1,1)); abline(h=0,lty=3)
#
# wave.3 <- 0.5 * wave.1 + 0.25 * wave.2
# plot(xs,wave.3,type="l"); title("Eg complex wave"); abline(h=0,lty=3)
#
# wave.4 <- wave.3
# wave.4[wave.3>0.5] <- 0.5
# plot(xs,wave.4,type="l",ylim=c(-1.25,1.25)); title("overflowed, non-linear complex wave"); abline(h=0,lty=3)
#
# repeat.xs     <- seq(-2*pi,0,pi/100)
# wave.3.repeat <- 0.5*sin(3*repeat.xs) + 0.25*sin(10*repeat.xs)
# plot(xs,wave.3,type="l"); title("Repeating pattern")
# points(repeat.xs,wave.3.repeat,type="l",col="red"); abline(h=0,v=c(-2*pi,0),lty=3)
#
# # T5.文件重命名以放入同一个文件夹中查看
# dir_rename1 <- 'D:/Data/attrid/FailIOCoarse/test200-read/Week'
# dir_rename2 <- 'D:/Data/attrid/FailIOCoarse/test200-write/Week'
# dir_rename3 <- 'D:/Data/attrid/FailIOCoarse/test200-util/Week'
#
# names1 <- list.files(dir_rename1)
# names2 <- list.files(dir_rename2)
# names3 <- list.files(dir_rename3)
#
# newnames1 <- gsub('Week','Week-Read',names1)
# newnames2 <- gsub('Week','Week-Write',names2)
# newnames3 <- gsub('Week','Week-Util',names3)
#
# file.rename(file.path(dir_rename1,names1),
#             file.path(dir_rename1,newnames1))
#
# file.rename(file.path(dir_rename2,names2),
#             file.path(dir_rename2,newnames2))
#
# file.rename(file.path(dir_rename3,names3),
#             file.path(dir_rename3,newnames3))
# T4.时域与频域数据观察
# load(file.path(dir_data,'failIO.Rda'))
# svrCount <- tapply(failIO$svrid,factor(failIO$svrid),length)
# svr902 <- tapply(failIO$a902,factor(failIO$svrid),)
# svrCount <- data.frame(svrid = names(svrCount),count = as.numeric(svrCount))
# data <- subset(failIO,svrid %in% sample(svrCount$svrid[svrCount$count == 17280 & quantile(a902,0.5) > 0],200))
# data <- factorX(data)
# row.names(data) <- NULL
# save(data,file = file.path(dir_data,'freqFieldWatch200.Rda'))
load(file.path(dir_data,'freqFieldWatch200.Rda'))
fs <- 1/300
data$fluc902 <- 0
data$fluc903 <- 0
data$a902[data$a902 <= 1] <- 1
data$a903[data$a903 <= 1] <- 1
data$a902l <- log2(data$a902)
data$a903l <- log2(data$a903)
data$fluc902[1:(nrow(data)-1)] <- data$a902l[2:nrow(data)] - data$a902l[1:(nrow(data)-1)]
data$fluc903[1:(nrow(data)-1)] <- data$a903l[2:nrow(data)] - data$a903l[1:(nrow(data)-1)]
a <- data[1:10000,]
View(a)
load(file.path(dir_data,'freqFieldWatch200.Rda'))
data$a902[data$a902 <= 1] <- 1
data$a903[data$a903 <= 1] <- 1
data$a902l <- log2(data$a902)
data$a903l <- log2(data$a903)
data$fluc902 <- 0
data$fluc903 <- 0
data$fluc902[1:(nrow(data)-1)] <- data$a902l[2:nrow(data)] - data$a902l[1:(nrow(data)-1)]
data$fluc903[1:(nrow(data)-1)] <- data$a903l[2:nrow(data)] - data$a903l[1:(nrow(data)-1)]
a <- data[1:10000,]
View(a)
data$svrid_day <- paste(data$svrid,data$time,sep='_')
r <- tapply(data$fluc902,data$svrid_day,function(x)max(abs(x)))
fluc <- strsplit(names(r),'_')
fluc <- data.frame(matrix(unlist(fluc),byrow = T,nrow = length(fluc)))
View(fluc)
fluc$value <- as.numeric(r)
names(fluc) <- c('svrid','time','maxFV')
View(fluc)
View(a)
View(a)
r <- tapply(data$fluc902,data$svrid_day,function(x)which(x == max(abs(x))))
head(r)
