dd_week <- aggregate(dd_week[grepl('ps|util|iops',names(dd_week))],by = list(dd_week$svrid,dd_week$time),
function(x)round(mean(x,na.rm = T),digits = 4))
names(dd_week) <- names(dd)
View(dd_week)
cut_months <- seq.POSIXt(as.p('2014-07-01'),as.p('2015-07-01'),by = 'months')
dd_month <- dd
dd_month$time <- cut.POSIXt(dd_month$time,cut_months)
dd_month <- aggregate(dd_month[grepl('ps|util|iops',names(dd_month))],by = list(dd_month$svrid,dd_month$time),
function(x)round(mean(x,na.rm = T),digits = 4))
names(dd_month) <- names(dd)
View(dd_month)
fname <- setdiff(list.files(dir_datatendcast),'d1test.Rda')
source('~/Code/R/attrid/gen_io_timescale.R')
which(fname == 'd1.Rda')
i = 28
load(file.path(dir_datatendcast,fname[i]))
dd <- iops_dcast_clear(dt_dcast)
dd_day <- dd
dd_day$time <- as.Date(dd_day$time)
dd_day <- aggregate(dd_day[grepl('ps|util|iops',names(dd_day))],by = list(dd_day$svrid,dd_day$time),
function(x)round(mean(x,na.rm = T),digits = 4))
names(dd_day) <- names(dd)
cut_weeks <- seq.POSIXt(as.p('2014-07-01'),as.p('2015-07-01'),by = 'weeks')
cut_weeks[length(cut_weeks)] <- as.p('2015-07-01')
dd_week <- dd
dd_week$time <- cut.POSIXt(dd_week$time,cut_weeks)
dd_week <- aggregate(dd_week[grepl('ps|util|iops',names(dd_week))],by = list(dd_week$svrid,dd_week$time),
function(x)round(mean(x,na.rm = T),digits = 4))
names(dd_week) <- names(dd)
cut_months <- seq.POSIXt(as.p('2014-07-01'),as.p('2015-07-01'),by = 'months')
dd_month <- dd
dd_month$time <- cut.POSIXt(dd_month$time,cut_months)
dd_month <- aggregate(dd_month[grepl('ps|util|iops',names(dd_month))],by = list(dd_month$svrid,dd_month$time),
function(x)round(mean(x,na.rm = T),digits = 4))
names(dd_month) <- names(dd)
a <- list(d1 = dd_day,d2 = dd_week,d3 = dd_month)
?rbind
rm(list = ls())
source('head.R')
source('iops_dcast_clear.R')
dir_dataten <- '/home/yiyusheng/Data/tencProcess/mergePartSvrid/'
dir_datatendcast <- '/home/yiyusheng/Data/tencProcess/mergePartSvridDcast/'
fname <- setdiff(list.files(dir_datatendcast),'d1test.Rda')
fname <- setdiff(fname,list.files(file.path(dir_data,'timescale_dd')))
load(file.path(dir_data,'io_timescale.Rda'))
rm(list = ls())
source('head.R')
load(file.path(dir_data,'io_timescale.Rda'))
dd <- r[[1]]
dd_day <- lapply(r,'[[','d1')
dd_week <- lapply(r,'[[','d2')
dd_month <- lapply(r,'[[','d3')
sta_col <- data.frame(numCol = sapply(dd_day,ncol))
sta_col <- data.frame(numCol = sapply(dd_day,ncol),
idx = 1:length(dd_day))
View(sta_col)
splitCol <- split(sta_col,sta_col$numCol)
sort(unique(sta_col$numCol))
53-5
(sort(unique(sta_col$numCol))-5)/2
sta_col <- data.frame(numCol = (sapply(dd_day,ncol)-5)/2,
idx = 1:length(dd_day))
splitCol <- split(sta_col,sta_col$numCol)
sc <- splitCol[[1]]
View(sc)
eval(parse(text = sprintf('dd_day%d <- do.call(rbind,dd_day[sc$idx]',sc$numCol[1])))
eval(parse(text = sprintf('dd_day%d <- do.call(rbind,dd_day[sc$idx])',sc$numCol[1])))
lapply(splitCol,function(sc){
eval(parse(text = sprintf('dd_day%d <- do.call(rbind,dd_day[sc$idx])',sc$numCol[1])))
eval(parse(text = sprintf('dd_week%d <- do.call(rbind,dd_week[sc$idx])',sc$numCol[1])))
eval(parse(text = sprintf('dd_month%d <- do.call(rbind,dd_month[sc$idx])',sc$numCol[1])))
})
NULL <- lapply(splitCol,function(sc){
eval(parse(text = sprintf('dd_day%d <- do.call(rbind,dd_day[sc$idx])',sc$numCol[1])))
eval(parse(text = sprintf('dd_week%d <- do.call(rbind,dd_week[sc$idx])',sc$numCol[1])))
eval(parse(text = sprintf('dd_month%d <- do.call(rbind,dd_month[sc$idx])',sc$numCol[1])))
})
x <- lapply(splitCol,function(sc){
eval(parse(text = sprintf('dd_day%d <- do.call(rbind,dd_day[sc$idx])',sc$numCol[1])))
eval(parse(text = sprintf('dd_week%d <- do.call(rbind,dd_week[sc$idx])',sc$numCol[1])))
eval(parse(text = sprintf('dd_month%d <- do.call(rbind,dd_month[sc$idx])',sc$numCol[1])))
})
x <- lapply(splitCol,function(sc){
eval(parse(text = sprintf('dd_day%d <<- do.call(rbind,dd_day[sc$idx])',sc$numCol[1])))
eval(parse(text = sprintf('dd_week%d <<- do.call(rbind,dd_week[sc$idx])',sc$numCol[1])))
eval(parse(text = sprintf('dd_month%d <<- do.call(rbind,dd_month[sc$idx])',sc$numCol[1])))
return(0)
})
View(dd_month4)
summary(dd_month4$iopsr_4)
summary(dd_month4$iopsr_4 != 0)
summary(dd_day4$iopsr_4 != 0)
apply(dd_month4,2,function(x)corr(x,dd_month4$util))
apply(dd_month4,2,function(x)cor(x,dd_month4$util))
apply(dd_month4[,3:ncol_dd_month4],2,function(x)cor(x,dd_month4$util))
apply(dd_month4[,3:ncol(dd_month4)],2,function(x)cor(x,dd_month4$util))
apply(dd_month12[,3:ncol(dd_month4)],2,function(x)cor(x,dd_month12$util))
summary(dd_month12)
apply(dd_month12[,3:ncol(dd_month12)],2,function(x)cor(x,dd_month12$util,na.rm = T))
apply(dd_month12[,3:ncol(dd_month12)],2,function(x)cor(x,dd_month12$util))
View(dd_month24)
View(dd_week4)
a <- subset(dd_day4,svrid == '11433' & time = as.p('2014-07-01'))
a <- subset(dd_day4,svrid == '11433' & time == as.p('2014-07-01'))
a <- subset(dd_day4,svrid == '11433' & time == as.Date('2014-07-01'))
View(a)
rm(list = ls())
source('head.R')
dir_datafile <- '/home/yiyusheng/Data/tencProcess/mergePartSvrid'
fname <- list.files(dir_datafile)
which(fname == 'd1.Rda')
i = 28
load(file.path(dir_datafile,fname[i]))
data$svr_id <- factor(data$svr_id)
splitData <- split(data,data$svr_id)
df <- splitData[[1]]
a <- split(df,list(df$date,df$attrid))
sapply(a,nrow)
data1 <- subset(data,svr_id %in% c('144','171','172'))
r <- tapply(data1$attrid,list(data1$svr_id,data1$date),function(x)list(a = length(x),b = length(unique(x))))
data1 <- factorX(subset(data,svr_id %in% c('144','171','172')))
r <- tapply(data1$attrid,list(data1$svr_id,data1$date),function(x)list(a = length(x),b = length(unique(x))))
str(r)
?with
library(plyr)
?ddply
?adply
library(plyr)
?ddply
r <- ddply(data1,list(data1$svr_id,data1$date),function(x)list(a = length(x),b = length(unique(x))))
r <- ddply(data1,.(svr_id,date),function(x)list(a = length(x$attrid),b = length(unique(x$attrid))))
r <- ddply(data1,.(svr_id,date),list(a = length(attrid),b = length(unique(attrid))))
dfx <- data.frame(
group = c(rep('A', 8), rep('B', 15), rep('C', 6)),
sex = sample(c("M", "F"), size = 29, replace = TRUE),
age = runif(n = 29, min = 18, max = 54)
)
ddply(dfx, .(group, sex), summarize,
mean = round(mean(age), 2),
sd = round(sd(age), 2))
summarize
r <- ddply(data1,.(svr_id,date),function(df)list(a = length(df$attrid),b = length(unique(df$attrid))))
r <- ddply(data1,.(svr_id,date),function(df)data.frame(a = length(df$attrid),b = length(unique(df$attrid))))
View(r)
mutate
?mutate
View(r)
source('~/Code/R/attrid/sta_201608.R')
i = 28
load(file.path(dir_datafile,fname[i]))
data <- subset(data,svr_id %in% levels(data$svr_id)[1:3])
r <- ddply(data,.(svr_id,date),function(df)data.frame(Count = length(df$attrid),numAttrid = length(unique(df$attrid)),fn = fname[i]))
load(file.path(dir_datafile,fname[i]))
data$svr_id <- factor(data$svr_id)
data <- subset(data,svr_id %in% levels(data$svr_id)[1:3])
r <- ddply(data,.(svr_id,date),function(df)data.frame(Count = length(df$attrid),numAttrid = length(unique(df$attrid)),fn = fname[i]))
View(r)
source('~/Code/R/attrid/sta_201608.R')
r1 <- do.call(rbind,r)
View(r1)
sta_1608 <- r1
warnings()
save(sta_1608,file = file.path(dir_data,'sta_201608.Rda'))
rm(list = ls())
source('head.R')
library(plyr)
load(file.path(dir_data,'sta_201608.Rda'))
sta_data <- sta_201608
sta_data <- sta_1608
sta_svrid <- by(sta_date,sta_date$svr_id,function(df){
data.frame(svr_id = df$svr_id[1],
min_date = min(df$date),
max_date = max(df$date),
last_day = difftime(as.p(as.character(max(df$date))),as.p(as.character(min(df$date))),units = 'days'),
count = sum(df$Count),
fn = df$fn[1])
})
sta_day <- sta_1608
sta_svrid <- by(sta_day,sta_date$svr_id,function(df){
data.frame(svr_id = df$svr_id[1],
min_date = min(df$date),
max_date = max(df$date),
last_day = difftime(as.p(as.character(max(df$date))),as.p(as.character(min(df$date))),units = 'days'),
count = sum(df$Count),
fn = df$fn[1])
})
sta_svrid <- by(sta_day,sta_day$svr_id,function(df){
data.frame(svr_id = df$svr_id[1],
min_date = min(df$date),
max_date = max(df$date),
last_day = difftime(as.p(as.character(max(df$date))),as.p(as.character(min(df$date))),units = 'days'),
count = sum(df$Count),
fn = df$fn[1])
})
sta_svrid <- by(sta_day,sta_day$svr_id,function(df){
data.frame(svr_id = df$svr_id[1],
min_date = min(df$date),
max_date = max(df$date),
count = sum(df$Count),
fn = df$fn[1])
})
sta_svrid[[1]]
sta_svrid[[2]]
sta_svrid[[3]]
a <- sta_svrid[[3]]
sta_svrid <- by(sta_day,sta_day$svr_id,function(df){
data.frame(svr_id = fct2ori(df$svr_id[1]),
min_date = min(df$date),
max_date = max(df$date),
count = sum(df$Count),
fn = fct2ori(df$fn[1]))
})
sta_svrid1 <- do.call(rbind(sta_svrid))
sta_svrid1 <- do.call(rbind,sta_svrid)
View(sta_svrid1)
sta_svrid  <- sta_svrid 1
sta_svrid  <- sta_svrid1
save(sta_day,sta_svrid,file = file.path(dir_data,'sta_201608.Rda'))
source('~/Code/R/attrid/io_charact.R')
View(sta_svrid)
sta_svrid <- by(sta_day,sta_day$svr_id,function(df){
data.frame(svr_id = fct2ori(df$svr_id[1]),
min_date = min(df$date),
max_date = max(df$date),
count = sum(df$Count),
count_day = length(unique(df$date)),
fn = fct2ori(df$fn[1]))
})
rm(list = ls())
source('head.R')
compDir <- file.path(dir_data,'diskio')
dirName <- list.files(compDir)
setwd('../tencProcess/')
source('head.R')
compDir <- file.path(dir_data,'diskio')
dirName <- list.files(compDir)
rm(list = ls())
source('head.R')
load(file.path(dir_data,'staIOAllFile.Rda'))
a <- staIO[[1]]
View(a)
length(unique(a$date))
rm(list = ls())
source('head.R')
load(file.path(dir_data,'staIOAllFile.Rda'))
?is.data.frame
staIO <- staIO[unlist(lapply(staIO,is.data.frame))]
1+1
a <- unlist(lapply(staIO,is.data.frame))
sum(a)
days <- length(staIO)
lenIOPS <- data.frame(svr_id = 1:22393)
for(i in 1:length(staIO)){
x <- staIO[[i]]
lenIOPS[[as.character(x$date[i])]] <- x$len_iops[match(lenIOPS$svr_id,x$svr_id)]
}
View(lenIOPS)
setwd('../attrid')
source('~/Code/R/attrid/io_charact.R')
View(dd_month2)
day14 <- subset(sta_day,svr_id == '14')
week14 <- subset(sta_svrid,svr_id == '14')
View(week14)
View(day14)
day90 <- subset(sta_day,svr_id == '90')
svrid90 <- subset(sta_svrid,svr_id == '90')
View(day90)
str <- '90';day <- subset(sta_day,svr_id == str);sid <- subset(sta_svrid,svr_id == str);
View(sid)
View(day)
str <- '97';day <- subset(sta_day,svr_id == str);sid <- subset(sta_svrid,svr_id == str);
str <- '97';day <- subset(sta_day,svr_id == str);sid <- subset(sta_svrid,svr_id == str);f <- subset(failRecord,svr_id == str)
View(f)
day$date <- as.p(as.character(day$date))
day$date <- as.POSIXct(day$date,tz = 'UTC')
day$date <- as.POSIXct(day$date,tz = 'UTC',format = '%Y%m%d')
day$date <- as.POSIXct(as.character(day$date),tz = 'UTC',format = '%Y%m%d')
day$date <- as.POSIXct(as.character(day$date),tz = 'UTC',format = '%Y%m%d');ggplot(day,aes(x = date,y = numAttrid)) + geom_line() + geom_point()
ggplot(day,aes(x = date,y = numAttrid)) + geom_line() + geom_point()
ggplot(day,aes(x = date,y = numAttrid,group = 1)) + geom_line() + geom_point()
str <- '97';day <- subset(sta_day,svr_id == str);sid <- subset(sta_svrid,svr_id == str);f <- subset(failRecord,svr_id == str);
as.POSIXct(as.character(day$date[1]),tz = 'UTC',format = '%Y%m%d')
as.POSIXct(as.character(day$date[1:10]),tz = 'UTC',format = '%Y%m%d')
day$date <- as.POSIXct(as.character(day$date[1:10]),tz = 'UTC',format = '%Y%m%d');
day$date <- as.POSIXct(as.character(day$date),tz = 'UTC',format = '%Y%m%d');
ggplot(day,aes(x = date,y = numAttrid,group = 1)) + geom_line() + geom_point()
str <- '98';day <- subset(sta_day,svr_id == str);sid <- subset(sta_svrid,svr_id == str);f <- subset(failRecord,svr_id == str);
day$date <- as.POSIXct(as.character(day$date),tz = 'UTC',format = '%Y%m%d');
ggplot(day,aes(x = date,y = numAttrid,group = 1)) + geom_line() + geom_point()
str <- '109';day <- subset(sta_day,svr_id == str);sid <- subset(sta_svrid,svr_id == str);f <- subset(failRecord,svr_id == str);
day$date <- as.POSIXct(as.character(day$date),tz = 'UTC',format = '%Y%m%d');
ggplot(day,aes(x = date,y = numAttrid,group = 1)) + geom_line() + geom_point()
str <- '117';day <- subset(sta_day,svr_id == str);sid <- subset(sta_svrid,svr_id == str);f <- subset(failRecord,svr_id == str);
day$date <- as.POSIXct(as.character(day$date),tz = 'UTC',format = '%Y%m%d');
ggplot(day,aes(x = date,y = numAttrid,group = 1)) + geom_line() + geom_point()
str <- '122';day <- subset(sta_day,svr_id == str);sid <- subset(sta_svrid,svr_id == str);f <- subset(failRecord,svr_id == str);
day$date <- as.POSIXct(as.character(day$date),tz = 'UTC',format = '%Y%m%d');
ggplot(day,aes(x = date,y = numAttrid,group = 1)) + geom_line() + geom_point()
str <- '111';day <- subset(sta_day,svr_id == str);sid <- subset(sta_svrid,svr_id == str);f <- subset(failRecord,svr_id == str);
day$date <- as.POSIXct(as.character(day$date),tz = 'UTC',format = '%Y%m%d');
ggplot(day,aes(x = date,y = numAttrid,group = 1)) + geom_line() + geom_point()
str <- '117';day <- subset(sta_day,svr_id == str);sid <- subset(sta_svrid,svr_id == str);f <- subset(failRecord,svr_id == str);
day$date <- as.POSIXct(as.character(day$date),tz = 'UTC',format = '%Y%m%d');
ggplot(day,aes(x = date,y = numAttrid,group = 1)) + geom_line() + geom_point()
View(sid)
View(f)
View(day)
sta_svrid <- by(sta_day,sta_day$svr_id,function(df){
data.frame(svr_id = fct2ori(df$svr_id[1]),
min_date = min(df$date),
max_date = max(df$date),
count = sum(df$Count),
count_day = length(unique(df$date)),
fn = fct2ori(df$fn[1]))
})
sta_svrid <- do.call(rbind,sta_svrid)
View(sta_svrid)
save(sta_day,sta_svrid,file = file.path(dir_data,'sta_201608.Rda'))
i = 28
load(file.path(dir_datafile,fname[i]))
rm(list = ls())
source('head.R')
library(plyr)
rm(list = ls())
source('head.R')
source('iops_clear.R')
library(plyr)
dir_datafile <- '/home/yiyusheng/Data/tencProcess/mergePartSvrid'
fname <- list.files(dir_datafile)
i = 28
load(file.path(dir_datafile,fname[i]))
data$svr_id <- factor(data$svr_id)
attrid_ps <- 902:903
attrid_iops <- 36810:36857
data <- iops_melt_clear(data)
1+1
rm(list = ls())
source('head.R')
source('iops_clear.R')
library(plyr)
dir_datafile <- '/home/yiyusheng/Data/tencProcess/mergePartSvrid'
fname <- list.files(dir_datafile)
i = 28
load(file.path(dir_datafile,fname[i]))
data$svr_id <- factor(data$svr_id)
a <- data
data <- iops_melt_clear(data)
summary(data$value)
392806/nrow(a)
unique(a$attrid)
b <- subset(data,value > 1e7)
View(b)
data <- a
data <- iops_melt_clear(data)
summary(data$value)
source('~/Code/R/attrid/iops_clear.R')
data <- as
data <- a
data <- iops_melt_clear(data)
summary(data$value)
df <- subset(data,svr_id == '144' & date == '20140701')
View(df)
uni_col <- melt(table(data$attrid))
tapply(df$value,df$attrid,function(x)data.frame(mean = mean(x,na.rm = T),sd = sd(x,na.rm = T),sum = sum(x,na.rm = T),count = sum(!is.na(x))))
r <- tapply(df$value,df$attrid,function(x)data.frame(mean = mean(x,na.rm = T),sd = sd(x,na.rm = T),sum = sum(x,na.rm = T),count = sum(!is.na(x))))
r <- list2df(tapply(df$value,df$attrid,function(x)data.frame(mean = mean(x,na.rm = T),sd = sd(x,na.rm = T),sum = sum(x,na.rm = T),count = sum(!is.na(x)))))
View(r)
r <- list2df(tapply(df$value,df$attrid,
function(x)data.frame(mean = mean(x,na.rm = T),sd = sd(x,na.rm = T),
sum = sum(x,na.rm = T),count = sum(!is.na(x)))),
n = c('mean','sd','sum','count'))
View(r)
View(r)
r <- list2df(tapply(df$value,df$attrid,
function(x)data.frame(mean = mean(x,na.rm = T),sd = sd(x,na.rm = T),
sum = sum(x,na.rm = T),count = sum(!is.na(x)))),
n = c('mean','sd','sum','count','attrid'))
View(r)
tapply(df$value,df$attrid,
function(x)data.frame(mean = mean(x,na.rm = T),sd = sd(x,na.rm = T),
sum = sum(x,na.rm = T),count = sum(!is.na(x))))
r <- tapply(df$value,df$attrid,function(x)data.frame(mean = mean(x,na.rm = T),sd = sd(x,na.rm = T),
sum = sum(x,na.rm = T),count = sum(!is.na(x))))
r_mean <- lapply(r,'[[','mean')
r_mean <- data.frame(lapply(r,'[[','mean'))
View(r_mean)
data1 <- subset(data,svrid %in% c('144','171'))
data1 <- subset(data,svr_id %in% c('144','171'))
day_aggre <- function(df){
r <- tapply(df$value,df$attrid,function(x)data.frame(mean = mean(x,na.rm = T),sd = sd(x,na.rm = T),
sum = sum(x,na.rm = T),count = sum(!is.na(x))))
r_mean <- data.frame(lapply(r,'[[','mean'))
r_sd <- data.frame(lapply(r,'[[','sd'))
r_sum <- data.frame(lapply(r,'[[','sum'))
r_count <- data.frame(lapply(r,'[[','count'))
return(list(r_mean,r_sd,r_sum,r_count))
}
r_attrid <- ddply(data1,.(svr_id,date),day_aggre)
day_aggre <- function(df,aggr){
r <- tapply(df$value,df$attrid,function(x)data.frame(mean = mean(x,na.rm = T),sd = sd(x,na.rm = T),
sum = sum(x,na.rm = T),count = sum(!is.na(x))))
return(data.frame(lapply(r,'[[',aggr)))
# r_mean <- data.frame(lapply(r,'[[','aggr'))
# r_sd <- data.frame(lapply(r,'[[','sd'))
# r_sum <- data.frame(lapply(r,'[[','sum'))
# r_count <- data.frame(lapply(r,'[[','count'))
# return(list(r_mean,r_sd,r_sum,r_count))
}
r_mean <- ddply(data1,.(svr_id,date),day_aggre,aggr = 'mean')
View(r_mean)
aggr <- 'mean'
data.frame(lapply(r,'[[',aggr))
View(r_mean)
ncol(r_mean)
coln_mapper <- data.frame(a = paste('X',c(902,903,999,36810:36857),sep=''))
View(coln_mapper)
coln_mapper <- data.frame(a = paste('X',c(902,903,999,36810:36857),sep=''),
b = c('rps','wps','util',paste('iopsr',1:24,sep=''),paste('iopsw',1:24,sep='')))
View(coln_mapper)
df <- r_mean
coln_mapper <- data.frame(a = c('svrid','date',paste('X',c(902,903,999,36810:36857),sep='')),
b = c('svrid','date','rps','wps','util',paste('iopsr',1:24,sep=''),paste('iopsw',1:24,sep='')))
names(df) <- coln_mapper$b[match(names(df),coln_mapper$a)]
View(df)
dif_col <- diff(coln_mapper$a,diff(coln_mapper$a,names(df)))
dif_col <- setdiff(coln_mapper$a,setdiff(coln_mapper$a,names(df)))
setdiff(coln_mapper$a,names(df))
dif_col <- setdiff(coln_mapper$b,setdiff(coln_mapper$b,names(df)))
coln_mapper <- data.frame(a = c('svrid','date',paste('X',c(902,903,999,36810:36857),sep='')),
b = c('svrid','date','rps','wps','util',paste('iopsr',1:24,sep=''),paste('iopsw',1:24,sep='')))
dif_col <- setdiff(coln_mapper$b,setdiff(coln_mapper$b,names(df)))
dif_col
coln_mapper <- data.frame(a = c('svr_id','date',paste('X',c(902,903,999,36810:36857),sep='')),
b = c('svrid','date','rps','wps','util',paste('iopsr',1:24,sep=''),paste('iopsw',1:24,sep='')))
df <- r_mean
names(df) <- coln_mapper$b[match(names(df),coln_mapper$a)]
dif_col <- setdiff(coln_mapper$b,setdiff(coln_mapper$b,names(df)))
order_col <- setdiff(coln_mapper$b,setdiff(coln_mapper$b,names(df)))
df <- df[,order_col]
View(df)
col_sort <- function(df){
names(df) <- coln_mapper$b[match(names(df),coln_mapper$a)]
df[grepl('ps|util|iops',names(df))] <- round(df[grepl('ps|util|iops',names(df))],digits = 4)
order_col <- setdiff(coln_mapper$b,setdiff(coln_mapper$b,names(df)))
df <- df[,order_col]
}
r_mean <- col_sort(ddply(data1,.(svr_id,date),day_aggre,aggr = 'mean'))
View(r_mean)
a <- subset(data,svr_id == '144' & date == 20140726)
a <- subset(data,svr_id == '144' & date == 20140726 & attrid == 36811)
View(a)
day_aggre <- function(df,aggr){
df <- subset(df,!is.na(df$value))
r <- tapply(df$value,df$attrid,function(x)data.frame(mean = mean(x),sd = sd(x),
sum = sum(x),count = sum(!is.na(x))))
return(data.frame(lapply(r,'[[',aggr)))
}
col_sort <- function(df){
names(df) <- coln_mapper$b[match(names(df),coln_mapper$a)]
df[grepl('ps|util|iops',names(df))] <- round(df[grepl('ps|util|iops',names(df))],digits = 4)
order_col <- setdiff(coln_mapper$b,setdiff(coln_mapper$b,names(df)))
df <- df[,order_col]
}
r_mean <- col_sort(ddply(data1,.(svr_id,date),day_aggre,aggr = 'mean'))
View(r_mean)
source('~/Code/R/attrid/sta_201608.R')
rm(list = ls())
source('head.R')
source('iops_clear.R')
library(plyr)
dir_datafile <- '/home/yiyusheng/Data/tencProcess/mergePartSvrid'
fname <- list.files(dir_datafile)
coln_mapper <- data.frame(a = c('svr_id','date',paste('X',c(902,903,999,36810:36857),sep='')),
b = c('svrid','date','rps','wps','util',paste('iopsr',1:24,sep=''),paste('iopsw',1:24,sep='')))
day_aggre <- function(df,aggr){
df <- subset(df,!is.na(df$value))
r <- tapply(df$value,df$attrid,function(x)data.frame(mean = mean(x),sd = sd(x),
sum = sum(x),count = sum(!is.na(x))))
return(data.frame(lapply(r,'[[',aggr)))
}
col_sort <- function(df){
names(df) <- coln_mapper$b[match(names(df),coln_mapper$a)]
df[grepl('ps|util|iops',names(df))] <- round(df[grepl('ps|util|iops',names(df))],digits = 4)
order_col <- setdiff(coln_mapper$b,setdiff(coln_mapper$b,names(df)))
df <- df[,order_col]
}
i = 1
fname[1]
load(file.path(dir_datafile,fname[i]))
data$svr_id <- factor(data$svr_id)
data <- iops_melt_clear(data)
cat(sprintf('[%s]%s:r_sta',date(),fname[i]))
cat(sprintf('[%s]%s:r_sta',date(),fname[i]))
r_sta <- ddply(data,.(svr_id,date),function(df)data.frame(Count = length(df$attrid),numAttrid = length(unique(df$attrid)),fn = fname[i]))
View(r_sta)
cat(sprintf('[%s]%s:r_mean',date(),fname[i]))
r_mean <- col_sort(ddply(data,.(svr_id,date),day_aggre,aggr = 'mean'))
View(r_mean)
a <- data
data <- subset(a,svr_id %in% levels(a$svr_id)[1:10])
cat(sprintf('[%s]%s:r_sta\n',date(),fname[i]))
r_sta <- ddply(data,.(svr_id,date),function(df)data.frame(Count = length(df$attrid),numAttrid = length(unique(df$attrid)),fn = fname[i]))
cat(sprintf('[%s]%s:r_mean\n',date(),fname[i]))
r_mean <- col_sort(ddply(data,.(svr_id,date),day_aggre,aggr = 'mean'))
cat(sprintf('[%s]%s:r_sd\n',date(),fname[i]))
r_sd <- col_sort(ddply(data,.(svr_id,date),day_aggre,aggr = 'sd'))
cat(sprintf('[%s]%s:r_sum\n',date(),fname[i]))
r_sum <- col_sort(ddply(data,.(svr_id,date),day_aggre,aggr = 'sum'))
cat(sprintf('[%s]%s:r_count\n',date(),fname[i]))
r_count <- col_sort(ddply(data,.(svr_id,date),day_aggre,aggr = 'count'))
View(r_sd)
View(r_sum)
