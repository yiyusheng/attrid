ioDura$diff999Bl <- log4neg(ioDura$diff999B)
ioDura$diff902Cl <- log4neg(ioDura$diff902C)
ioDura$diff903Cl <- log4neg(ioDura$diff903C)
ioDura$diff9023Cl <- log4neg(ioDura$diff9023C)
ioDura$diff999Cl <- log4neg(ioDura$diff999C)
meanD902B <- tapply(ioDura$diff902Bl,ioDura$svrid,mean)
maxD902B <- tapply(ioDura$diff902Bl,ioDura$svrid,max)
sdD902B <- tapply(ioDura$diff902Bl,ioDura$svrid,sd)
cvD902B <- tapply(ioDura$diff902Bl,ioDura$svrid,function(x)sd(x)/mean(x))
meanD902C <- tapply(ioDura$diff902Cl,ioDura$svrid,mean)
maxD902C <- tapply(ioDura$diff902Cl,ioDura$svrid,max)
sdD902C <- tapply(ioDura$diff902Cl,ioDura$svrid,sd)
cvD902C <- tapply(ioDura$diff902Cl,ioDura$svrid,function(x)sd(x)/mean(x))
dura902 <- data.frame(svrid = names(meanD902),
meanDA = as.numeric(meanD902A),
maxDA = as.numeric(maxD902A),
sdDA = as.numeric(sdD902A),
cvDA = as.numeric(cvD902)A,
meanDB = as.numeric(meanD902B),
maxDB = as.numeric(maxD902B),
sdDB = as.numeric(sdD902B),
cvDB = as.numeric(cvD902)B,
meanDC = as.numeric(meanD902C),
maxDC = as.numeric(maxD902C),
sdDC = as.numeric(sdD902C),
cvDC = as.numeric(cvD902C))
dura902$cv <- (dura902$cvDA + dura902$cvDB + dura902$cvDC)/3
dura902 <- data.frame(svrid = names(meanD902),
meanDA = as.numeric(meanD902A),
maxDA = as.numeric(maxD902A),
sdDA = as.numeric(sdD902A),
cvDA = as.numeric(cvD902A),
meanDB = as.numeric(meanD902B),
maxDB = as.numeric(maxD902B),
sdDB = as.numeric(sdD902B),
cvDB = as.numeric(cvD902)B,
meanDC = as.numeric(meanD902C),
maxDC = as.numeric(maxD902C),
sdDC = as.numeric(sdD902C),
cvDC = as.numeric(cvD902C))
dura902$cv <- (dura902$cvDA + dura902$cvDB + dura902$cvDC)/3
dura902 <- data.frame(svrid = names(meanD902),
meanDA = as.numeric(meanD902A),
maxDA = as.numeric(maxD902A),
sdDA = as.numeric(sdD902A),
cvDA = as.numeric(cvD902A),
meanDB = as.numeric(meanD902B),
maxDB = as.numeric(maxD902B),
sdDB = as.numeric(sdD902B),
cvDB = as.numeric(cvD902B),
meanDC = as.numeric(meanD902C),
maxDC = as.numeric(maxD902C),
sdDC = as.numeric(sdD902C),
cvDC = as.numeric(cvD902C))
dura902$cv <- (dura902$cvDA + dura902$cvDB + dura902$cvDC)/3
dura902 <- data.frame(svrid = names(meanD902A),
meanDA = as.numeric(meanD902A),
maxDA = as.numeric(maxD902A),
sdDA = as.numeric(sdD902A),
cvDA = as.numeric(cvD902A),
meanDB = as.numeric(meanD902B),
maxDB = as.numeric(maxD902B),
sdDB = as.numeric(sdD902B),
cvDB = as.numeric(cvD902B),
meanDC = as.numeric(meanD902C),
maxDC = as.numeric(maxD902C),
sdDC = as.numeric(sdD902C),
cvDC = as.numeric(cvD902C))
dura902$cv <- (dura902$cvDA + dura902$cvDB + dura902$cvDC)/3
View(dura902)
dura902A <- subset(dura902,!is.na(cvDC),c('cv','cvDA','cvDB','cvDC'))
View(dura902A)
dura902A <- subset(dura902,!is.na(cvDC),c('svrid','cv','cvDA','cvDB','cvDC'))
View(dura902)
View(dura902A)
sidTest <- paste(1:200,levels(data$svrid),sep='_')
load(file.path(dir_data,'freqFieldWatch200.Rda'))
ioDuraTest <- factorX(subset(dura902,svrid %in% levels(data$svrid)))
View(ioDuraTest)
p <- "D:\\Data\\attrid\\FailIOCoarse\\test200-read\\Week"
fname <- list.files(path = p)
fname1 <- gsub('-W.*','',fname)
fname <- data.frame(n1 = fname1,
n2 = gsub('^.*_','',fname1),
n3 = fname)
p <- "D:\\Data\\attrid\\FailIOCoarse\\test200-read\\Week"
fname <- list.files(path = p)
fname1 <- gsub('-W.*','',fname)
fname <- data.frame(n1 = fname1,
n2 = gsub('^.*_','',fname1),
n3 = fname)
ioDuraTest$id <- as.numeric(gsub('_.*','',ioDuraTest$svrid))
View(ioDuraTest)
View(fname)
ioDuraTest$fname <- fname$n1[match(ioDuraTest$svrid,fname$n2)]
ioDuraTest$id <- as.numeric(gsub('_.*','',ioDuraTest$svrid))
ioDuraTest$fname <- fname$n1[match(ioDuraTest$svrid,fname$n1)]
ioDuraTest$id <- as.numeric(gsub('_.*','',ioDuraTest$svrid))
ioDuraTest$svrid <- fname$n1[match(ioDuraTest$svrid,fname$n1)]
ioDuraTest$id <- as.numeric(gsub('_.*','',ioDuraTest$svrid))
ioDuraTest <- ioDuraTest[order(ioDuraTest$cvD,ioDuraTest$id),]
ioDuraTest <- ioDuraTest[order(ioDuraTest$cv,ioDuraTest$id),]
row.names(ioDuraTest) <- NULL
View(ioDuraTest)
ioDuraTest <- factorX(subset(dura902,svrid %in% levels(data$svrid)))
p <- "D:\\Data\\attrid\\FailIOCoarse\\test200-read\\Week"
fname <- list.files(path = p)
fname1 <- gsub('-W.*','',fname)
fname <- data.frame(n1 = fname1,
n2 = gsub('^.*_','',fname1),
n3 = fname)
ioDuraTest$svrid <- fname$n1[match(ioDuraTest$svrid,fname$n1)]
View(ioDuraTest)
ioDuraTest <- factorX(subset(dura902,svrid %in% levels(data$svrid)))
p <- "D:\\Data\\attrid\\FailIOCoarse\\test200-read\\Week"
fname <- list.files(path = p)
fname1 <- gsub('-W.*','',fname)
fname <- data.frame(n1 = fname1,
n2 = gsub('^.*_','',fname1),
n3 = fname)
View(ioDuraTest)
ioDuraTest$svrid <- fname$n1[match(ioDuraTest$svrid,fname$n2)]
ioDuraTest$id <- as.numeric(gsub('_.*','',ioDuraTest$svrid))
ioDuraTest <- ioDuraTest[order(ioDuraTest$cv,ioDuraTest$id),]
# ioDuraTest <- ioDuraTest[order(ioDuraTest$id),]
row.names(ioDuraTest) <- NULL
View(ioDuraTest)
head(meanD902B)
head(meanD902B,1000)
head(as.numeric(meanD902B),1000)
summary(head(as.numeric(meanD902B),1000))
summary(head(as.numeric(sdD902B),1000))
summary(head(as.numeric(cvD902B),1000))
summary(head(as.numeric(cvD902A),1000))
summary(head(as.numeric(cvD902C),1000))
summary(ioDuraTest)
summary(ioDuraTest)
# 测试用
rm(list = ls())
#@@@ CONFIGURE @@@#
source(file.path('D:/Git/attrid','attr_config.R'))
#@@@ Function @@@#
source('D:/Git/R_Function/Rfun.R')
source(file.path(dir_code,'attr_function.R'))
#@@@ LOAD DATA @@@#
load(file.path(dir_data,'freqFieldWatch200.Rda'))
load(file.path(dir_data,'spdUtilSta.Rda'))
a <- split(spdUtilSta,spdUtilSta$class)
str(a)
su902C <- a[['902C']]
View(su902C)
[su9023C,su9023TS,su902C,su902TS,su903C,su903TS] <- split(spdUtilSta,spdUtilSta$class)
list[su9023C,su9023TS,su902C,su902TS,su903C,su903TS] <- split(spdUtilSta,spdUtilSta$class)
View(su9023C)
levels(su9023C$cutA)
ggplot(su9023C,aes(cutA,cut999,size = log2(value))) + geom_point()
View(su9023C)
su9023C <- su9023C[order(su9023C$cutA),]
View(su9023C)
levels(su9023C$cutA)
levels(su9023C$cut999)
source('ioDura.R')
# IO利用率分析，对每台机器的999的值与故障之间的关系进行分析
# 并对9023/999的值进行分析
rm(list = ls())
#@@@ CONFIGURE @@@#
source(file.path('D:/Git/attrid','attr_config.R'))
#@@@ Function @@@#
source('D:/Git/R_Function/Rfun.R')
source(file.path(dir_code,'attr_function.R'))
source(file.path(dir_code,'AFR_io_function.R'))
#@@@ LOAD DATA @@@#
load(file.path(dir_data,'load_ftr_attrid.Rda'))
source(file.path(dir_code,'AFR_io_prepare.R'))
load(file.path(dir_data,'freqFieldWatch200.Rda'))
load(file.path(dir_data,'ioDura_result.Rda'))
divCV <- c(0,0.01*2^(seq(1:8)),Inf)
ioDuraCV <- subset(dura902,,c('svrid','cv'))
names(ioDuraCV) <- c('svrid','cvD902')
ioDuraCV$cvD903 <- dura903$cv[match(ioDuraCV$svrid,dura903$svrid)]
ioDuraCV$cvD999 <- dura999$cv[match(ioDuraCV$svrid,dura999$svrid)]
ioDuraCV$cvD9023 <- dura9023$cv[match(ioDuraCV$svrid,dura9023$svrid)]
ioDuraCV$cut902 <- cut(ioDuraCV$cvD902,divCV,include.lowest = T)
ioDuraCV$cut903 <- cut(ioDuraCV$cvD903,divCV,include.lowest = T)
ioDuraCV$cut9023 <- cut(ioDuraCV$cvD9023,divCV,include.lowest = T)
ioDuraCV$cut999 <- cut(ioDuraCV$cvD999,divCV,include.lowest = T)
ioDuraCV <- factorX(subset(ioDuraCV,!is.na(cvD903) & !is.na(cvD902) & !is.na(cvD999) & !is.na(cvD9023)))
tf <- merge(tmp.f,ioDuraCV,by.x = 'svr_id',by.y = 'svrid')
tcmdb <- merge(tmp.cmdb,ioDuraCV,by.x = 'svr_asset_id',by.y = 'svrid')
tfC <- subset(tf,grepl('C',dClass));tfTS <- subset(tf,grepl('TS',dClass))
tcmdbC <- subset(tcmdb,grepl('C',dClass)); tcmdbTS <- subset(tcmdb,grepl('TS',dClass))
tableX(tcmdbTS$cut902)
ggplot(tcmdbTS,aes(cut902)) + geom_histogram()
ggplot(tcmdbTS,aes(cut903)) + geom_histogram()
ggplot(tcmdbTS,aes(cut9023)) + geom_histogram()
ggplot(tcmdbTS,aes(cut999)) + geom_histogram()
AFR_cvD902C <- AFR_attr_notime(tf,tcmdb,'cut902','cut902',1,dev = 'C')
AFR_cvD903C <- AFR_attr_notime(tf,tcmdb,'cut903','cut903',1,dev = 'C')
AFR_cvD999C <- AFR_attr_notime(tf,tcmdb,'cut999','cut999',1,dev = 'C')
AFR_cvD9023C <- AFR_attr_notime(tf,tcmdb,'cut9023','cut9023',1,dev = 'C')
AFR_cvD902TS <- AFR_attr_notime(tf,tcmdb,'cut902','cut902',12,dev = 'TS')
AFR_cvD903TS <- AFR_attr_notime(tf,tcmdb,'cut903','cut903',12,dev = 'TS')
AFR_cvD999TS <- AFR_attr_notime(tf,tcmdb,'cut999','cut999',12,dev = 'TS')
AFR_cvD9023TS <- AFR_attr_notime(tf,tcmdb,'cut9023','cut9023',12,dev = 'TS')
AFR_cvD902 <- rbind(AFR_cvD902C,AFR_cvD902TS)
AFR_cvD903 <- rbind(AFR_cvD903C,AFR_cvD903TS)
AFR_cvD999 <- rbind(AFR_cvD999C,AFR_cvD999TS)
AFR_cvD9023 <- rbind(AFR_cvD9023C,AFR_cvD9023TS)
View(AFR_cvD902)
ggplot(subset(AFR_cvD902,count_io > 100),aes(item,AFR,fill = class)) +
geom_bar(stat = 'identity',position = 'dodge') + ggtitle(paste(attr,'Mean'))
ggplot(subset(AFR_cvD902,count_io > 100),aes(item,AFR,fill = class)) +
geom_bar(stat = 'identity',position = 'dodge')
ggplot(subset(AFR_cvD903,count_io > 100),aes(item,AFR,fill = class)) +
geom_bar(stat = 'identity',position = 'dodge')
ggplot(subset(AFR_cvD999,count_io > 100),aes(item,AFR,fill = class)) +
geom_bar(stat = 'identity',position = 'dodge')
ggplot(subset(AFR_cvD9023,count_io > 100),aes(item,AFR,fill = class)) +
geom_bar(stat = 'identity',position = 'dodge')
levvels(AFR_cvD902C$item)
levels(AFR_cvD902C$item)
AFR_cvD902C <- item_order(AFR_attr_notime(tf,tcmdb,'cut902','cut902',1,dev = 'C'))
AFR_cvD903C <- item_order(AFR_attr_notime(tf,tcmdb,'cut903','cut903',1,dev = 'C'))
AFR_cvD999C <- item_order(AFR_attr_notime(tf,tcmdb,'cut999','cut999',1,dev = 'C'))
AFR_cvD9023C <- item_order(AFR_attr_notime(tf,tcmdb,'cut9023','cut9023',1,dev = 'C'))
AFR_cvD902TS <- item_order(AFR_attr_notime(tf,tcmdb,'cut902','cut902',12,dev = 'TS'))
AFR_cvD903TS <- item_order(AFR_attr_notime(tf,tcmdb,'cut903','cut903',12,dev = 'TS'))
AFR_cvD999TS <- item_order(AFR_attr_notime(tf,tcmdb,'cut999','cut999',12,dev = 'TS'))
AFR_cvD9023TS <- item_order(AFR_attr_notime(tf,tcmdb,'cut9023','cut9023',12,dev = 'TS'))
AFR_cvD902 <- rbind(AFR_cvD902C,AFR_cvD902TS)
AFR_cvD903 <- rbind(AFR_cvD903C,AFR_cvD903TS)
AFR_cvD999 <- rbind(AFR_cvD999C,AFR_cvD999TS)
AFR_cvD9023 <- rbind(AFR_cvD9023C,AFR_cvD9023TS)
source('D:/Git/attrid/attr_function.R')
AFR_cvD902C <- item_order(AFR_attr_notime(tf,tcmdb,'cut902','cut902',1,dev = 'C'))
AFR_cvD903C <- item_order(AFR_attr_notime(tf,tcmdb,'cut903','cut903',1,dev = 'C'))
AFR_cvD999C <- item_order(AFR_attr_notime(tf,tcmdb,'cut999','cut999',1,dev = 'C'))
AFR_cvD9023C <- item_order(AFR_attr_notime(tf,tcmdb,'cut9023','cut9023',1,dev = 'C'))
AFR_cvD902TS <- item_order(AFR_attr_notime(tf,tcmdb,'cut902','cut902',12,dev = 'TS'))
AFR_cvD903TS <- item_order(AFR_attr_notime(tf,tcmdb,'cut903','cut903',12,dev = 'TS'))
AFR_cvD999TS <- item_order(AFR_attr_notime(tf,tcmdb,'cut999','cut999',12,dev = 'TS'))
AFR_cvD9023TS <- item_order(AFR_attr_notime(tf,tcmdb,'cut9023','cut9023',12,dev = 'TS'))
AFR_cvD902 <- rbind(AFR_cvD902C,AFR_cvD902TS)
AFR_cvD903 <- rbind(AFR_cvD903C,AFR_cvD903TS)
AFR_cvD999 <- rbind(AFR_cvD999C,AFR_cvD999TS)
AFR_cvD9023 <- rbind(AFR_cvD9023C,AFR_cvD9023TS)
ggplot(subset(AFR_cvD902,count_io > 100),aes(item,AFR,fill = class)) +
geom_bar(stat = 'identity',position = 'dodge')
ggplot(subset(AFR_cvD903,count_io > 100),aes(item,AFR,fill = class)) +
geom_bar(stat = 'identity',position = 'dodge')
ggplot(subset(AFR_cvD999,count_io > 100),aes(item,AFR,fill = class)) +
geom_bar(stat = 'identity',position = 'dodge')
View(AFR_cvD999)
ggplot(tcmdbTS,aes(cut999)) + geom_histogram()
ggplot(tcmdbTS,aes(cut902)) + geom_histogram()
ggplot(tcmdbTS,aes(cut903)) + geom_histogram()
ggplot(subset(AFR_cvD902,count_io > 100),aes(item,AFR,fill = class)) +
geom_bar(stat = 'identity',position = 'dodge') +
xlab('Coefficient of Variation of Mean Diff') + ylab('Annual Failure Rate (%)') +
ggtitle('Coefficient of Variation of Mean Diff and AFR') +
guides(fill = guide_legend(title=NULL)) +
theme(axis.text = element_text(size = 18),
axis.title = element_text(size = 20),
legend.text = element_text(size = 30),
legend.title = element_text(size = 20),
plot.title = element_text(size = 26, face = 'bold'),
legend.position = c(0,1),
legend.justification = c(-0.2,1.5),
legend.background = element_rect(fill = alpha('grey',0.5)))
ggplot(subset(AFR_cvD902,count_io > 100),aes(item,AFR,fill = class)) +
geom_bar(stat = 'identity',position = 'dodge') +
xlab('Coefficient of Variation of Mean Diff') + ylab('Annual Failure Rate (%)') +
ggtitle('Coefficient of Variation of Mean Diff and AFR') +
guides(fill = guide_legend(title=NULL)) +
theme(axis.text = element_text(size = 18),
axis.title = element_text(size = 20),
legend.text = element_text(size = 30),
legend.title = element_text(size = 20),
plot.title = element_text(size = 26, face = 'bold'),
legend.position = c(0,1),
legend.justification = c(-0.2,1.5),
legend.background = element_rect(fill = alpha('grey',0.5)))
rm(list = ls())
#@@@ CONFIGURE @@@#
source(file.path('D:/Git/attrid','attr_config.R'))
#@@@ Function @@@#
source('D:/Git/R_Function/Rfun.R')
source(file.path(dir_code,'attr_function.R'))
source(file.path(dir_code,'AFR_io_function.R'))
#@@@ LOAD DATA @@@#
load(file.path(dir_data,'load_ftr_attrid.Rda'))
source(file.path(dir_code,'AFR_io_prepare.R'))
load(file.path(dir_data,'freqFieldWatch200.Rda'))
p1 <- ggplot(subset(AFR_cvD902,count_io > 100),aes(item,AFR,fill = class)) +
geom_bar(stat = 'identity',position = 'dodge') +
xlab('Coefficient of Variation of Mean Read Speed Diff') + ylab('Annual Failure Rate (%)') +
ggtitle('Coefficient of Variation of Mean Read Speed Diff and AFR') +
guides(fill = guide_legend(title=NULL)) +
theme(axis.text = element_text(size = 18),
axis.title = element_text(size = 20),
legend.text = element_text(size = 30),
legend.title = element_text(size = 20),
plot.title = element_text(size = 26, face = 'bold'),
legend.position = c(0,1),
legend.justification = c(-0.2,1.5),
legend.background = element_rect(fill = alpha('grey',0.5)))
p2 <- ggplot(subset(AFR_cvD903,count_io > 100),aes(item,AFR,fill = class)) +
geom_bar(stat = 'identity',position = 'dodge') +
xlab('Coefficient of Variation of Mean Write Speed Diff') + ylab('Annual Failure Rate (%)') +
ggtitle('Coefficient of Variation of Mean Write Speed Diff and AFR') +
guides(fill = guide_legend(title=NULL)) +
theme(axis.text = element_text(size = 18),
axis.title = element_text(size = 20),
legend.text = element_text(size = 30),
legend.title = element_text(size = 20),
plot.title = element_text(size = 26, face = 'bold'),
legend.position = c(0,1),
legend.justification = c(-0.2,1.5),
legend.background = element_rect(fill = alpha('grey',0.5)))
p3 <- ggplot(subset(AFR_cvD999,count_io > 100),aes(item,AFR,fill = class)) +
geom_bar(stat = 'identity',position = 'dodge')+
xlab('Coefficient of Variation of Mean Util Diff') + ylab('Annual Failure Rate (%)') +
ggtitle('Coefficient of Variation of Mean Util Diff and AFR') +
guides(fill = guide_legend(title=NULL)) +
theme(axis.text = element_text(size = 18),
axis.title = element_text(size = 20),
legend.text = element_text(size = 30),
legend.title = element_text(size = 20),
plot.title = element_text(size = 26, face = 'bold'),
legend.position = c(0,1),
legend.justification = c(-0.2,1.5),
legend.background = element_rect(fill = alpha('grey',0.5)))
p4 <- ggplot(subset(AFR_cvD9023,count_io > 100),aes(item,AFR,fill = class)) +
geom_bar(stat = 'identity',position = 'dodge')+
xlab('Coefficient of Variation of Mean Read and Write speed Diff') + ylab('Annual Failure Rate (%)') +
ggtitle('Coefficient of Variation of Mean Read and Write speed Diff and AFR') +
guides(fill = guide_legend(title=NULL)) +
theme(axis.text = element_text(size = 18),
axis.title = element_text(size = 20),
legend.text = element_text(size = 30),
legend.title = element_text(size = 20),
plot.title = element_text(size = 26, face = 'bold'),
legend.position = c(0,1),
legend.justification = c(-0.2,1.5),
legend.background = element_rect(fill = alpha('grey',0.5)))
ggsave(file=file.path(dir_data,'ioDura',paste('Coefficient of Variation of Mean Read Speed Diff and AFR','.png',sep='')),
plot=pp, width = 16, height = 12, dpi = 100)
ggsave(file=file.path(dir_data,'ioDura',paste('Coefficient of Variation of Mean Write Speed Diff and AFR','.png',sep='')),
plot=pp, width = 16, height = 12, dpi = 100)
ggsave(file=file.path(dir_data,'ioDura',paste('Coefficient of Variation of Mean Util Diff and AFR','.png',sep='')),
plot=pp, width = 16, height = 12, dpi = 100)
ggsave(file=file.path(dir_data,'ioDura',paste('Coefficient of Variation of Mean Read and Write speed Diff and AFR','.png',sep='')),
plot=pp, width = 16, height = 12, dpi = 100)
ggsave(file=file.path(dir_data,'ioDura',paste('Coefficient of Variation of Mean Read Speed Diff and AFR','.png',sep='')),
plot=p1, width = 16, height = 12, dpi = 100)
ggsave(file=file.path(dir_data,'ioDura',paste('Coefficient of Variation of Mean Write Speed Diff and AFR','.png',sep='')),
plot=p2, width = 16, height = 12, dpi = 100)
ggsave(file=file.path(dir_data,'ioDura',paste('Coefficient of Variation of Mean Util Diff and AFR','.png',sep='')),
plot=p3, width = 16, height = 12, dpi = 100)
ggsave(file=file.path(dir_data,'ioDura',paste('Coefficient of Variation of Mean Read and Write speed Diff and AFR','.png',sep='')),
plot=p4, width = 16, height = 12, dpi = 100)
p1 <- ggplot(subset(AFR_cvD902,count_io > 100),aes(item,AFR,fill = class)) +
geom_bar(stat = 'identity',position = 'dodge') +
xlab('Coefficient of Variation of Mean Read Speed Diff') + ylab('Annual Failure Rate (%)') +
ggtitle('Coefficient of Variation of Mean Read Speed Diff and AFR') +
guides(fill = guide_legend(title=NULL)) +
theme(axis.text = element_text(size = 18),
axis.title = element_text(size = 20),
legend.text = element_text(size = 30),
legend.title = element_text(size = 20),
plot.title = element_text(size = 26, face = 'bold'),
legend.position = c(0,1),
legend.justification = c(-0.2,1.5),
legend.background = element_rect(fill = alpha('grey',0.5)))
source('D:/Git/attrid/ioDura.R')
rm(list = ls())
#@@@ CONFIGURE @@@#
source(file.path('D:/Git/attrid','attr_config.R'))
#@@@ Function @@@#
source('D:/Git/R_Function/Rfun.R')
source(file.path(dir_code,'attr_function.R'))
source(file.path(dir_code,'AFR_io_function.R'))
#@@@ LOAD DATA @@@#
load(file.path(dir_data,'load_ftr_attrid.Rda'))
source(file.path(dir_code,'AFR_io_prepare.R'))
load(file.path(dir_data,'freqFieldWatch200.Rda'))
load(file.path(dir_data,'ioDura_result.Rda'))
divCV <- c(0,0.01*2^(seq(1:8)),Inf)
ioDuraCV <- subset(dura902,,c('svrid','cv'))
names(ioDuraCV) <- c('svrid','cvD902')
ioDuraCV$cvD903 <- dura903$cv[match(ioDuraCV$svrid,dura903$svrid)]
ioDuraCV$cvD999 <- dura999$cv[match(ioDuraCV$svrid,dura999$svrid)]
ioDuraCV$cvD9023 <- dura9023$cv[match(ioDuraCV$svrid,dura9023$svrid)]
ioDuraCV$cut902 <- cut(ioDuraCV$cvD902,divCV,include.lowest = T)
ioDuraCV$cut903 <- cut(ioDuraCV$cvD903,divCV,include.lowest = T)
ioDuraCV$cut9023 <- cut(ioDuraCV$cvD9023,divCV,include.lowest = T)
ioDuraCV$cut999 <- cut(ioDuraCV$cvD999,divCV,include.lowest = T)
ioDuraCV <- factorX(subset(ioDuraCV,!is.na(cvD903) & !is.na(cvD902) & !is.na(cvD999) & !is.na(cvD9023)))
tf <- merge(tmp.f,ioDuraCV,by.x = 'svr_id',by.y = 'svrid')
tcmdb <- merge(tmp.cmdb,ioDuraCV,by.x = 'svr_asset_id',by.y = 'svrid')
tfC <- subset(tf,grepl('C',dClass));tfTS <- subset(tf,grepl('TS',dClass))
tcmdbC <- subset(tcmdb,grepl('C',dClass)); tcmdbTS <- subset(tcmdb,grepl('TS',dClass))
ggplot(tcmdbTS,aes(cut903)) + geom_histogram()
AFR_cvD902C <- item_order(AFR_attr_notime(tf,tcmdb,'cut902','cut902',1,dev = 'C'))
AFR_cvD903C <- item_order(AFR_attr_notime(tf,tcmdb,'cut903','cut903',1,dev = 'C'))
AFR_cvD999C <- item_order(AFR_attr_notime(tf,tcmdb,'cut999','cut999',1,dev = 'C'))
AFR_cvD9023C <- item_order(AFR_attr_notime(tf,tcmdb,'cut9023','cut9023',1,dev = 'C'))
AFR_cvD902TS <- item_order(AFR_attr_notime(tf,tcmdb,'cut902','cut902',12,dev = 'TS'))
AFR_cvD903TS <- item_order(AFR_attr_notime(tf,tcmdb,'cut903','cut903',12,dev = 'TS'))
AFR_cvD999TS <- item_order(AFR_attr_notime(tf,tcmdb,'cut999','cut999',12,dev = 'TS'))
AFR_cvD9023TS <- item_order(AFR_attr_notime(tf,tcmdb,'cut9023','cut9023',12,dev = 'TS'))
AFR_cvD902 <- rbind(AFR_cvD902C,AFR_cvD902TS)
AFR_cvD903 <- rbind(AFR_cvD903C,AFR_cvD903TS)
AFR_cvD999 <- rbind(AFR_cvD999C,AFR_cvD999TS)
AFR_cvD9023 <- rbind(AFR_cvD9023C,AFR_cvD9023TS)
View(AFR_cvD999)
View(AFR_cvD9023)
# 测试用
rm(list = ls())
#@@@ CONFIGURE @@@#
source(file.path('D:/Git/attrid','attr_config.R'))
#@@@ Function @@@#
source('D:/Git/R_Function/Rfun.R')
source(file.path(dir_code,'attr_function.R'))
#@@@ LOAD DATA @@@#
load(file.path(dir_data,'freqFieldWatch200.Rda'))
load(file.path(dir_data,'failIO.Rda'))
svrCount <- tapply(failIO$svrid,factor(failIO$svrid),length)
svr902 <- tapply(failIO$a902,factor(failIO$svrid),)
svrCount <- data.frame(svrid = names(svrCount),count = as.numeric(svrCount))
data <- subset(failIO,svrid %in% sample(svrCount$svrid[svrCount$count == 17280 & quantile(a902,0.5) > 0],1000))
data <- factorX(data)
row.names(data) <- NULL
save(data,file = file.path(dir_data,'freqFieldWatch1k.Rda'))
View(svrCount)
length(svrCount$count == 17280)
length(sum(svrCount$count == 17280))
sum(svrCount$count == 17280)
data <- subset(failIO,svrid %in% sample(svrCount$svrid[svrCount$count == 17280 & quantile(a902,0.5) > 0],700))
data <- factorX(data)
row.names(data) <- NULL
save(data,file = file.path(dir_data,'freqFieldWatch1k.Rda'))
save(data,file = file.path(dir_data,'freqFieldWatch700.Rda'))
# 测试用
rm(list = ls())
#@@@ CONFIGURE @@@#
source(file.path('D:/Git/attrid','attr_config.R'))
#@@@ Function @@@#
source('D:/Git/R_Function/Rfun.R')
source(file.path(dir_code,'attr_function.R'))
#@@@ LOAD DATA @@@#
load(file.path(dir_data,'freqFieldWatch200.Rda'))
# load(file.path(dir_data,'load_ftr_attrid.Rda'))
a <- subset(data,svrid %in% levels(data$svrid)[1])
ggplot(a) + geom_histogram(aes(x = a902))
ggplot(a) + geom_histogram(aes(x = log2(a902)))
ggplot(a) + geom_histogram(aes(x = log2(a903)))
ggplot(a) + geom_histogram(aes(x = log2(a999)))
ggplot(a) + geom_histogram(aes(x = log2(a9023)))
a <- subset(data,svrid %in% levels(data$svrid)[3])
ggplot(a) + geom_histogram(aes(x = log2(a902)))
ggplot(a) + geom_histogram(aes(x = log2(a903)))
ggplot(a) + geom_histogram(aes(x = log2(a99)))
ggplot(a) + geom_histogram(aes(x = log2(a999)))
load(file.path(dir_data,'ioFeature.Rda'))
# IO利用率分析，对每台机器的999的值与故障之间的关系进行分析
# 并对9023/999的值进行分析
rm(list = ls())
#@@@ CONFIGURE @@@#
source(file.path('D:/Git/attrid','attr_config.R'))
#@@@ Function @@@#
source('D:/Git/R_Function/Rfun.R')
source(file.path(dir_code,'attr_function.R'))
source(file.path(dir_code,'AFR_io_function.R'))
#@@@ LOAD DATA @@@#
load(file.path(dir_data,'load_ftr_attrid.Rda'))
source(file.path(dir_code,'AFR_io_prepare.R'))
load(file.path(dir_data,'ioFeature.Rda'))
load(file.path(dir_data,'ioUtilMax.Rda'))
ioFtr$cvUtil <- ioFtr$sdUtil/ioFtr$meanUtil
ioFtr <- ioUtilMax
x <- 'max';attr <- paste(x,'Util',sep='')
attr <- 'maxUtil'
ioF <- factorX(subset(ioFtr,svrid %in% tmp.cmdb$svr_asset_id,c('svrid',attr)))
load(file.path(dir_data,'ioFeature.Rda'))
ioFtr$cvUtil <- ioFtr$sdUtil/ioFtr$meanUtil
# ioFtr <- ioUtilMax
x <- 'max';attr <- paste(x,'Util',sep='')
attr <- 'maxUtil'
ioF <- factorX(subset(ioFtr,svrid %in% tmp.cmdb$svr_asset_id,c('svrid',attr)))
names(ioF) <- c('svrid','attr')
meanU <- tapply(ioF$attr,ioF$svrid,mean)
maxU <- tapply(ioF$attr,ioF$svrid,max)
maxtopU <- tapply(ioF$attr,ioF$svrid,function(x){x <- sort(x,decreasing = T);mean(x[1:10])})
divU <- c(-1,0,1,2,3,6,12,60,120,288)
staU <- data.frame(svrid = names(meanU),
meanoU = as.numeric(meanU),
maxoU = as.numeric(maxU),
maxtopoU = as.numeric(maxtopU),
meanU = cut(as.numeric(meanU),divU,include.lowest = T),
maxU = cut(as.numeric(maxU),divU,include.lowest = T),
maxtopU = cut(as.numeric(maxtopU),divU,include.lowest = T))
tf <- merge(tmp.f,staU,by.x = 'svr_id',by.y = 'svrid')
tcmdb <- merge(tmp.cmdb,staU,by.x = 'svr_asset_id',by.y = 'svrid')
tfC <- subset(tf,grepl('C',dClass));tfTS <- subset(tf,grepl('TS',dClass))
tcmdbC <- subset(tcmdb,grepl('C',dClass)); tcmdbTS <- subset(tcmdb,grepl('TS',dClass))
busyBound <- 98
busyPerc <- data.frame(lowerC = nrow(tfC[tfC$maxoU < busyBound,])/nrow(tcmdbC[tcmdbC$maxoU < busyBound,])*6*100,
higherC = nrow(tfC[tfC$maxoU >= busyBound,])/nrow(tcmdbC[tcmdbC$maxoU >= busyBound,])*6*100,
lowerTS = nrow(tfTS[tfTS$maxoU < busyBound,])/nrow(tcmdbTS[tcmdbTS$maxoU < busyBound,])/12*6*100,
higherTS = nrow(tfTS[tfTS$maxoU >= busyBound,])/nrow(tcmdbTS[tcmdbTS$maxoU >= busyBound,])/12*6*100)
View(busyPerc)
