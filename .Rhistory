maxU <- tapply(ioF$attr,ioF$svrid,max)
maxtopU <- tapply(ioF$attr,ioF$svrid,function(x){x <- sort(x,decreasing = T);mean(x[1:10])})
divU <- c(0:10,50,100)
staU <- data.frame(svrid = names(meanU),
meanU = cut(as.numeric(meanU),divU,include.lowest = T),
maxU = cut(as.numeric(maxU),divU,include.lowest = T),
maxtopU = cut(as.numeric(maxtopU),divU,include.lowest = T))
tf <- merge(tmp.f,staU,by.x = 'svr_id',by.y = 'svrid')
tcmdb <- merge(tmp.cmdb,staU,by.x = 'svr_asset_id',by.y = 'svrid')
AFR_meanUC <- item_order(AFR_attr_notime(tf,tcmdb,'meanU','meanU',1,dev = 'C'))
AFR_maxUC <- item_order(AFR_attr_notime(tf,tcmdb,'maxU','maxU',1,dev = 'C'))
AFR_maxtopUC <- item_order(AFR_attr_notime(tf,tcmdb,'maxtopU','maxtopU',1,dev = 'C'))
p1 <- ggplot(subset(AFR_meanUC,count_io > 100),aes(item,log2(AFR))) + geom_bar(stat = 'identity')
p2 <- ggplot(subset(AFR_maxUC,count_io > 100),aes(item,log2(AFR))) + geom_bar(stat = 'identity')
p3 <- ggplot(subset(AFR_maxtopUC,count_io > 100),aes(item,log2(AFR))) + geom_bar(stat = 'identity')
multiplot(p1,p2,p3,col = 1)
attr <- paste('q50','Util',sep='')
ioF <- factorX(subset(ioFtr,svrid %in% tcmdb$svr_asset_id,c('svrid',attr)))
names(ioF) <- c('svrid','attr')
meanU <- tapply(ioF$attr,ioF$svrid,mean)
maxU <- tapply(ioF$attr,ioF$svrid,max)
maxtopU <- tapply(ioF$attr,ioF$svrid,function(x){x <- sort(x,decreasing = T);mean(x[1:10])})
divU <- c(0:10,50,100)
staU <- data.frame(svrid = names(meanU),
meanU = cut(as.numeric(meanU),divU,include.lowest = T),
maxU = cut(as.numeric(maxU),divU,include.lowest = T),
maxtopU = cut(as.numeric(maxtopU),divU,include.lowest = T))
tf <- merge(tmp.f,staU,by.x = 'svr_id',by.y = 'svrid')
tcmdb <- merge(tmp.cmdb,staU,by.x = 'svr_asset_id',by.y = 'svrid')
AFR_meanUC <- item_order(AFR_attr_notime(tf,tcmdb,'meanU','meanU',1,dev = 'C'))
AFR_maxUC <- item_order(AFR_attr_notime(tf,tcmdb,'maxU','maxU',1,dev = 'C'))
AFR_maxtopUC <- item_order(AFR_attr_notime(tf,tcmdb,'maxtopU','maxtopU',1,dev = 'C'))
p1 <- ggplot(subset(AFR_meanUC,count_io > 100),aes(item,log2(AFR))) + geom_bar(stat = 'identity')
p2 <- ggplot(subset(AFR_maxUC,count_io > 100),aes(item,log2(AFR))) + geom_bar(stat = 'identity')
p3 <- ggplot(subset(AFR_maxtopUC,count_io > 100),aes(item,log2(AFR))) + geom_bar(stat = 'identity')
multiplot(p1,p2,p3,col = 1)
print(p1)
print(p2)
print(p3)
ioFtr$cvUtil <- ioFtr$sdUtil/ioFtr$meanUtil
sapply(c('min','q25','q50','mean','q75','max','sd','cv'),function(x){
attr <- paste('q50','Util',sep='')
ioF <- factorX(subset(ioFtr,svrid %in% tcmdb$svr_asset_id,c('svrid',attr)))
names(ioF) <- c('svrid','attr')
meanU <- tapply(ioF$attr,ioF$svrid,mean)
maxU <- tapply(ioF$attr,ioF$svrid,max)
maxtopU <- tapply(ioF$attr,ioF$svrid,function(x){x <- sort(x,decreasing = T);mean(x[1:10])})
divU <- c(0:10,50,100)
staU <- data.frame(svrid = names(meanU),
meanU = cut(as.numeric(meanU),divU,include.lowest = T),
maxU = cut(as.numeric(maxU),divU,include.lowest = T),
maxtopU = cut(as.numeric(maxtopU),divU,include.lowest = T))
tf <- merge(tmp.f,staU,by.x = 'svr_id',by.y = 'svrid')
tcmdb <- merge(tmp.cmdb,staU,by.x = 'svr_asset_id',by.y = 'svrid')
AFR_meanUC <- item_order(AFR_attr_notime(tf,tcmdb,'meanU','meanU',1,dev = 'C'))
AFR_maxUC <- item_order(AFR_attr_notime(tf,tcmdb,'maxU','maxU',1,dev = 'C'))
AFR_maxtopUC <- item_order(AFR_attr_notime(tf,tcmdb,'maxtopU','maxtopU',1,dev = 'C'))
p1 <- ggplot(subset(AFR_meanUC,count_io > 100),aes(item,log2(AFR))) + geom_bar(stat = 'identity')
p2 <- ggplot(subset(AFR_maxUC,count_io > 100),aes(item,log2(AFR))) + geom_bar(stat = 'identity')
p3 <- ggplot(subset(AFR_maxtopUC,count_io > 100),aes(item,log2(AFR))) + geom_bar(stat = 'identity')
ggsave(file=file.path(dir_data,'ioUtil',paste(attr,'Mean','.png',sep='')),
plot=p1, width = 16, height = 12, dpi = 100)
ggsave(file=file.path(dir_data,'ioUtil',paste(attr,'Max','.png',sep='')),
plot=p2, width = 16, height = 12, dpi = 100)
ggsave(file=file.path(dir_data,'ioUtil',paste(attr,'Maxtop','.png',sep='')),
plot=p3, width = 16, height = 12, dpi = 100)
})
sapply(c('min','q25','q50','mean','q75','max','sd','cv'),function(x){
attr <- paste('q50','Util',sep='')
ioF <- factorX(subset(ioFtr,svrid %in% tcmdb$svr_asset_id,c('svrid',attr)))
names(ioF) <- c('svrid','attr')
meanU <- tapply(ioF$attr,ioF$svrid,mean)
maxU <- tapply(ioF$attr,ioF$svrid,max)
maxtopU <- tapply(ioF$attr,ioF$svrid,function(x){x <- sort(x,decreasing = T);mean(x[1:10])})
divU <- c(0:10,50,100)
staU <- data.frame(svrid = names(meanU),
meanU = cut(as.numeric(meanU),divU,include.lowest = T),
maxU = cut(as.numeric(maxU),divU,include.lowest = T),
maxtopU = cut(as.numeric(maxtopU),divU,include.lowest = T))
tf <- merge(tmp.f,staU,by.x = 'svr_id',by.y = 'svrid')
tcmdb <- merge(tmp.cmdb,staU,by.x = 'svr_asset_id',by.y = 'svrid')
AFR_meanUC <- item_order(AFR_attr_notime(tf,tcmdb,'meanU','meanU',1,dev = 'C'))
AFR_maxUC <- item_order(AFR_attr_notime(tf,tcmdb,'maxU','maxU',1,dev = 'C'))
AFR_maxtopUC <- item_order(AFR_attr_notime(tf,tcmdb,'maxtopU','maxtopU',1,dev = 'C'))
p1 <- ggplot(subset(AFR_meanUC,count_io > 100),aes(item,log2(AFR))) + geom_bar(stat = 'identity') +
title(paste(attr,'Mean'))
p2 <- ggplot(subset(AFR_maxUC,count_io > 100),aes(item,log2(AFR))) + geom_bar(stat = 'identity') +
title(paste(attr,'Max'))
p3 <- ggplot(subset(AFR_maxtopUC,count_io > 100),aes(item,log2(AFR))) + geom_bar(stat = 'identity') +
title(paste(attr,'Maxtop'))
ggsave(file=file.path(dir_data,'ioUtil',paste(attr,'Mean','.png',sep='')),
plot=p1, width = 16, height = 12, dpi = 100)
ggsave(file=file.path(dir_data,'ioUtil',paste(attr,'Max','.png',sep='')),
plot=p2, width = 16, height = 12, dpi = 100)
ggsave(file=file.path(dir_data,'ioUtil',paste(attr,'Maxtop','.png',sep='')),
plot=p3, width = 16, height = 12, dpi = 100)
})
sapply(c('min','q25','q50','mean','q75','max','sd','cv'),function(x){
attr <- paste('q50','Util',sep='')
ioF <- factorX(subset(ioFtr,svrid %in% tcmdb$svr_asset_id,c('svrid',attr)))
names(ioF) <- c('svrid','attr')
meanU <- tapply(ioF$attr,ioF$svrid,mean)
maxU <- tapply(ioF$attr,ioF$svrid,max)
maxtopU <- tapply(ioF$attr,ioF$svrid,function(x){x <- sort(x,decreasing = T);mean(x[1:10])})
divU <- c(0:10,50,100)
staU <- data.frame(svrid = names(meanU),
meanU = cut(as.numeric(meanU),divU,include.lowest = T),
maxU = cut(as.numeric(maxU),divU,include.lowest = T),
maxtopU = cut(as.numeric(maxtopU),divU,include.lowest = T))
tf <- merge(tmp.f,staU,by.x = 'svr_id',by.y = 'svrid')
tcmdb <- merge(tmp.cmdb,staU,by.x = 'svr_asset_id',by.y = 'svrid')
AFR_meanUC <- item_order(AFR_attr_notime(tf,tcmdb,'meanU','meanU',1,dev = 'C'))
AFR_maxUC <- item_order(AFR_attr_notime(tf,tcmdb,'maxU','maxU',1,dev = 'C'))
AFR_maxtopUC <- item_order(AFR_attr_notime(tf,tcmdb,'maxtopU','maxtopU',1,dev = 'C'))
p1 <- ggplot(subset(AFR_meanUC,count_io > 100),aes(item,log2(AFR))) + geom_bar(stat = 'identity') +
ggtitle(paste(attr,'Mean'))
p2 <- ggplot(subset(AFR_maxUC,count_io > 100),aes(item,log2(AFR))) + geom_bar(stat = 'identity') +
ggtitle(paste(attr,'Max'))
p3 <- ggplot(subset(AFR_maxtopUC,count_io > 100),aes(item,log2(AFR))) + geom_bar(stat = 'identity') +
ggtitle(paste(attr,'Maxtop'))
ggsave(file=file.path(dir_data,'ioUtil',paste(attr,'Mean','.png',sep='')),
plot=p1, width = 16, height = 12, dpi = 100)
ggsave(file=file.path(dir_data,'ioUtil',paste(attr,'Max','.png',sep='')),
plot=p2, width = 16, height = 12, dpi = 100)
ggsave(file=file.path(dir_data,'ioUtil',paste(attr,'Maxtop','.png',sep='')),
plot=p3, width = 16, height = 12, dpi = 100)
})
attr <- paste('q50','Util',sep='')
sapply(c('min','q25','q50','mean','q75','max','sd','cv'),function(x){
attr <- paste(x,'Util',sep='')
ioF <- factorX(subset(ioFtr,svrid %in% tcmdb$svr_asset_id,c('svrid',attr)))
names(ioF) <- c('svrid','attr')
meanU <- tapply(ioF$attr,ioF$svrid,mean)
maxU <- tapply(ioF$attr,ioF$svrid,max)
maxtopU <- tapply(ioF$attr,ioF$svrid,function(x){x <- sort(x,decreasing = T);mean(x[1:10])})
divU <- c(0:10,50,100)
staU <- data.frame(svrid = names(meanU),
meanU = cut(as.numeric(meanU),divU,include.lowest = T),
maxU = cut(as.numeric(maxU),divU,include.lowest = T),
maxtopU = cut(as.numeric(maxtopU),divU,include.lowest = T))
tf <- merge(tmp.f,staU,by.x = 'svr_id',by.y = 'svrid')
tcmdb <- merge(tmp.cmdb,staU,by.x = 'svr_asset_id',by.y = 'svrid')
AFR_meanUC <- item_order(AFR_attr_notime(tf,tcmdb,'meanU','meanU',1,dev = 'C'))
AFR_maxUC <- item_order(AFR_attr_notime(tf,tcmdb,'maxU','maxU',1,dev = 'C'))
AFR_maxtopUC <- item_order(AFR_attr_notime(tf,tcmdb,'maxtopU','maxtopU',1,dev = 'C'))
p1 <- ggplot(subset(AFR_meanUC,count_io > 100),aes(item,log2(AFR))) + geom_bar(stat = 'identity') +
ggtitle(paste(attr,'Mean'))
p2 <- ggplot(subset(AFR_maxUC,count_io > 100),aes(item,log2(AFR))) + geom_bar(stat = 'identity') +
ggtitle(paste(attr,'Max'))
p3 <- ggplot(subset(AFR_maxtopUC,count_io > 100),aes(item,log2(AFR))) + geom_bar(stat = 'identity') +
ggtitle(paste(attr,'Maxtop'))
ggsave(file=file.path(dir_data,'ioUtil',paste(attr,'Mean','.png',sep='')),
plot=p1, width = 16, height = 12, dpi = 100)
ggsave(file=file.path(dir_data,'ioUtil',paste(attr,'Max','.png',sep='')),
plot=p2, width = 16, height = 12, dpi = 100)
ggsave(file=file.path(dir_data,'ioUtil',paste(attr,'Maxtop','.png',sep='')),
plot=p3, width = 16, height = 12, dpi = 100)
})
View(AFR_maxUC)
View(AFR_meanUC)
View(AFR_maxUC)
AFR_meanU <- rbind(AFR_meanUC,AFR_meanUTS)
AFR_meanUTS <- item_order(AFR_attr_notime(tf,tcmdb,'meanU','meanU',12,dev = 'TS'))
AFR_maxUTS <- item_order(AFR_attr_notime(tf,tcmdb,'maxU','maxU',12,dev = 'TS'))
AFR_maxtopUTS <- item_order(AFR_attr_notime(tf,tcmdb,'maxtopU','maxtopU',12,dev = 'TS'))
AFR_meanU <- rbind(AFR_meanUC,AFR_meanUTS)
View(AFR_meanU)
ggplot(subset(AFR_meanU,count_io > 100),aes(item,log2(AFR),fill = 'class')) +
geom_bar(stat = 'identity',position = 'dodge') + ggtitle(paste(attr,'Mean'))
p1 <- ggplot(subset(AFR_meanU,count_io > 100),aes(item,log2(AFR),fill = class)) +
geom_bar(stat = 'identity',position = 'dodge') + ggtitle(paste(attr,'Mean'))
ggplot(subset(AFR_meanU,count_io > 100),aes(item,log2(AFR),fill = class)) +
geom_bar(stat = 'identity',position = 'dodge') + ggtitle(paste(attr,'Mean'))
AFR_meanUC <- item_order(AFR_attr_notime(tf,tcmdb,'meanU','meanU',1,dev = 'C'))
AFR_maxUC <- item_order(AFR_attr_notime(tf,tcmdb,'maxU','maxU',1,dev = 'C'))
AFR_maxtopUC <- item_order(AFR_attr_notime(tf,tcmdb,'maxtopU','maxtopU',1,dev = 'C'))
AFR_meanUTS <- item_order(AFR_attr_notime(tf,tcmdb,'meanU','meanU',12,dev = 'TS'))
AFR_maxUTS <- item_order(AFR_attr_notime(tf,tcmdb,'maxU','maxU',12,dev = 'TS'))
AFR_maxtopUTS <- item_order(AFR_attr_notime(tf,tcmdb,'maxtopU','maxtopU',12,dev = 'TS'))
AFR_meanU <- rbind(AFR_meanUC,AFR_meanUTS)
AFR_maxU <- rbind(AFR_maxUC,AFR_maxUTS)
AFR_maxtopU <- rbind(AFR_maxtopUC,AFR_maxtopUTS)
p1 <- ggplot(subset(AFR_meanU,count_io > 100),aes(item,log2(AFR),fill = class)) +
geom_bar(stat = 'identity',position = 'dodge') + ggtitle(paste(attr,'Mean'))
p2 <- ggplot(subset(AFR_maxU,count_io > 100),aes(item,log2(AFR),fill = class)) +
geom_bar(stat = 'identity',position = 'dodge') + ggtitle(paste(attr,'Max'))
p3 <- ggplot(subset(AFR_maxtopU,count_io > 100),aes(item,log2(AFR),fill = class)) +
geom_bar(stat = 'identity',position = 'dodge') + ggtitle(paste(attr,'Maxtop'))
print(p1)
print(p2)
print(p3)
sapply(c('min','q25','q50','mean','q75','max','sd','cv'),function(x){
attr <- paste(x,'Util',sep='')
ioF <- factorX(subset(ioFtr,svrid %in% tcmdb$svr_asset_id,c('svrid',attr)))
names(ioF) <- c('svrid','attr')
meanU <- tapply(ioF$attr,ioF$svrid,mean)
maxU <- tapply(ioF$attr,ioF$svrid,max)
maxtopU <- tapply(ioF$attr,ioF$svrid,function(x){x <- sort(x,decreasing = T);mean(x[1:10])})
divU <- c(0:10,50,100)
staU <- data.frame(svrid = names(meanU),
meanU = cut(as.numeric(meanU),divU,include.lowest = T),
maxU = cut(as.numeric(maxU),divU,include.lowest = T),
maxtopU = cut(as.numeric(maxtopU),divU,include.lowest = T))
tf <- merge(tmp.f,staU,by.x = 'svr_id',by.y = 'svrid')
tcmdb <- merge(tmp.cmdb,staU,by.x = 'svr_asset_id',by.y = 'svrid')
AFR_meanUC <- item_order(AFR_attr_notime(tf,tcmdb,'meanU','meanU',1,dev = 'C'))
AFR_maxUC <- item_order(AFR_attr_notime(tf,tcmdb,'maxU','maxU',1,dev = 'C'))
AFR_maxtopUC <- item_order(AFR_attr_notime(tf,tcmdb,'maxtopU','maxtopU',1,dev = 'C'))
AFR_meanUTS <- item_order(AFR_attr_notime(tf,tcmdb,'meanU','meanU',12,dev = 'TS'))
AFR_maxUTS <- item_order(AFR_attr_notime(tf,tcmdb,'maxU','maxU',12,dev = 'TS'))
AFR_maxtopUTS <- item_order(AFR_attr_notime(tf,tcmdb,'maxtopU','maxtopU',12,dev = 'TS'))
AFR_meanU <- rbind(AFR_meanUC,AFR_meanUTS)
AFR_maxU <- rbind(AFR_maxUC,AFR_maxUTS)
AFR_maxtopU <- rbind(AFR_maxtopUC,AFR_maxtopUTS)
p1 <- ggplot(subset(AFR_meanU,count_io > 100),aes(item,log2(AFR),fill = class)) +
geom_bar(stat = 'identity',position = 'dodge') + ggtitle(paste(attr,'Mean'))
p2 <- ggplot(subset(AFR_maxU,count_io > 100),aes(item,log2(AFR),fill = class)) +
geom_bar(stat = 'identity',position = 'dodge') + ggtitle(paste(attr,'Max'))
p3 <- ggplot(subset(AFR_maxtopU,count_io > 100),aes(item,log2(AFR),fill = class)) +
geom_bar(stat = 'identity',position = 'dodge') + ggtitle(paste(attr,'Maxtop'))
ggsave(file=file.path(dir_data,'ioUtil',paste(attr,'Mean','.png',sep='')),
plot=p1, width = 16, height = 12, dpi = 100)
ggsave(file=file.path(dir_data,'ioUtil',paste(attr,'Max','.png',sep='')),
plot=p2, width = 16, height = 12, dpi = 100)
ggsave(file=file.path(dir_data,'ioUtil',paste(attr,'Maxtop','.png',sep='')),
plot=p3, width = 16, height = 12, dpi = 100)
})
r <- sapply(c('min','q25','q50','mean','q75','max','sd','cv'),function(x){
attr <- paste(x,'Util',sep='')
ioF <- factorX(subset(ioFtr,svrid %in% tcmdb$svr_asset_id,c('svrid',attr)))
names(ioF) <- c('svrid','attr')
meanU <- tapply(ioF$attr,ioF$svrid,mean)
maxU <- tapply(ioF$attr,ioF$svrid,max)
maxtopU <- tapply(ioF$attr,ioF$svrid,function(x){x <- sort(x,decreasing = T);mean(x[1:10])})
divU <- c(0:10,50,100)
staU <- data.frame(svrid = names(meanU),
meanU = cut(as.numeric(meanU),divU,include.lowest = T),
maxU = cut(as.numeric(maxU),divU,include.lowest = T),
maxtopU = cut(as.numeric(maxtopU),divU,include.lowest = T))
tf <- merge(tmp.f,staU,by.x = 'svr_id',by.y = 'svrid')
tcmdb <- merge(tmp.cmdb,staU,by.x = 'svr_asset_id',by.y = 'svrid')
AFR_meanUC <- item_order(AFR_attr_notime(tf,tcmdb,'meanU','meanU',1,dev = 'C'))
AFR_maxUC <- item_order(AFR_attr_notime(tf,tcmdb,'maxU','maxU',1,dev = 'C'))
AFR_maxtopUC <- item_order(AFR_attr_notime(tf,tcmdb,'maxtopU','maxtopU',1,dev = 'C'))
AFR_meanUTS <- item_order(AFR_attr_notime(tf,tcmdb,'meanU','meanU',12,dev = 'TS'))
AFR_maxUTS <- item_order(AFR_attr_notime(tf,tcmdb,'maxU','maxU',12,dev = 'TS'))
AFR_maxtopUTS <- item_order(AFR_attr_notime(tf,tcmdb,'maxtopU','maxtopU',12,dev = 'TS'))
AFR_meanU <- rbind(AFR_meanUC,AFR_meanUTS)
AFR_maxU <- rbind(AFR_maxUC,AFR_maxUTS)
AFR_maxtopU <- rbind(AFR_maxtopUC,AFR_maxtopUTS)
p1 <- ggplot(subset(AFR_meanU,count_io > 100),aes(item,log2(AFR),fill = class)) +
geom_bar(stat = 'identity',position = 'dodge') + ggtitle(paste(attr,'Mean'))
p2 <- ggplot(subset(AFR_maxU,count_io > 100),aes(item,log2(AFR),fill = class)) +
geom_bar(stat = 'identity',position = 'dodge') + ggtitle(paste(attr,'Max'))
p3 <- ggplot(subset(AFR_maxtopU,count_io > 100),aes(item,log2(AFR),fill = class)) +
geom_bar(stat = 'identity',position = 'dodge') + ggtitle(paste(attr,'Maxtop'))
ggsave(file=file.path(dir_data,'ioUtil',paste(attr,'Mean','.png',sep='')),
plot=p1, width = 16, height = 12, dpi = 100)
ggsave(file=file.path(dir_data,'ioUtil',paste(attr,'Max','.png',sep='')),
plot=p2, width = 16, height = 12, dpi = 100)
ggsave(file=file.path(dir_data,'ioUtil',paste(attr,'Maxtop','.png',sep='')),
plot=p3, width = 16, height = 12, dpi = 100)
return(AFR_meanU,AFR_maxU,AFR_maxtopU)
})
r <- sapply(c('min','q25','q50','mean','q75','max','sd','cv'),function(x){
attr <- paste(x,'Util',sep='')
ioF <- factorX(subset(ioFtr,svrid %in% tcmdb$svr_asset_id,c('svrid',attr)))
names(ioF) <- c('svrid','attr')
meanU <- tapply(ioF$attr,ioF$svrid,mean)
maxU <- tapply(ioF$attr,ioF$svrid,max)
maxtopU <- tapply(ioF$attr,ioF$svrid,function(x){x <- sort(x,decreasing = T);mean(x[1:10])})
divU <- c(0:10,50,100)
staU <- data.frame(svrid = names(meanU),
meanU = cut(as.numeric(meanU),divU,include.lowest = T),
maxU = cut(as.numeric(maxU),divU,include.lowest = T),
maxtopU = cut(as.numeric(maxtopU),divU,include.lowest = T))
tf <- merge(tmp.f,staU,by.x = 'svr_id',by.y = 'svrid')
tcmdb <- merge(tmp.cmdb,staU,by.x = 'svr_asset_id',by.y = 'svrid')
AFR_meanUC <- item_order(AFR_attr_notime(tf,tcmdb,'meanU','meanU',1,dev = 'C'))
AFR_maxUC <- item_order(AFR_attr_notime(tf,tcmdb,'maxU','maxU',1,dev = 'C'))
AFR_maxtopUC <- item_order(AFR_attr_notime(tf,tcmdb,'maxtopU','maxtopU',1,dev = 'C'))
AFR_meanUTS <- item_order(AFR_attr_notime(tf,tcmdb,'meanU','meanU',12,dev = 'TS'))
AFR_maxUTS <- item_order(AFR_attr_notime(tf,tcmdb,'maxU','maxU',12,dev = 'TS'))
AFR_maxtopUTS <- item_order(AFR_attr_notime(tf,tcmdb,'maxtopU','maxtopU',12,dev = 'TS'))
AFR_meanU <- rbind(AFR_meanUC,AFR_meanUTS)
AFR_maxU <- rbind(AFR_maxUC,AFR_maxUTS)
AFR_maxtopU <- rbind(AFR_maxtopUC,AFR_maxtopUTS)
p1 <- ggplot(subset(AFR_meanU,count_io > 100),aes(item,log2(AFR),fill = class)) +
geom_bar(stat = 'identity',position = 'dodge') + ggtitle(paste(attr,'Mean'))
p2 <- ggplot(subset(AFR_maxU,count_io > 100),aes(item,log2(AFR),fill = class)) +
geom_bar(stat = 'identity',position = 'dodge') + ggtitle(paste(attr,'Max'))
p3 <- ggplot(subset(AFR_maxtopU,count_io > 100),aes(item,log2(AFR),fill = class)) +
geom_bar(stat = 'identity',position = 'dodge') + ggtitle(paste(attr,'Maxtop'))
ggsave(file=file.path(dir_data,'ioUtil',paste(attr,'Mean','.png',sep='')),
plot=p1, width = 16, height = 12, dpi = 100)
ggsave(file=file.path(dir_data,'ioUtil',paste(attr,'Max','.png',sep='')),
plot=p2, width = 16, height = 12, dpi = 100)
ggsave(file=file.path(dir_data,'ioUtil',paste(attr,'Maxtop','.png',sep='')),
plot=p3, width = 16, height = 12, dpi = 100)
return(list(AFR_meanU,AFR_maxU,AFR_maxtopU))
})
str(r)
x <- 'mean'
attr <- paste(x,'Util',sep='')
ioF <- factorX(subset(ioFtr,svrid %in% tcmdb$svr_asset_id,c('svrid',attr)))
names(ioF) <- c('svrid','attr')
meanU <- tapply(ioF$attr,ioF$svrid,mean)
maxU <- tapply(ioF$attr,ioF$svrid,max)
maxtopU <- tapply(ioF$attr,ioF$svrid,function(x){x <- sort(x,decreasing = T);mean(x[1:10])})
divU <- c(0:10,50,100)
staU <- data.frame(svrid = names(meanU),
meanU = cut(as.numeric(meanU),divU,include.lowest = T),
maxU = cut(as.numeric(maxU),divU,include.lowest = T),
maxtopU = cut(as.numeric(maxtopU),divU,include.lowest = T))
tf <- merge(tmp.f,staU,by.x = 'svr_id',by.y = 'svrid')
tcmdb <- merge(tmp.cmdb,staU,by.x = 'svr_asset_id',by.y = 'svrid')
AFR_meanUC <- item_order(AFR_attr_notime(tf,tcmdb,'meanU','meanU',1,dev = 'C'))
AFR_maxUC <- item_order(AFR_attr_notime(tf,tcmdb,'maxU','maxU',1,dev = 'C'))
AFR_maxtopUC <- item_order(AFR_attr_notime(tf,tcmdb,'maxtopU','maxtopU',1,dev = 'C'))
AFR_meanUTS <- item_order(AFR_attr_notime(tf,tcmdb,'meanU','meanU',12,dev = 'TS'))
AFR_maxUTS <- item_order(AFR_attr_notime(tf,tcmdb,'maxU','maxU',12,dev = 'TS'))
AFR_maxtopUTS <- item_order(AFR_attr_notime(tf,tcmdb,'maxtopU','maxtopU',12,dev = 'TS'))
AFR_meanU <- rbind(AFR_meanUC,AFR_meanUTS)
AFR_maxU <- rbind(AFR_maxUC,AFR_maxUTS)
AFR_maxtopU <- rbind(AFR_maxtopUC,AFR_maxtopUTS)
View(AFR_maxU)
View(AFR_maxtopU)
View(AFR_meanU)
quantileX(ioFtr$meanUtil)
View(AFR_meanUTS)
View(AFR_maxtopUTS)
tfC <- subset(tf,dClass == 'C');tfTS <- subset(tf,dClass == 'TS')
tcmdbC <- subset(tcmdb,dClass == 'C'); tcmdbTS <- subset(tcmdb,dClass == 'TS')
ggplot(tcmdbTS,aes(meanU)) + geom_histogram()
tfC <- subset(tf,grepl('C',dClass));tfTS <- subset(tf,grepl('TS',dClass))
tcmdbC <- subset(tcmdb,grepl('C',dClass)); tcmdbTS <- subset(tcmdb,grepl('TS',dClass))
ggplot(tcmdbTS,aes(meanU)) + geom_histogram()
divU <- c(0,1,2,3,10,20,30,100)
staU <- data.frame(svrid = names(meanU),
meanU = cut(as.numeric(meanU),divU,include.lowest = T),
maxU = cut(as.numeric(maxU),divU,include.lowest = T),
maxtopU = cut(as.numeric(maxtopU),divU,include.lowest = T))
View(staU)
tf <- merge(tmp.f,staU,by.x = 'svr_id',by.y = 'svrid')
tcmdb <- merge(tmp.cmdb,staU,by.x = 'svr_asset_id',by.y = 'svrid')
tfC <- subset(tf,grepl('C',dClass));tfTS <- subset(tf,grepl('TS',dClass))
tcmdbC <- subset(tcmdb,grepl('C',dClass)); tcmdbTS <- subset(tcmdb,grepl('TS',dClass))
ggplot(tcmdbTS,aes(meanU)) + geom_histogram()
ggplot(tcmdbTS,aes(maxU)) + geom_histogram()
ggplot(tcmdbTS,aes(maxtopU)) + geom_histogram()
divU <- c(0,1,2,3,10,25,100)
staU <- data.frame(svrid = names(meanU),
meanU = cut(as.numeric(meanU),divU,include.lowest = T),
maxU = cut(as.numeric(maxU),divU,include.lowest = T),
maxtopU = cut(as.numeric(maxtopU),divU,include.lowest = T))
tf <- merge(tmp.f,staU,by.x = 'svr_id',by.y = 'svrid')
tcmdb <- merge(tmp.cmdb,staU,by.x = 'svr_asset_id',by.y = 'svrid')
tfC <- subset(tf,grepl('C',dClass));tfTS <- subset(tf,grepl('TS',dClass))
tcmdbC <- subset(tcmdb,grepl('C',dClass)); tcmdbTS <- subset(tcmdb,grepl('TS',dClass))
ggplot(tcmdbTS,aes(maxtopU)) + geom_histogram()
divU <- c(0,1,2,3,10,30,100)
staU <- data.frame(svrid = names(meanU),
meanU = cut(as.numeric(meanU),divU,include.lowest = T),
maxU = cut(as.numeric(maxU),divU,include.lowest = T),
maxtopU = cut(as.numeric(maxtopU),divU,include.lowest = T))
tf <- merge(tmp.f,staU,by.x = 'svr_id',by.y = 'svrid')
tcmdb <- merge(tmp.cmdb,staU,by.x = 'svr_asset_id',by.y = 'svrid')
tfC <- subset(tf,grepl('C',dClass));tfTS <- subset(tf,grepl('TS',dClass))
tcmdbC <- subset(tcmdb,grepl('C',dClass)); tcmdbTS <- subset(tcmdb,grepl('TS',dClass))
ggplot(tcmdbTS,aes(maxtopU)) + geom_histogram()
ggplot(tcmdbTS,aes(maxU)) + geom_histogram()
ggplot(tcmdbTS,aes(meanU)) + geom_histogram()
ggplot(tfTS,aes(meanU)) + geom_histogram()
ggplot(tfTS,aes(maxU)) + geom_histogram()
ggplot(tfTS,aes(maxtopU)) + geom_histogram()
ggplot(tfTS,aes(maxU)) + geom_histogram()
ggplot(tfC,aes(maxU)) + geom_histogram()
ggplot(tfTS,aes(maxU)) + geom_histogram()
divU <- c(0,1,2,3,10,30,99,100)
staU <- data.frame(svrid = names(meanU),
meanU = cut(as.numeric(meanU),divU,include.lowest = T),
maxU = cut(as.numeric(maxU),divU,include.lowest = T),
maxtopU = cut(as.numeric(maxtopU),divU,include.lowest = T))
tf <- merge(tmp.f,staU,by.x = 'svr_id',by.y = 'svrid')
tcmdb <- merge(tmp.cmdb,staU,by.x = 'svr_asset_id',by.y = 'svrid')
tfC <- subset(tf,grepl('C',dClass));tfTS <- subset(tf,grepl('TS',dClass))
tcmdbC <- subset(tcmdb,grepl('C',dClass)); tcmdbTS <- subset(tcmdb,grepl('TS',dClass))
ggplot(tfTS,aes(maxU)) + geom_histogram()
divU <- c(0,1,2,3,10,30,90,100)
staU <- data.frame(svrid = names(meanU),
meanU = cut(as.numeric(meanU),divU,include.lowest = T),
maxU = cut(as.numeric(maxU),divU,include.lowest = T),
maxtopU = cut(as.numeric(maxtopU),divU,include.lowest = T))
tf <- merge(tmp.f,staU,by.x = 'svr_id',by.y = 'svrid')
tcmdb <- merge(tmp.cmdb,staU,by.x = 'svr_asset_id',by.y = 'svrid')
tfC <- subset(tf,grepl('C',dClass));tfTS <- subset(tf,grepl('TS',dClass))
tcmdbC <- subset(tcmdb,grepl('C',dClass)); tcmdbTS <- subset(tcmdb,grepl('TS',dClass))
ggplot(tfTS,aes(maxU)) + geom_histogram()
quantileX(tf$maxU)
divU <- c(0,1,2,3,10,30,90,100)
staU <- data.frame(svrid = names(meanU),
meanoU <- as.numeric(meanU),
maxoU <- as.numeric(maxU),
maxtopoU <- as.numeric(maxtopU),
meanU = cut(as.numeric(meanU),divU,include.lowest = T),
maxU = cut(as.numeric(maxU),divU,include.lowest = T),
maxtopU = cut(as.numeric(maxtopU),divU,include.lowest = T))
tf <- merge(tmp.f,staU,by.x = 'svr_id',by.y = 'svrid')
tcmdb <- merge(tmp.cmdb,staU,by.x = 'svr_asset_id',by.y = 'svrid')
tfC <- subset(tf,grepl('C',dClass));tfTS <- subset(tf,grepl('TS',dClass))
tcmdbC <- subset(tcmdb,grepl('C',dClass)); tcmdbTS <- subset(tcmdb,grepl('TS',dClass))
quantileX(tf$maxoU)
x <- 'max'
# r <- sapply(c('min','q25','q50','mean','q75','max','sd','cv'),function(x){
attr <- paste(x,'Util',sep='')
ioF <- factorX(subset(ioFtr,svrid %in% tcmdb$svr_asset_id,c('svrid',attr)))
names(ioF) <- c('svrid','attr')
meanU <- tapply(ioF$attr,ioF$svrid,mean)
maxU <- tapply(ioF$attr,ioF$svrid,max)
maxtopU <- tapply(ioF$attr,ioF$svrid,function(x){x <- sort(x,decreasing = T);mean(x[1:10])})
#   divU <- c(0:10,50,100)
divU <- c(0,1,2,3,10,30,90,100)
staU <- data.frame(svrid = names(meanU),
meanoU <- as.numeric(meanU),
maxoU <- as.numeric(maxU),
maxtopoU <- as.numeric(maxtopU),
meanU = cut(as.numeric(meanU),divU,include.lowest = T),
maxU = cut(as.numeric(maxU),divU,include.lowest = T),
maxtopU = cut(as.numeric(maxtopU),divU,include.lowest = T))
tf <- merge(tmp.f,staU,by.x = 'svr_id',by.y = 'svrid')
tcmdb <- merge(tmp.cmdb,staU,by.x = 'svr_asset_id',by.y = 'svrid')
tfC <- subset(tf,grepl('C',dClass));tfTS <- subset(tf,grepl('TS',dClass))
tcmdbC <- subset(tcmdb,grepl('C',dClass)); tcmdbTS <- subset(tcmdb,grepl('TS',dClass))
ggplot(tfTS,aes(maxU)) + geom_histogram()
quantileX(staU$maxoU)
quantileX(tf$maxoU)
quantileX(tf$meanoU)
quantileX(tf$meanoU)
nrow(tf[tf$maxoU < 100])
nrow(tf[tf$maxoU < 100,])
nrow(tcmdb[tcmdb$maxoU < 100,])
455/78508
lowerC <- nrow(tfC[tfC$maxoU < 100,])/nrow(tcmdbC[tcmdbC$maxoU < 100,])
higherC <- nrow(tfC[tfC$maxoU == 100,])/nrow(tcmdbC[tcmdbC$maxoU == 100,])
lowerTS <- nrow(tfTS[tfTS$maxoU < 100,])/nrow(tcmdbTS[tcmdbTS$maxoU < 100,])
higherTS <- nrow(tfTS[tfTS$maxoU == 100,])/nrow(tcmdbTS[tcmdbTS$maxoU == 100,])
lowerC
higherC
busyPerc <- data.frame(lowerC = nrow(tfC[tfC$maxoU < 100,])/nrow(tcmdbC[tcmdbC$maxoU < 100,])*6*100,
higherC = nrow(tfC[tfC$maxoU == 100,])/nrow(tcmdbC[tcmdbC$maxoU == 100,])*6*100,
lowerTS = nrow(tfTS[tfTS$maxoU < 100,])/nrow(tcmdbTS[tcmdbTS$maxoU < 100,])/12*6*100,
higherTS = nrow(tfTS[tfTS$maxoU == 100,])/nrow(tcmdbTS[tcmdbTS$maxoU == 100,])/12*6*100)
View(busyPerc)
nrow(tfC[tfC$maxoU < 100,])
nrow(tcmdbC[tcmdbC$maxoU < 100,])
nrow(tcmdbC[tcmdbC$maxoU == 100,])
nrow(tfC[tfC$maxoU == 100,])
tfTS[tfTS$maxoU < 100,]
nrow(tfTS[tfTS$maxoU < 100,])
nrow(tfTS[tfTS$maxoU == 100,])
824/(340+824)
# 测试用
rm(list = ls())
#@@@ CONFIGURE @@@#
source(file.path('D:/Git/attrid','attr_config.R'))
#@@@ Function @@@#
source('D:/Git/R_Function/Rfun.R')
source(file.path(dir_code,'attr_function.R'))
#@@@ LOAD DATA @@@#
load(file.path(dir_data,'freqFieldWatch200.Rda'))
quantileX(data$a999)
xx <- subset(data,svrid == data$svrid[30])
View(xx)
xx <- subset(data,svrid == data$svrid[30] & time == '20140603')
idx <- which(xx$a999 > 5)
idx
diff <- idx[2:l] - idx[1:(l-1)]
l <- length(idx)
diff <- idx[2:l] - idx[1:(l-1)]
diff
idx1 <- which(diff != 1)
dix
idx1
idx <- which(xx$a999 > 5)
l <- length(idx)
diff <- idx[2:l] - idx[1:(l-1)]
idx1 <- c(which(diff != 1),l)
l1 <- length(idx1)
diff1 <- idx1[2:l1] - idx[1:(l1-1)]
diff1 <- diff1 - 1
rrr <- max(diff1)
rrr
diff1
idx <- which(xx$a999 > 5)
l <- length(idx)
diff <- idx[2:l] - idx[1:(l-1)]
diff
idx1 <- c(which(diff != 1),l)
idx
str(diff)
which(diff != 1)
l
c(which(diff != 1),l)
idx1 <- c(which(diff != 1),l)
l1 <- length(idx1)
diff1 <- idx1[2:l1] - idx[1:(l1-1)]
diff1
diff1 <- idx1[2:l1] - idx1[1:(l1-1)]
diff1
diff1 <- diff1 - 1
rrr <- max(diff1)
rrr
