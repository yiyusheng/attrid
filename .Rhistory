# rwTable$fcount[is.na(rwTable$fcount)] <- 0
rwTable$AFR <- rwTable$fcount/rwTable$count*6
rwTable <- rwTable[,c('Read','Write','fcount','count','AFR')]
ggplot(subset(rwTable,count > 100),aes(x = Read,y = Write, fill = AFR)) + geom_tile()
AFR9023 <- ioAFR(div9023,ioC1,fC1,'sep9023')
tmp <- subset(AFR9023C,count > 10)
ggplot(tmp,aes(x = sep,y = count)) + geom_bar(stat = 'identity')
ggplot(tmp,aes(x = sep,y = AFR)) + geom_line()
View(tmp)
AFR9023 <- ioAFR(div9023,ioC1,fC1,'sep9023')
tmp <- subset(AFR9023,count > 10)
ggplot(tmp,aes(x = sep,y = count)) + geom_bar(stat = 'identity')
ggplot(tmp,aes(x = sep,y = AFR)) + geom_line()
View(tmp)
ggplot(tmp,aes(x = sep,y = count)) + geom_bar(stat = 'identity')
ggplot(tmp,aes(x = sep,y = AFR)) + geom_line()
View(tmp)
tmp <- subset(AFR9023C,count > 10)
ggplot(tmp,aes(x = sep,y = count)) + geom_bar(stat = 'identity')
ggplot(tmp,aes(x = sep,y = AFR)) + geom_line()
tmp <- subset(AFR9023TS,count > 10)
ggplot(tmp,aes(x = sep,y = count)) + geom_bar(stat = 'identity')
ggplot(tmp,aes(x = sep,y = AFR)) + geom_line()
ggplot(tmp,aes(x = sep,y = count)) + geom_bar(stat = 'identity')
ggplot(subset(tmp,sep<33),aes(x = sep,y = AFR)) + geom_line()
ggplot(subset(tmp,sep>33),aes(x = sep,y = AFR)) + geom_line()
ggplot(subset(tmp),aes(x = sep,y = AFR)) + geom_line()
tmp <- subset(AFR9023TS,count > 10)
ggplot(tmp,aes(x = sep,y = count)) + geom_bar(stat = 'identity')
ggplot(subset(tmp),aes(x = sep,y = AFR)) + geom_line()
tmp <- subset(AFR9023C,count > 10)
ggplot(tmp,aes(x = sep,y = count)) + geom_bar(stat = 'identity')
ggplot(subset(tmp),aes(x = sep,y = AFR)) + geom_line()
ggplot(subset(tmp),aes(x = sep,y = AFR*6)) + geom_line()
ggplot(subset(tmp),aes(x = sep,y = AFR*6)) + geom_line()
tmp <- subset(AFR9023TS,count > 10)
ggplot(tmp,aes(x = sep,y = count)) + geom_bar(stat = 'identity')
ggplot(subset(tmp),aes(x = sep,y = AFR*6)) + geom_line()
ggplot(subset(tmp),aes(x = sep,y = AFR*6/12)) + geom_line()
rm(list = ls())
#@@@ CONFIGURE @@@#
source(file.path('D:/Git/attrid','attr_config.R'))
#@@@ Function @@@#
source('D:/Git/R_Function/Rfun.R')
source(file.path(dir_code,'attr_function.R'))
source(file.path(dir_code,'AFR_io_function.R'))
#@@@ LOAD DATA @@@#
load(file.path(dir_data,'load_ftr_attrid.Rda'))
source(file.path(dir_code,'AFR_io_prepare.R'))
cmv902C <- AFR_value(subset(tmp.f,dev_class_id == 'C1'),subset(tmp.cmdb,dev_class_id == 'C1'),
subset(tmp.io,dev_class_id == 'C1'),'902',3,lastYears,1)
View(cmv902C)
cmv902C <- AFR_value(subset(tmp.f,dev_class_id == 'C1'),subset(tmp.cmdb,dev_class_id == 'C1'),
subset(tmp.io,dev_class_id == 'C1'),'902',6,lastYears,1)
cmv903C <- AFR_value(subset(tmp.f,dev_class_id == 'C1'),subset(tmp.cmdb,dev_class_id == 'C1'),
subset(tmp.io,dev_class_id == 'C1'),'903',6,lastYears,1)
cmv999C <- AFR_value(subset(tmp.f,dev_class_id == 'C1'),subset(tmp.cmdb,dev_class_id == 'C1'),
subset(tmp.io,dev_class_id == 'C1'),'999',6,lastYears,1)
AFR_value_plot(cmv902C,'Ship Time and IO read (non-storage servers)',25)
AFR_value_plot(cmv903C,'Ship Time and IO Write (non-storage servers)',20)
AFR_value_plot(cmv999C,'Ship Time and IO Time (non-storage servers)',30)
cmv902C <- AFR_value(subset(tmp.f,dev_class_id == 'C1'),subset(tmp.cmdb,dev_class_id == 'C1'),
subset(tmp.io,dev_class_id == 'C1'),'902',3,lastYears,1)
cmv903C <- AFR_value(subset(tmp.f,dev_class_id == 'C1'),subset(tmp.cmdb,dev_class_id == 'C1'),
subset(tmp.io,dev_class_id == 'C1'),'903',3,lastYears,1)
cmv999C <- AFR_value(subset(tmp.f,dev_class_id == 'C1'),subset(tmp.cmdb,dev_class_id == 'C1'),
subset(tmp.io,dev_class_id == 'C1'),'999',3,lastYears,1)
AFR_value_plot(cmv902C,'Ship Time and IO read (non-storage servers)',25)
AFR_value_plot(cmv903C,'Ship Time and IO Write (non-storage servers)',20)
AFR_value_plot(cmv999C,'Ship Time and IO Time (non-storage servers)',30)
source('D:/Git/attrid/readWrite.R')
tmp <- subset(AFR9023TS,count > 10)
ggplot(tmp,aes(x = sep,y = count)) + geom_bar(stat = 'identity')
View(tmp)
ioC2.TS.L <- subset(ioC1,dClass == 'TS' & sep9023 >= 33)
ioC2.TS.S <- subset(ioC1,dClass == 'TS' & sep9023 < 33)
fC2.TS.L <- subset(fC1,dClass == 'TS' & sep9023 >= 33)
fC2.TS.S <- subset(fC1,dClass == 'TS' & sep9023 < 33)
338/7109
824/22486
tableX(ioC2.TS.L$dev_class_id)
tableX(ioC2.TS.S$dev_class_id)
tapply(ioC1$sep9023,ioC1$dev_class_id,function(x)list(a = sum(x>=33),b = sum(x<33)))
tapply(ioC1$sep9023,factor(ioC1$dev_class_id),function(x)list(a = sum(x>=33),b = sum(x<33)))
tapply(ioC1$sep9023,factor(ioC1$dev_class_id),function(x)list(sum(x>=33)/length(x),sum(x<33)/length(x)))
tapply(ioC1$sep9023,factor(ioC1$dev_class_id),function(x)c(sum(x>=33)/length(x),sum(x<33)/length(x)))
tapply(ioC1$sep9023,factor(ioC1$dev_class_id),function(x)c(sum(x>=30)/length(x),sum(x<30)/length(x)))
tapply(ioC1$sep9023,factor(ioC1$dev_class_id),function(x)c(sum(x>=30)/length(x),sum(x<31)/length(x)))
bnd <- 30;tapply(ioC1$sep9023,factor(ioC1$dev_class_id),function(x)c(sum(x>=bnd)/length(x),sum(x<bnd)/length(x)))
bnd <- 31;tapply(ioC1$sep9023,factor(ioC1$dev_class_id),function(x)c(sum(x>=bnd)/length(x),sum(x<bnd)/length(x)))
bnd <- 32;tapply(ioC1$sep9023,factor(ioC1$dev_class_id),function(x)c(sum(x>=bnd)/length(x),sum(x<bnd)/length(x)))
bnd <- 33;tapply(ioC1$sep9023,factor(ioC1$dev_class_id),function(x)c(sum(x>=bnd)/length(x),sum(x<bnd)/length(x)))
bnd <- 32;tapply(ioC1$sep9023,factor(ioC1$dev_class_id),function(x)c(sum(x>=bnd)/length(x),sum(x<bnd)/length(x)))
bnd <- 33;tapply(ioC1$sep9023,factor(ioC1$dev_class_id),function(x)c(sum(x>=bnd)/length(x),sum(x<bnd)/length(x)))
bnd <- 34;tapply(ioC1$sep9023,factor(ioC1$dev_class_id),function(x)c(sum(x>=bnd)/length(x),sum(x<bnd)/length(x)))
bnd <- 35;tapply(ioC1$sep9023,factor(ioC1$dev_class_id),function(x)c(sum(x>=bnd)/length(x),sum(x<bnd)/length(x)))
bnd <- 36;tapply(ioC1$sep9023,factor(ioC1$dev_class_id),function(x)c(sum(x>=bnd)/length(x),sum(x<bnd)/length(x)))
ggplot(ioC1TS,aes(x = sep9023,fill = dev_class_id)) + geom_bar(stat = 'identity')
ggplot(ioC1TS,aes(x = sep9023,fill = dev_class_id)) + geom_bar()
ggplot(ioC1,aes(x = sep9023,fill = dev_class_id)) + geom_bar()
ggplot(ioC1TS,aes(x = sep9023,fill = dev_class_id)) + geom_bar()
a <- read.csv('D:\1.txt')
a <- read.csv('D:/1.txt')
a <- read.csv('D:/1.txt',header = F)
View(a)
a <- read.csv('D:/1.txt')
View(a)
as.POSIXct(a$last_online.INTEGER)
a <- read.csv('D:/1.txt')
View(a)
a <- read.csv('D:/1.txt',sep='|')
View(a)
a <- read.csv('D:/1.txt',sep='|')
View(a)
a <- read.csv('D:/1.txt')
View(a)
a <- read.csv('D:/1.txt')
View(a)
a <- read.csv('D:/1.txt')
View(a)
# 以6-7两月为观察窗口，求这两个月的机器故障对应上架时间的年故障率
# 上架时间区分分0-3个月，3-6个月，6-12个月，1-2年，2-3年，3-4年
# 计算每个区间内的故障机数量和机器总量。
# 例如3-6个月的故障率计算：
#   将时间窗口内的故障机器，故障时的已服役时间为3-6个月的机器作为分子，去重
#   将上架时间距6月份-1个月至-6个月中（即去年12月至5月）上架的机器作为分母。
#   因为这些机器在观察窗口中发生故障是会被计入分子的
rm(list = ls())
#@@@ CONFIGURE @@@#
source(file.path('D:/Git/attrid','attr_config.R'))
#@@@ Function @@@#
source('D:/Git/R_Function/Rfun.R')
source(file.path(dir_code,'attr_function.R'))
source(file.path(dir_code,'AFR_io_function.R'))
#@@@ LOAD DATA @@@#
load(file.path(dir_data,'load_ftr_attrid.Rda'))
source(file.path(dir_code,'AFR_io_prepare.R'))
# 以6-7两月为观察窗口，求这两个月的机器故障对应上架时间的年故障率
# 上架时间区分分0-3个月，3-6个月，6-12个月，1-2年，2-3年，3-4年
# 计算每个区间内的故障机数量和机器总量。
# 例如3-6个月的故障率计算：
#   将时间窗口内的故障机器，故障时的已服役时间为3-6个月的机器作为分子，去重
#   将上架时间距6月份-1个月至-6个月中（即去年12月至5月）上架的机器作为分母。
#   因为这些机器在观察窗口中发生故障是会被计入分子的
rm(list = ls())
#@@@ CONFIGURE @@@#
source(file.path('D:/Git/attrid','attr_config.R'))
#@@@ Function @@@#
source('D:/Git/R_Function/Rfun.R')
source(file.path(dir_code,'attr_function.R'))
source(file.path(dir_code,'AFR_io_function.R'))
#@@@ LOAD DATA @@@#
load(file.path(dir_data,'load_ftr_attrid.Rda'))
source(file.path(dir_code,'AFR_io_prepare.R'))
tmpP3.fC <- subset(tmp.f,dClass == 'C',c('ip','svr_id','dClass','dev_class_id','failShiptime'))
rm(list = ls())
#@@@ CONFIGURE @@@#
source(file.path('D:/Git/attrid','attr_config.R'))
#@@@ Function @@@#
source('D:/Git/R_Function/Rfun.R')
source(file.path(dir_code,'attr_function.R'))
source(file.path(dir_code,'AFR_io_function.R'))
#@@@ LOAD DATA @@@#
load(file.path(dir_data,'load_ftr_attrid.Rda'))
source(file.path(dir_code,'AFR_io_prepare.R'))
source(file.path(dir_code,'AFR_io_prepare.R'))
#   因为这些机器在观察窗口中发生故障是会被计入分子的
rm(list = ls())
#@@@ CONFIGURE @@@#
source(file.path('D:/Git/attrid','attr_config.R'))
#@@@ Function @@@#
source('D:/Git/R_Function/Rfun.R')
source(file.path(dir_code,'attr_function.R'))
source(file.path(dir_code,'AFR_io_function.R'))
#@@@ LOAD DATA @@@#
load(file.path(dir_data,'load_ftr_attrid.Rda'))
source(file.path(dir_code,'AFR_io_prepare.R'))
tmpP3.fC <- subset(tmp.f,dClass == 'C',c('ip','svr_id','dClass','dev_class_id','failShiptime'))
tmpP3.cmdbC <- subset(tmp.cmdb,dClass == 'C',c('svr_asset_id','dev_class_id','ip','shiptimToLeft','dClass'))
tmpP3.cmdbC <- subset(tmp.cmdb,dClass == 'C',c('svr_asset_id','dev_class_id','ip','shiptimeToLeft','dClass'))
tmpP3.cmdbC$total902 <- log2(tmp.io$mean_902[match(tmpP3.cmdbC$svr_asset_id,tmp.io$svrid)]*86400*365)
tmpP3.cmdbC$total903 <- log2(tmp.io$mean_903[match(tmpP3.cmdbC$svr_asset_id,tmp.io$svrid)]*86400*365)
summary(tmpP3.cmdbC)
?log2
tmpP3.cmdbC$total902 <- tmp.io$mean_902[match(tmpP3.cmdbC$svr_asset_id,tmp.io$svrid)]*86400*365
sum(tmpP3.cmdbC$total902 == -Inf)
tmpP3.cmdbC$total902 <- tmp.io$mean_902[match(tmpP3.cmdbC$svr_asset_id,tmp.io$svrid)]*86400*365
sum(tmpP3.cmdbC$total902 == 0)
sum(tmpP3.cmdbC$total902 <= 0)
a <- subset(tmpP3.fC,ip %in% tmpP3.cmdbC$ip[tmpP3.cmdbC$total902 <=0])
tmpP3.cmdbC$total902 <- tmp.io$mean_902[match(tmpP3.cmdbC$svr_asset_id,tmp.io$svrid)]*86400*365
tmpP3.cmdbC$total903 <- tmp.io$mean_903[match(tmpP3.cmdbC$svr_asset_id,tmp.io$svrid)]*86400*365
a <- subset(tmpP3.fC,ip %in% tmpP3.cmdbC$ip[tmpP3.cmdbC$total903 <=0])
tmpP3.io <- subset(tmp.io,mean_902 != 0 & mean_903 != 0)
tmpP3.cmdbC$total902 <- tmpP3.io$mean_902[match(tmpP3.cmdbC$svr_asset_id,tmp.io$svrid)]*86400*365
tmpP3.cmdbC$total903 <- tmpP3.io$mean_903[match(tmpP3.cmdbC$svr_asset_id,tmp.io$svrid)]*86400*365
tmpP3.cmdbC$total902 <- log2(tmpP3.io$mean_902[match(tmpP3.cmdbC$svr_asset_id,tmp.io$svrid)]*86400*365)
tmpP3.cmdbC$total903 <- log2(tmpP3.io$mean_903[match(tmpP3.cmdbC$svr_asset_id,tmp.io$svrid)]*86400*365)
summary(tmpP3.cmdbC)
ggplot(tmpP3.cmdbC,aes(total902)) + geom_histogram()
ggplot(tmpP3.cmdbC,aes(total903)) + geom_histogram()
ggplot(tmpP3.cmdbC,aes(total903)) + geom_histogram()
quantile(tmpP3.cmdbC$total902,seq(0,1,1/3))
quantile(tmpP3.cmdbC$total902,seq(0,1,(1/3)))
quantile(tmpP3.cmdbC$total902,seq(0,1,(1/3)),na.rm = T)
quantile(tmpP3.cmdbC$total903,seq(0,1,(1/3)),na.rm = T)
tmpP3.fC <- subset(tmp.f,dClass == 'C',c('ip','svr_id','dClass','dev_class_id','failShiptime'))
tmpP3.cmdbC <- subset(tmp.cmdb,dClass == 'C',c('svr_asset_id','dev_class_id','ip','shiptimeToLeft','dClass'))
tmpP3.io <- subset(tmp.io,mean_902 != 0 & mean_903 != 0)
tmpP3.cmdbC$total902 <- log2(tmpP3.io$mean_902[match(tmpP3.cmdbC$svr_asset_id,tmpP3.io$svrid)]*86400*365)
tmpP3.cmdbC$total903 <- log2(tmpP3.io$mean_903[match(tmpP3.cmdbC$svr_asset_id,tmpP3.io$svrid)]*86400*365)
quantile(tmpP3.cmdbC$total903,seq(0,1,(1/3)))
summary(tmpP3.io)
tmpP3.io <- subset(tmp.io,mean_902 > 0 & mean_903 > 0)
tmpP3.cmdbC$total902 <- log2(tmpP3.io$mean_902[match(tmpP3.cmdbC$svr_asset_id,tmpP3.io$svrid)]*86400*365)
tmpP3.cmdbC$total903 <- log2(tmpP3.io$mean_903[match(tmpP3.cmdbC$svr_asset_id,tmpP3.io$svrid)]*86400*365)
quantile(tmpP3.cmdbC$total903,seq(0,1,(1/3)))
summary(tmpP3.io)
tmpP3.io <- subset(tmp.io,mean_902 > 0 & mean_903 > 0)
summary(tmpP3.io)
tmpP3.io <- subset(tmp.io,mean_902 > 0)
summary(tmpP3.io)
tmpP3.io <- subset(tmp.io,mean_902 > 0 & mean_903 > 0)
tmpP3.cmdbC$total902 <- log2(tmpP3.io$mean_902[match(tmpP3.cmdbC$svr_asset_id,tmpP3.io$svrid)]*86400*365)
tmpP3.cmdbC$total903 <- log2(tmpP3.io$mean_903[match(tmpP3.cmdbC$svr_asset_id,tmpP3.io$svrid)]*86400*365)
min(tmpP3.io$mean_902)
tmpP3.cmdbC$total902 <- log2(tmpP3.io$mean_902[match(tmpP3.cmdbC$svr_asset_id,tmpP3.io$svrid)]*86400*365)
tmpP3.cmdbC$total903 <- log2(tmpP3.io$mean_903[match(tmpP3.cmdbC$svr_asset_id,tmpP3.io$svrid)]*86400*365)
summary(tmpP3.cmdbC)
cut902 <- c(10,25,32,44)
cut903 <- c(26,31,34,42)
tmpP3.cmdbC$sep902 <- gsub('^\\(|,*$','',cut(tmpP3.cmdbC,cut902))
?cut
str(cut)
tmpP3.cmdbC$sep902 <- gsub('^\\(|,*$','',cut(tmpP3.cmdbC$total902,cut902))
tmpP3.cmdbC$sep903 <- gsub('^\\(|,*$','',cut(tmpP3.cmdbC$total903,cut903))
tmpP3.cmdbC$sep902 <- gsub('^\\(|,.*$','',cut(tmpP3.cmdbC$total902,cut902))
tmpP3.cmdbC$sep903 <- gsub('^\\(|,.*$','',cut(tmpP3.cmdbC$total903,cut903))
View(tmpP3.cmdbC)
tmpP3.cmdbC <- subset(tmpP3.cmdbC,!is.na(total902) & !is.na(total903))
cut902 <- c(10,25,32,44)
cut903 <- c(26,31,34,42)
tmpP3.cmdbC$sep902 <- gsub('^\\(|,.*$','',cut(tmpP3.cmdbC$total902,cut902))
tmpP3.cmdbC$sep903 <- gsub('^\\(|,.*$','',cut(tmpP3.cmdbC$total903,cut903))
tmpP3.fC$sep902 <- tmpP3.cmdbC$sep902[match(tmpP3.fC$ip,tmpP3.cmdbC$ip)]
tmpP3.fC$sep903 <- tmpP3.cmdbC$sep903[match(tmpP3.fC$ip,tmpP3.cmdbC$ip)]
summary(tmpP3.fC)
tmpP3.cmdbC$sep902 <- as.numeric(gsub('^\\(|,.*$','',cut(tmpP3.cmdbC$total902,cut902)))
tmpP3.cmdbC$sep903 <- as.numeric(gsub('^\\(|,.*$','',cut(tmpP3.cmdbC$total903,cut903)))
tmpP3.fC$sep902 <- tmpP3.cmdbC$sep902[match(tmpP3.fC$ip,tmpP3.cmdbC$ip)]
tmpP3.fC$sep903 <- tmpP3.cmdbC$sep903[match(tmpP3.fC$ip,tmpP3.cmdbC$ip)]
summary(tmpP3.fC)
tmpP3.fC <- susbet(tmpP3.fC,!is.na(sep902) & !is.na(sep903))
tmpP3.fC <- subset(tmpP3.fC,!is.na(sep902) & !is.na(sep903))
summary(tmpP3.fC)
AFR.total <- AFR_attr(tmpP3.fC,tmpP3.cmdbC,'sep902',6,1)
View(AFR.total)
AFR_value_plot(AFR.total,'Ship Time and Read Total (Non-Storage Server)',-1,subdir = '0114io')
cut902 <- c(10,20,30,40,50)
tmpP3.cmdbC$sep902 <- as.numeric(gsub('^\\(|,.*$','',cut(tmpP3.cmdbC$total902,cut902)))
tmpP3.cmdbC$sep903 <- as.numeric(gsub('^\\(|,.*$','',cut(tmpP3.cmdbC$total903,cut903)))
tmpP3.fC$sep902 <- tmpP3.cmdbC$sep902[match(tmpP3.fC$ip,tmpP3.cmdbC$ip)]
tmpP3.fC$sep903 <- tmpP3.cmdbC$sep903[match(tmpP3.fC$ip,tmpP3.cmdbC$ip)]
tmpP3.fC <- subset(tmpP3.fC,!is.na(sep902) & !is.na(sep903))
AFR.total <- AFR_attr(tmpP3.fC,tmpP3.cmdbC,'sep902',6,1)
AFR_value_plot(AFR.total,'Ship Time and Read Total (Non-Storage Server)',-1,subdir = '0114io')
View(AFR.total)
# 以6-7两月为观察窗口，求这两个月的机器故障对应上架时间的年故障率
# 上架时间区分分0-3个月，3-6个月，6-12个月，1-2年，2-3年，3-4年
# 计算每个区间内的故障机数量和机器总量。
# 例如3-6个月的故障率计算：
#   将时间窗口内的故障机器，故障时的已服役时间为3-6个月的机器作为分子，去重
#   将上架时间距6月份-1个月至-6个月中（即去年12月至5月）上架的机器作为分母。
#   因为这些机器在观察窗口中发生故障是会被计入分子的
rm(list = ls())
#@@@ CONFIGURE @@@#
source(file.path('D:/Git/attrid','attr_config.R'))
#@@@ Function @@@#
source('D:/Git/R_Function/Rfun.R')
source(file.path(dir_code,'attr_function.R'))
source(file.path(dir_code,'AFR_io_function.R'))
#@@@ LOAD DATA @@@#
load(file.path(dir_data,'load_ftr_attrid.Rda'))
source(file.path(dir_code,'AFR_io_prepare.R'))
tmpP3.fC <- subset(tmp.f,dClass == 'C',c('ip','svr_id','dClass','dev_class_id','failShiptime'))
tmpP3.cmdbC <- subset(tmp.cmdb,dClass == 'C',c('svr_asset_id','dev_class_id','ip','shiptimeToLeft','dClass'))
tmpP3.io <- subset(tmp.io,mean_902 > 0 & mean_903 > 0)
tmpP3.cmdbC$total902 <- log2(tmpP3.io$mean_902[match(tmpP3.cmdbC$svr_asset_id,tmpP3.io$svrid)]*86400*365)
tmpP3.cmdbC$total903 <- log2(tmpP3.io$mean_903[match(tmpP3.cmdbC$svr_asset_id,tmpP3.io$svrid)]*86400*365)
tmpP3.cmdbC <- subset(tmpP3.cmdbC,!is.na(total902) & !is.na(total903))
cut902 <- c(10,20,30,40,50)
cut903 <- c(26,31,34,42)
tmpP3.cmdbC$sep902 <- as.numeric(gsub('^\\(|,.*$','',cut(tmpP3.cmdbC$total902,cut902)))
tmpP3.cmdbC$sep903 <- as.numeric(gsub('^\\(|,.*$','',cut(tmpP3.cmdbC$total903,cut903)))
tmpP3.fC$sep902 <- tmpP3.cmdbC$sep902[match(tmpP3.fC$ip,tmpP3.cmdbC$ip)]
tmpP3.fC$sep903 <- tmpP3.cmdbC$sep903[match(tmpP3.fC$ip,tmpP3.cmdbC$ip)]
tmpP3.fC <- subset(tmpP3.fC,!is.na(sep902) & !is.na(sep903))
AFR.total <- AFR_attr(tmpP3.fC,tmpP3.cmdbC,'sep902',6,1)
View(AFR.total)
cut902 <- c(10,20,30,50)
cut903 <- c(26,31,34,42)
tmpP3.cmdbC$sep902 <- as.numeric(gsub('^\\(|,.*$','',cut(tmpP3.cmdbC$total902,cut902)))
tmpP3.cmdbC$sep903 <- as.numeric(gsub('^\\(|,.*$','',cut(tmpP3.cmdbC$total903,cut903)))
tmpP3.fC$sep902 <- tmpP3.cmdbC$sep902[match(tmpP3.fC$ip,tmpP3.cmdbC$ip)]
tmpP3.fC$sep903 <- tmpP3.cmdbC$sep903[match(tmpP3.fC$ip,tmpP3.cmdbC$ip)]
tmpP3.fC <- subset(tmpP3.fC,!is.na(sep902) & !is.na(sep903))
AFR.total <- AFR_attr(tmpP3.fC,tmpP3.cmdbC,'sep902',6,1)
View(AFR.total)
AFR_value_plot(AFR.total,'Ship Time and Read Total (Non-Storage Server)',-1,subdir = '0114io')
str(AFR_attr)
tmpP3.fTS <- subset(tmp.f,dClass == 'TS',c('ip','svr_id','dClass','dev_class_id','failShiptime'))
tmpP3.cmdbTS <- subset(tmp.cmdb,dClass == 'TS',c('svr_asset_id','dev_class_id','ip','shiptimeToLeft','dClass'))
tmpP3.io <- subset(tmp.io,mean_902 > 0 & mean_903 > 0)
tmpP3.cmdbTS$total902 <- log2(tmpP3.io$mean_902[match(tmpP3.cmdbTS$svr_asset_id,tmpP3.io$svrid)]*86400*365)
tmpP3.cmdbTS$total903 <- log2(tmpP3.io$mean_903[match(tmpP3.cmdbTS$svr_asset_id,tmpP3.io$svrid)]*86400*365)
tmpP3.cmdbTS <- subset(tmpP3.cmdbTS,!is.na(total902) & !is.na(total903))
cut902 <- c(10,20,30,50)
cut903 <- c(26,31,34,42)
tmpP3.cmdbTS$sep902 <- as.numeric(gsub('^\\(|,.*$','',cut(tmpP3.cmdbTS$total902,cut902)))
tmpP3.cmdbTS$sep903 <- as.numeric(gsub('^\\(|,.*$','',cut(tmpP3.cmdbTS$total903,cut903)))
tmpP3.fTS$sep902 <- tmpP3.cmdbTS$sep902[match(tmpP3.fTS$ip,tmpP3.cmdbTS$ip)]
tmpP3.fTS$sep903 <- tmpP3.cmdbTS$sep903[match(tmpP3.fTS$ip,tmpP3.cmdbTS$ip)]
tmpP3.fTS <- subset(tmpP3.fTS,!is.na(sep902) & !is.na(sep903))
AFR.totalTS <- AFR_attr(tmpP3.fTS,tmpP3.cmdbTS,'sep902',6,12)
AFR_value_plot(AFR.totalTS,'Ship Time and Read Total (Storage Server)',-1,subdir = '0114io')
View(AFR.totalTS)
a <- tableX(tmpP3.cmdbTS$total902)
a1 <- tableX(tmpP3.cmdbTS$total902)
a2 <- tableX(tmpP3.cmdbTS$total903)
b2 <- tableX(tmpP3.cmdbC$total903)
b1 <- tableX(tmpP3.cmdbC$total902)
ggplot(tmpP3.cmdbTS,aes(x = total902)) + geom_histogram()
b1
ggplot(tmpP3.cmdbTS,aes(x = sep902)) + geom_histogram()
quantile(tmpP3.cmdbTs$sep902)
quantile(tmpP3.cmdbTS$sep902,sep(0,1,0.01))
quantile(tmpP3.cmdbTS$sep902,seq(0,1,0.01))
quantile(tmpP3.cmdbTS$total902,seq(0,1,0.01))
a <- subset(tmp.cmdb,total902>40 | total903>40)
a <- subset(tmpP3.cmdb,total902>40 | total903>40)
tmpP3.io$total902 <- log2(tmpP3.io$mean_902*86400*365)
tmpP3.io$total903 <- log2(tmpP3.io$mean_903*86400*365)
tmpP3.fC <- subset(tmp.f,dClass == 'C',c('ip','svr_id','dClass','dev_class_id','failShiptime'))
tmpP3.cmdbC <- subset(tmp.cmdb,dClass == 'C',c('svr_asset_id','dev_class_id','ip','shiptimeToLeft','dClass'))
tmpP3.io <- subset(tmp.io,mean_902 > 0 & mean_903 > 0)
tmpP3.cmdbC$total902 <- tmpP3.io$total902[match(tmpP3.cmdbC$svr_asset_id,tmpP3.io$svrid)]
tmpP3.cmdbC$total903 <- tmpP3.io$total903[match(tmpP3.cmdbC$svr_asset_id,tmpP3.io$svrid)]
tmpP3.cmdbC <- subset(tmpP3.cmdbC,!is.na(total902) & !is.na(total903))
cut902 <- c(10,20,30,50)
cut903 <- c(26,31,34,42)
tmpP3.cmdbC$sep902 <- as.numeric(gsub('^\\(|,.*$','',cut(tmpP3.cmdbC$total902,cut902)))
tmpP3.cmdbC$total902 <- tmpP3.io$total902[match(tmpP3.cmdbC$svr_asset_id,tmpP3.io$svrid)]
tmpP3.cmdbC$total903 <- tmpP3.io$total903[match(tmpP3.cmdbC$svr_asset_id,tmpP3.io$svrid)]
tmpP3.cmdbC <- subset(tmpP3.cmdbC,!is.na(total902) & !is.na(total903))
tmpP3.io$total902 <- log2(tmpP3.io$mean_902*86400*365)
tmpP3.io$total903 <- log2(tmpP3.io$mean_903*86400*365)
tmpP3.fC <- subset(tmp.f,dClass == 'C',c('ip','svr_id','dClass','dev_class_id','failShiptime'))
tmpP3.cmdbC <- subset(tmp.cmdb,dClass == 'C',c('svr_asset_id','dev_class_id','ip',
'shiptimeToLeft','dClass','total902','total903'))
tmpP3.io$total902 <- log2(tmpP3.io$mean_902*86400*365)
tmpP3.io$total903 <- log2(tmpP3.io$mean_903*86400*365)
tmpP3.cmdb$total902 <- tmp3.io$total902[match(tmpP3.cmdb$svr_asset_id,tmpP3.io$svrid)]
tmpP3.cmdb$total903 <- tmp3.io$total903[match(tmpP3.cmdb$svr_asset_id,tmpP3.io$svrid)]
tmpP3.cmdb$total902 <- tmpP3.io$total902[match(tmpP3.cmdb$svr_asset_id,tmpP3.io$svrid)]
tmpP3.io <- tmp.io
tmpP3.cmdb <- tmp.cmdb
tmpP3.f <- tmp.f
tmpP3.io$total902 <- log2(tmpP3.io$mean_902*86400*365)
tmpP3.io$total903 <- log2(tmpP3.io$mean_903*86400*365)
tmpP3.cmdb$total902 <- tmpP3.io$total902[match(tmpP3.cmdb$svr_asset_id,tmpP3.io$svrid)]
tmpP3.cmdb$total903 <- tmpP3.io$total903[match(tmpP3.cmdb$svr_asset_id,tmpP3.io$svrid)]
tmp.fTS <- subset(tmp.f,dev_class_id != 'C1')
tmp.cmdbTS <- subset(tmp.cmdb,dev_class_id != 'C1')
tmp.ioTS <- subset(tmp.io,dev_class_id != 'C1')
cmv902T <- AFR_value(tmp.fTS,tmp.cmdbTS,tmp.ioTS,'902',3,lastYears,12)
cmv903T <- AFR_value(tmp.fTS,tmp.cmdbTS,tmp.ioTS,'903',3,lastYears,12)
cmv999T <- AFR_value(tmp.fTS,tmp.cmdbTS,tmp.ioTS,'999',3,lastYears,12)
AFR_value_plot(cmv902T,'Ship Time and IO read (storage servers)',25)
AFR_value_plot(cmv903T,'Ship Time and IO Write (storage servers)',20)
AFR_value_plot(cmv999T,'Ship Time and IO Time (storage servers)',30)
#   因为这些机器在观察窗口中发生故障是会被计入分子的
rm(list = ls())
#@@@ CONFIGURE @@@#
source(file.path('D:/Git/attrid','attr_config.R'))
#@@@ Function @@@#
source('D:/Git/R_Function/Rfun.R')
source(file.path(dir_code,'attr_function.R'))
source(file.path(dir_code,'AFR_io_function.R'))
#@@@ LOAD DATA @@@#
load(file.path(dir_data,'load_ftr_attrid.Rda'))
source(file.path(dir_code,'AFR_io_prepare.R'))
tmpP3.io <- subset(tmp.io,mean_902 > 0 & mean_903 > 0)
tmpP3.cmdb <- tmp.cmdb
tmpP3.f <- tmp.f
tmpP3.io$total902 <- log2(tmpP3.io$mean_902*86400*365)
tmpP3.io$total903 <- log2(tmpP3.io$mean_903*86400*365)
tmpP3.cmdb$total902 <- tmpP3.io$total902[match(tmpP3.cmdb$svr_asset_id,tmpP3.io$svrid)]
tmpP3.cmdb$total903 <- tmpP3.io$total903[match(tmpP3.cmdb$svr_asset_id,tmpP3.io$svrid)]
# C类
tmpP3.fC <- subset(tmpP3.f,dClass == 'C',c('ip','svr_id','dClass','dev_class_id','failShiptime'))
tmpP3.cmdbC <- subset(tmpP3.cmdb,dClass == 'C',c('svr_asset_id','dev_class_id','ip',
'shiptimeToLeft','dClass','total902','total903'))
tmpP3.cmdbC <- subset(tmpP3.cmdbC,!is.na(total902) & !is.na(total903))
cut902 <- c(10,20,30,50)
cut903 <- c(26,31,34,42)
tmpP3.cmdbC$sep902 <- as.numeric(gsub('^\\(|,.*$','',cut(tmpP3.cmdbC$total902,cut902)))
tmpP3.cmdbC$sep903 <- as.numeric(gsub('^\\(|,.*$','',cut(tmpP3.cmdbC$total903,cut903)))
tmpP3.fC$sep902 <- tmpP3.cmdbC$sep902[match(tmpP3.fC$ip,tmpP3.cmdbC$ip)]
tmpP3.fC$sep903 <- tmpP3.cmdbC$sep903[match(tmpP3.fC$ip,tmpP3.cmdbC$ip)]
tmpP3.fC <- subset(tmpP3.fC,!is.na(sep902) & !is.na(sep903))
AFR.totalC <- AFR_attr(tmpP3.fC,tmpP3.cmdbC,'sep902',6,1)
AFR_value_plot(AFR.totalC,'Ship Time and Read Total (Non-Storage Server)',-1,subdir = '0114io')
tmpP3.fTS <- subset(tmpP3.f,dClass == 'TS',c('ip','svr_id','dClass','dev_class_id','failShiptime'))
tmpP3.cmdbTS <- subset(tmpP3.cmdb,dClass == 'TS',c('svr_asset_id','dev_class_id','ip',
'shiptimeToLeft','dClass','total902','total903'))
tmpP3.cmdbTS <- subset(tmpP3.cmdbTS,!is.na(total902) & !is.na(total903))
cut902 <- c(10,20,30,50)
cut903 <- c(26,31,34,42)
tmpP3.cmdbTS$sep902 <- as.numeric(gsub('^\\(|,.*$','',cut(tmpP3.cmdbTS$total902,cut902)))
tmpP3.cmdbTS$sep903 <- as.numeric(gsub('^\\(|,.*$','',cut(tmpP3.cmdbTS$total903,cut903)))
tmpP3.fTS$sep902 <- tmpP3.cmdbTS$sep902[match(tmpP3.fTS$ip,tmpP3.cmdbTS$ip)]
tmpP3.fTS$sep903 <- tmpP3.cmdbTS$sep903[match(tmpP3.fTS$ip,tmpP3.cmdbTS$ip)]
tmpP3.fTS <- subset(tmpP3.fTS,!is.na(sep902) & !is.na(sep903))
AFR.totalTS <- AFR_attr(tmpP3.fTS,tmpP3.cmdbTS,'sep902',6,12)
AFR_value_plot(AFR.totalTS,'Ship Time and Read Total (Storage Server)',-1,subdir = '0114io')
tmpP3.io <- subset(tmp.io,mean_902 > 0 & mean_903 > 0)
tmpP3.cmdb <- tmp.cmdb
tmpP3.f <- tmp.f
tmpP3.io$total902 <- log2(tmpP3.io$mean_902*86400*365)
tmpP3.io$total903 <- log2(tmpP3.io$mean_903*86400*365)
tmpP3.io$total9023 <- log2(tmpP3.io$mean_902*86400*365 + tmpP3.io$mean_903*86400*365)
tmpP3.cmdb$total902 <- tmpP3.io$total902[match(tmpP3.cmdb$svr_asset_id,tmpP3.io$svrid)]
tmpP3.cmdb$total903 <- tmpP3.io$total903[match(tmpP3.cmdb$svr_asset_id,tmpP3.io$svrid)]
tmpP3.cmdb$total9023 <- tmpP3.io$total9023[match(tmpP3.cmdb$svr_asset_id,tmpP3.io$svrid)]
tmpP3.fC <- subset(tmpP3.f,dClass == 'C',c('ip','svr_id','dClass','dev_class_id','failShiptime'))
tmpP3.cmdbC <- subset(tmpP3.cmdb,dClass == 'C',c('svr_asset_id','dev_class_id','ip',
'shiptimeToLeft','dClass','total902','total903'))
tmpP3.cmdbC <- subset(tmpP3.cmdbC,!is.na(total902) & !is.na(total903) & !is.na(total9023))
tmpP3.io <- subset(tmp.io,mean_902 > 0 & mean_903 > 0)
tmpP3.cmdb <- tmp.cmdb
tmpP3.f <- tmp.f
tmpP3.io$total902 <- log2(tmpP3.io$mean_902*86400*365)
tmpP3.io$total903 <- log2(tmpP3.io$mean_903*86400*365)
tmpP3.io$total9023 <- log2(tmpP3.io$mean_902*86400*365 + tmpP3.io$mean_903*86400*365)
tmpP3.cmdb$total902 <- tmpP3.io$total902[match(tmpP3.cmdb$svr_asset_id,tmpP3.io$svrid)]
tmpP3.cmdb$total903 <- tmpP3.io$total903[match(tmpP3.cmdb$svr_asset_id,tmpP3.io$svrid)]
tmpP3.cmdb$total9023 <- tmpP3.io$total9023[match(tmpP3.cmdb$svr_asset_id,tmpP3.io$svrid)]
# C类
tmpP3.fC <- subset(tmpP3.f,dClass == 'C',c('ip','svr_id','dClass','dev_class_id','failShiptime'))
tmpP3.cmdbC <- subset(tmpP3.cmdb,dClass == 'C',c('svr_asset_id','dev_class_id','ip',
'shiptimeToLeft','dClass','total902','total903'))
tmpP3.cmdbC <- subset(tmpP3.cmdbC,!is.na(total902) & !is.na(total903) & !is.na(total9023))
tmpP3.io <- subset(tmp.io,mean_902 > 0 & mean_903 > 0)
tmpP3.cmdb <- tmp.cmdb
tmpP3.f <- tmp.f
tmpP3.io$total902 <- log2(tmpP3.io$mean_902*86400*365)
tmpP3.io$total903 <- log2(tmpP3.io$mean_903*86400*365)
tmpP3.io$total9023 <- log2(tmpP3.io$mean_902*86400*365 + tmpP3.io$mean_903*86400*365)
tmpP3.cmdb$total902 <- tmpP3.io$total902[match(tmpP3.cmdb$svr_asset_id,tmpP3.io$svrid)]
tmpP3.cmdb$total903 <- tmpP3.io$total903[match(tmpP3.cmdb$svr_asset_id,tmpP3.io$svrid)]
tmpP3.cmdb$total9023 <- tmpP3.io$total9023[match(tmpP3.cmdb$svr_asset_id,tmpP3.io$svrid)]
# C类
tmpP3.fC <- subset(tmpP3.f,dClass == 'C',c('ip','svr_id','dClass','dev_class_id','failShiptime'))
tmpP3.cmdbC <- subset(tmpP3.cmdb,dClass == 'C',c('svr_asset_id','dev_class_id','ip',
'shiptimeToLeft','dClass','total902','total903','total9023'))
tmpP3.cmdbC <- subset(tmpP3.cmdbC,!is.na(total902) & !is.na(total903) & !is.na(total9023))
quantile(tmpP3.cmdbC$total9023,seq(0,1,0.01))
tmpP3.fC <- subset(tmpP3.f,dClass == 'C',c('ip','svr_id','dClass','dev_class_id','failShiptime'))
tmpP3.cmdbC <- subset(tmpP3.cmdb,dClass == 'C',c('svr_asset_id','dev_class_id','ip',
'shiptimeToLeft','dClass','total902','total903','total9023'))
tmpP3.cmdbC <- subset(tmpP3.cmdbC,!is.na(total902) & !is.na(total903) & !is.na(total9023))
cut902 <- c(10,20,30,50)
cut903 <- c(26,31,34,42)
cut9023 <- c(26,31,33,36,44)
tmpP3.cmdbC$sep902 <- as.numeric(gsub('^\\(|,.*$','',cut(tmpP3.cmdbC$total902,cut902)))
tmpP3.cmdbC$sep903 <- as.numeric(gsub('^\\(|,.*$','',cut(tmpP3.cmdbC$total903,cut903)))
tmpP3.cmdbC$sep9023 <- as.numeric(gsub('^\\(|,.*$','',cut(tmpP3.cmdbC$total9023,cut9023)))
tmpP3.fC$sep902 <- tmpP3.cmdbC$sep902[match(tmpP3.fC$ip,tmpP3.cmdbC$ip)]
tmpP3.fC$sep903 <- tmpP3.cmdbC$sep903[match(tmpP3.fC$ip,tmpP3.cmdbC$ip)]
tmpP3.fC$sep9023 <- tmpP3.cmdbC$sep9023[match(tmpP3.fC$ip,tmpP3.cmdbC$ip)]
tmpP3.fC <- subset(tmpP3.fC,!is.na(sep902) & !is.na(sep903) & !is.na(sep9023))
AFR.totalC <- AFR_attr(tmpP3.fC,tmpP3.cmdbC,'sep9023',6,1)
AFR_value_plot(AFR.totalC,'Ship Time and Read Total (Non-Storage Server)',-1,subdir = '0114io')
View(AFR.totalC)
View(AFR.totalC)
View(AFR.totalC)
View(AFR.totalC)
View(AFR.totalC)
source(file.path(dir_code,'AFR_io_function.R'))
AFR.totalC <- AFR_attr(tmpP3.fC,tmpP3.cmdbC,'sep9023',6,1)
AFR_value_plot(AFR.totalC,'Ship Time and Read Total (Non-Storage Server)',-1,subdir = '0114io')
View(AFR.totalC)
source(file.path(dir_code,'AFR_io_function.R'))
AFR.totalC <- AFR_attr(tmpP3.fC,tmpP3.cmdbC,'sep9023',6,1)
AFR_value_plot(AFR.totalC,'Ship Time and Read Total (Non-Storage Server)',-1,subdir = '0114io')
View(AFR.totalC)
cut9023 <- c(26,30,39,40,44)
tmpP3.cmdbC$sep902 <- as.numeric(gsub('^\\(|,.*$','',cut(tmpP3.cmdbC$total902,cut902)))
tmpP3.cmdbC$sep903 <- as.numeric(gsub('^\\(|,.*$','',cut(tmpP3.cmdbC$total903,cut903)))
tmpP3.cmdbC$sep9023 <- as.numeric(gsub('^\\(|,.*$','',cut(tmpP3.cmdbC$total9023,cut9023)))
tmpP3.fC$sep902 <- tmpP3.cmdbC$sep902[match(tmpP3.fC$ip,tmpP3.cmdbC$ip)]
tmpP3.fC$sep903 <- tmpP3.cmdbC$sep903[match(tmpP3.fC$ip,tmpP3.cmdbC$ip)]
tmpP3.fC$sep9023 <- tmpP3.cmdbC$sep9023[match(tmpP3.fC$ip,tmpP3.cmdbC$ip)]
tmpP3.fC <- subset(tmpP3.fC,!is.na(sep902) & !is.na(sep903) & !is.na(sep9023))
AFR.totalC <- AFR_attr(tmpP3.fC,tmpP3.cmdbC,'sep9023',6,1)
AFR_value_plot(AFR.totalC,'Ship Time and Read Total (Non-Storage Server)',-1,subdir = '0114io')
summary(tmpP3.io)
summary(tmpP3.f)
summary(tmpP3.fC)
summary(tmp.f)
ggplot(tmpP3.cmdb,aes(x = sep9023)) + geom_histogram()
ggplot(tmpP3.cmdb,aes(x = total9023)) + geom_histogram()
