sul_cut <- data.frame(svrid = sul$svrid,
low = apply(sul[,names(sul) %in% paste('X',cut_util[1]:cut_util[2],sep='')],1,sum),
high = apply(sul[,names(sul) %in% paste('X',cut_util[2]:cut_util[3],sep='')],1,sum))
sul_cut[,-1] <- conv_row_percent(sul_cut[,-1])
sul_cut <- data.frame(svrid = sul$svrid,
low = apply(sul[,names(sul) %in% paste('X',cut_util[1]:cut_util[2],sep='')],1,sum),
high = apply(sul[,names(sul) %in% paste('X',cut_util[2]:cut_util[3],sep='')],1,sum))
sul_cut[,-1]
sul_cut[,-1] <- conv_row_percent(sul_cut[,-1])
sul_cut <- data.frame(svrid = sul$svrid,
low = apply(sul[,names(sul) %in% paste('X',cut_util[1]:cut_util[2],sep='')],1,sum),
high = apply(sul[,names(sul) %in% paste('X',cut_util[2]:cut_util[3],sep='')],1,sum))
sul_cut1 <- conv_row_percent(sul_cut[,-1])
View(sul_cut1)
sul_cut <- data.frame(svrid = sul$svrid,
low = apply(sul[,names(sul) %in% paste('X',cut_util[1]:cut_util[2],sep='')],1,sum),
high = apply(sul[,names(sul) %in% paste('X',(cut_util[2]+1):cut_util[3],sep='')],1,sum))
sul_cut1 <- conv_row_percent(sul_cut[,-1])
paste('X',cut_util[1]:cut_util[2],sep='')]
paste('X',cut_util[1]:cut_util[2],sep='')
paste('X',(cut_util[2]+1):cut_util[3],sep='')
sul['5',]
sul <- subset(sul,svrid %in% sul_stdd)
cut_util <- c(0,10,100,101,102,103)
sul_cut <- data.frame(svrid = sul$svrid,
low = apply(sul[,names(sul) %in% paste('X',cut_util[1]:cut_util[2],sep='')],1,sum),
high = apply(sul[,names(sul) %in% paste('X',(cut_util[2]+1):cut_util[3],sep='')],1,sum))
sul_cut1 <- conv_row_percent(sul_cut[,-1])
sul <- sta_util_level
if(zero.rm == T)sul[,names(sul) == '0'] <- NULL
sul_stdd <- cbind(sul$svrid,data.frame(t(apply(sul[,!grepl('svrid',names(sul))],1,function(x)c(round(x/sum(x)*100,digits = 4),sum(x))))))
names(sul_stdd)[ncol(sul_stdd)] <- 'sum';names(sul_stdd)[1] <- 'svrid'
sul_stdd <- subset(sul_stdd,sum > 50000)
sul <- subset(sul,svrid %in% sul_stdd$svrid)
cut_util <- c(0,10,100,101,102,103)
sul_cut <- data.frame(svrid = sul$svrid,
low = apply(sul[,names(sul) %in% paste('X',cut_util[1]:cut_util[2],sep='')],1,sum),
high = apply(sul[,names(sul) %in% paste('X',(cut_util[2]+1):cut_util[3],sep='')],1,sum))
sul_cut1 <- conv_row_percent(sul_cut[,-1])
View(sul_cut1)
sul_cut[,-1] <- conv_row_percent(sul_cut[,-1])
sul_cut <- data.frame(svrid = sul$svrid,
low = apply(sul[,names(sul) %in% paste('X',cut_util[1]:cut_util[2],sep='')],1,sum),
high = apply(sul[,names(sul) %in% paste('X',(cut_util[2]+1):cut_util[3],sep='')],1,sum))
sul_cut[,-1] <- t(conv_row_percent(sul_cut[,-1]))
ggplot(sul_cut,aes(x = low,y = high)) + geom_point(alpha = 0.1)
cut_util <- c(0,20,80,100,102,103)
sul_cut <- data.frame(svrid = sul$svrid,
low = apply(sul[,names(sul) %in% paste('X',cut_util[1]:cut_util[2],sep='')],1,sum),
media = apply(sul[,names(sul) %in% paste('X',(cut_util[2]+1):cut_util[3],sep='')],1,sum),
high = apply(sul[,names(sul) %in% paste('X',(cut_util[3]+1):cut_util[4],sep='')],1,sum))
sul_cut[,-1] <- t(conv_row_percent(sul_cut[,-1]))
ggplot(sul_cut,aes(x = low,y = high)) + geom_point(alpha = 0.1)
ggplot(sul_cut,aes(x = low,y = high)) + geom_point(alpha = 0.01)
ggplot(sul_cut,aes(x = low,y = high)) + geom_point(alpha = 0.0001)
ggplot(sul_cut,aes(x = low,y = high)) + geom_point(alpha = 0.01)
rowSums(sul[,-1])
colSums(sul[,-1])
a <- colSums(sul[,-1])
conv_row_percent(a)
conv_row_percent(t(a))
b <- conv_row_percent(t(a))
View(b)
cut_util <- c(0,3,100,102,103)
sul_cut <- data.frame(svrid = sul$svrid,
low = apply(sul[,names(sul) %in% paste('X',cut_util[1]:cut_util[2],sep='')],1,sum),
media = apply(sul[,names(sul) %in% paste('X',(cut_util[2]+1):cut_util[3],sep='')],1,sum),
high = apply(sul[,names(sul) %in% paste('X',(cut_util[3]+1):cut_util[4],sep='')],1,sum))
sul_cut[,-1] <- t(conv_row_percent(sul_cut[,-1]))
ggplot(sul_cut,aes(x = low,y = high)) + geom_point(alpha = 0.01)
cut_util <- c(-1,0,3,100,102,103)
sul_cut <- data.frame(svrid = sul$svrid,
low = apply(sul[,names(sul) %in% paste('X',cut_util[1]:cut_util[2],sep='')],1,sum),
media = apply(sul[,names(sul) %in% paste('X',(cut_util[2]+1):cut_util[3],sep='')],1,sum),
high = apply(sul[,names(sul) %in% paste('X',(cut_util[3]+1):cut_util[4],sep='')],1,sum))
sul_cut[,-1] <- t(conv_row_percent(sul_cut[,-1]))
cut_util[1]:cut_util[2]
paste('X',cut_util[1]:cut_util[2],sep='')
sul_cut <- data.frame(svrid = sul$svrid,
low = apply(sul[,names(sul) %in% paste('X',cut_util[1]:cut_util[2],sep='')],1,sum),
media = apply(sul[,names(sul) %in% paste('X',(cut_util[2]+1):cut_util[3],sep='')],1,sum),
high = apply(sul[,names(sul) %in% paste('X',(cut_util[3]+1):cut_util[4],sep='')],1,sum))
cut_util <- c(0,0,3,100,102,103)
sul_cut <- data.frame(svrid = sul$svrid,
low = apply(sul[,names(sul) %in% paste('X',cut_util[1]:cut_util[2],sep='')],1,sum),
media = apply(sul[,names(sul) %in% paste('X',(cut_util[2]+1):cut_util[3],sep='')],1,sum),
high = apply(sul[,names(sul) %in% paste('X',(cut_util[3]+1):cut_util[4],sep='')],1,sum))
apply(sul[,names(sul) %in% paste('X',cut_util[1]:cut_util[2],sep='')],1,sum)
sul[,names(sul) %in% paste('X',cut_util[1]:cut_util[2],sep='')]
sul_cut <- data.frame(svrid = sul$svrid,
# low = apply(sul[,names(sul) %in% paste('X',cut_util[1]:cut_util[2],sep='')],1,sum),
low = sul$X0,
media = apply(sul[,names(sul) %in% paste('X',(cut_util[2]+1):cut_util[3],sep='')],1,sum),
high = apply(sul[,names(sul) %in% paste('X',(cut_util[3]+1):cut_util[4],sep='')],1,sum))
sul_cut[,-1] <- t(conv_row_percent(sul_cut[,-1]))
ggplot(sul_cut,aes(x = low,y = high)) + geom_point(alpha = 0.01)
zero.rm = T
sul <- sta_util_level
if(zero.rm == T)sul[,names(sul) == '0'] <- NULL
sul_stdd <- cbind(sul$svrid,data.frame(t(apply(sul[,!grepl('svrid',names(sul))],1,function(x)c(round(x/sum(x)*100,digits = 4),sum(x))))))
names(sul_stdd)[ncol(sul_stdd)] <- 'sum';names(sul_stdd)[1] <- 'svrid'
sul_stdd <- subset(sul_stdd,sum > 50000)
sul <- subset(sul,svrid %in% sul_stdd$svrid)
cut_util <- c(0,0,3,100,102,103)
sul_cut <- data.frame(svrid = sul$svrid,
# low = apply(sul[,names(sul) %in% paste('X',cut_util[1]:cut_util[2],sep='')],1,sum),
low = sul$X0,
media = apply(sul[,names(sul) %in% paste('X',(cut_util[2]+1):cut_util[3],sep='')],1,sum),
high = apply(sul[,names(sul) %in% paste('X',(cut_util[3]+1):cut_util[4],sep='')],1,sum))
zero.rm == T
if(zero.rm == T)sul[,names(sul) == '0'] <- NULL
names(sul) == '0'
if(zero.rm == T)sul[,names(sul) == 'X0'] <- NULL
sul_stdd <- cbind(sul$svrid,data.frame(t(apply(sul[,!grepl('svrid',names(sul))],1,function(x)c(round(x/sum(x)*100,digits = 4),sum(x))))))
names(sul_stdd)[ncol(sul_stdd)] <- 'sum';names(sul_stdd)[1] <- 'svrid'
sul_stdd <- subset(sul_stdd,sum > 50000)
quantileX(sul_cut$low)
sul <- subset(sul,svrid %in% sul_stdd$svrid)
cut_util <- c(0,0,3,100,102,103)
sul_cut <- data.frame(svrid = sul$svrid,
# low = apply(sul[,names(sul) %in% paste('X',cut_util[1]:cut_util[2],sep='')],1,sum),
low = sul$X0,
media = apply(sul[,names(sul) %in% paste('X',(cut_util[2]+1):cut_util[3],sep='')],1,sum),
high = apply(sul[,names(sul) %in% paste('X',(cut_util[3]+1):cut_util[4],sep='')],1,sum))
sul <- sta_util_level
if(zero.rm == T)sul[,names(sul) == 'X0'] <- NULL
sul <- sta_util_level
zero.rm <- F
if(zero.rm == T)sul[,names(sul) == 'X0'] <- NULL
sul_stdd <- cbind(sul$svrid,data.frame(t(apply(sul[,!grepl('svrid',names(sul))],1,function(x)c(round(x/sum(x)*100,digits = 4),sum(x))))))
names(sul_stdd)[ncol(sul_stdd)] <- 'sum';names(sul_stdd)[1] <- 'svrid'
sul_stdd <- subset(sul_stdd,sum > 50000)
sul <- subset(sul,svrid %in% sul_stdd$svrid)
cut_util <- c(0,0,3,100,102,103)
sul_cut <- data.frame(svrid = sul$svrid,
# low = apply(sul[,names(sul) %in% paste('X',cut_util[1]:cut_util[2],sep='')],1,sum),
low = sul$X0,
media = apply(sul[,names(sul) %in% paste('X',(cut_util[2]+1):cut_util[3],sep='')],1,sum),
high = apply(sul[,names(sul) %in% paste('X',(cut_util[3]+1):cut_util[4],sep='')],1,sum))
sul_cut[,-1] <- t(conv_row_percent(sul_cut[,-1]))
ggplot(sul_cut,aes(x = low,y = high)) + geom_point(alpha = 0.01)
quantileX(sul_cut$low)
sul_cut$round_low <- round(sul_cut$low)
ggplot(sul_cut,aes(x = round_low)) + geom_boxplot(aes(y = high))
sul_cut$round_low <- factor(round(sul_cut$low))
ggplot(sul_cut,aes(x = round_low)) + geom_boxplot(aes(y = high))
View(sul)
a <- c(1,2,3)
b <- c(1,2,2)
a * b
a ** b
a %*% b
sul_mean <- data.frame(svrid = sul$svrid,
mean = apply(sul[,-1],1,function(x)sum(x * 0:100)/sum(x)))
View(sul_mean)
sul_mean <- data.frame(svrid = sul$svrid,
mean = apply(sul[,-1],1,function(x)round(sum(x * 0:100)/sum(x)*100,digits = 4)))
View(sul_mean)
sul_mean <- data.frame(svrid = sul$svrid,
mean = apply(sul[,-1],1,function(x)round(sum(x * 0:100)/sum(x),digits = 4)))
sul_mean <- data.frame(svrid = sul$svrid,
mean = apply(sul[,-1],1,function(x)round(sum(x * 0:100)/sum(x),digits = 2)))
ggplot(sul_mean,aes(mean)) + geom_histogram(binwidth = 1)
ggplot(sul_mean,aes(log2(mean))) + geom_histogram(binwidth = 1)
ggplot(sul_mean,aes(log2(mean))) + geom_histogram()
ggplot(sul_mean,aes(mean)) + stat_ecdf()
ggplot(sul_mean,aes(mean))
stat_ecdf()
+ stat_ecdf()
ggplot(sul_mean,aes(mean)) + stat_ecdf()
ggplot(sul_mean,aes(mean)) + stat_ecdf() + geom_point()
sul_mean <- data.frame(svrid = sul$svrid,
mean = apply(sul[,-1],1,function(x)round(sum(x * 0:100)/sum(x),digits = 2)))
set.seed(as.p('2014-04-12'))
.Random.seed
set.seed(33)
.Random.seed
exists(a)
exists('a')
exists('factorX')
a <- .GlobalEnv
a$a
0.3 == 3*.1
3*.1
round(3*.1,digits = 10)
?paste
paste('asdfg asdf'a)
paste('asdfg asdf',aer)
paste('asdfg asdf',a)
f <- y~x1+x2
str(f)
f[[1]]
class(f)
class(f[[1]])
class(f[[2]])
class(f[[3]])
eval(pwd)
eval('pwd')
pwd
'pwd'
eval(a)
a
a <- 1
eval(a)
a
eval('a + 1')
sul_mean[c('svrid','mean')]
sul_mean[c('svrid','mean')] <- lapply(data[c('svrid','mean')],factor)
sul_mean[c('svrid','mean')] <- lapply(data[c('svrid','mean')],as.character)
?read.fwf
stdin()
a <- read.table('clipboard',header = T)
a <- read.table(stdin(),header = T)
a
dput(data)
?structure
structure(a)
structure(sul)
rm(list = ls());source('head.R')
load(file.path(dir_data,'sta_util_level.Rda'))
names(sta_util_level)[-1] <- paste('X',names(sta_util_level)[-1],sep='')
sul <- sta_util_level;zero.rm <- F
rm(list = ls());source('head.R')
load(file.path(dir_data,'sta_util_level.Rda'))
names(sta_util_level)[-1] <- paste('X',names(sta_util_level)[-1],sep='')
sul <- sta_util_level;zero.rm <- F
source('~/Code/R/attrid/sta_util_level.R')
View(sul)
load(file.path(dir_data,'aggregate_svrid_iops.Rda'))
save(r_sta,file.path(dir_data,'r_sta.Rda'))
save(r_sta,file = file.path(dir_data,'r_sta.Rda'))
source('~/Code/R/attrid/sta_util_level.R')
View(r_sta)
head(r_sta)
r_sta_svrid <- melt(tapply(r_sta$date,r_sta$svr_id,length))
View(r_sta_svrid)
r_sta_svrid <- melt(tapply(r_sta$date,r_sta$svr_id,length),names = c('svrid','numDate'))
r_sta_svrid <- melt(tapply(r_sta$date,r_sta$svr_id,length),colnames = c('svrid','numDate'))
names(r_sta_svrid) <- c('svrid','numDate')
quantileX(r_sta_svrid$numDate)
sul <- subset(sta_util_level,svrid %in% r_sta_svrid$svrid[r_sta_svrid$numDate > 300])
names(sta_util_level)[-1] <- paste('X',names(sta_util_level)[-1],sep='')
sul <- subset(sta_util_level,svrid %in% r_sta_svrid$svrid[r_sta_svrid$numDate > 300])
View(sul)
source('~/Code/R/attrid/sta_util_level.R')
util_mean_zero <- data.frame(svrid = sul$svrid,
mean_util = apply(sul[,-1],1,function(x)sum(x*(0:100))/sum(x)),
num_zero = sul$X0)
View(util_mean_zero)
util_mean_zero <- data.frame(svrid = sul$svrid,
mean_util = round(100*apply(sul[,-1],1,function(x)sum(x*(0:100))/sum(x)),digits = 2),
num_zero = sul$X0)
View(util_mean_zero)
ggplot(util_mean_zero,aes(x = num_zero,y = mean_util)) + geom_point()
ggplot(util_mean_zero,aes(x = num_zero,y = mean_util)) + geom_point(alpha = 0.1)
ggplot(util_mean_zero,aes(x = num_zero)) + geom_histogram(binwidth = 1000)
ggplot(util_mean_zero,aes(x = num_zero)) + geom_histogram(binwidth = 100)
ggplot(util_mean_zero,aes(x = num_zero)) + geom_histogram(binwidth = 500)
ggplot(subset(util_mean_zero,num_zero != 0),aes(x = num_zero)) + geom_histogram(binwidth = 500)
ggplot(subset(util_mean_zero,num_zero >100),aes(x = num_zero)) + geom_histogram(binwidth = 500)
ggplot(subset(util_mean_zero,num_zero >500),aes(x = num_zero)) + geom_histogram(binwidth = 500)
quantileX(util_mean_zero$num_zero)
View(util_mean_zero)
ggplot(subset(util_mean_zero,num_zero > 1000),aes(x = num_zero)) + geom_histogram(binwidth = 500)
ggplot(util_mean_zero,aes(x = num_zero,y = mean_util)) + geom_point(alpha = 0.1)
ggplot(util_mean_zero,aes(x = num_zero,y = mean_util)) + geom_point(alpha = 0.001)
ggplot(util_mean_zero,aes(x = num_zero,y = mean_util)) + geom_point(alpha = 0.01)
util_mean_zero <- data.frame(svrid = sul$svrid,
mean_util = round(100*apply(sul[,-1],1,function(x)sum(x*(0:100))/sum(x)),digits = 2),
num_zero = sul$X0,
count = apply(sul[,-1],1,sum))
View(util_mean_zero)
util_mean_zero$rate_zero <- util_mean_zero$num_zero/util_mean_zero$count
util_mean_zero$rz_cut <- cut(util_mean_zero$rate_zero,seq(0,1,0.2),seq(0,0.8,0.2))
util_mean_zero$rz_cut <- cut(util_mean_zero$rate_zero,seq(0,1,0.2),seq(0,0.8,0.2),include.lowest = T)
ggplot(util_mean_zero,aes(x = rz_cut)) + geom_boxplot(aes(y = mean_util))
ggplot(util_mean_zero,aes(x = rz_cut)) + geom_boxplot(aes(y = mean_util)) + geom_jitter(aes(y = mean_util),width = 0.2)
ggplot(util_mean_zero,aes(x = rz_cut)) + geom_boxplot(aes(y = mean_util)) + geom_jitter(aes(y = mean_util),width = 0.2,alpha = 0.05)
ggplot(util_mean_zero,aes(x = rz_cut)) + geom_boxplot(aes(y = mean_util)) + geom_jitter(aes(y = mean_util),width = 0.2,alpha = 0.01)
ggplot(util_mean_zero,aes(x = rz_cut)) + geom_boxplot(aes(y = mean_util),outlier.shape = NA) + geom_jitter(aes(y = mean_util),width = 0.2,alpha = 0.01)
util_mean_zero$rz_cut <- cut(util_mean_zero$rate_zero,seq(0,1,0.1),seq(0,0.9,0.1),include.lowest = T)
ggplot(util_mean_zero,aes(x = rz_cut)) + geom_boxplot(aes(y = mean_util),outlier.shape = NA) + geom_jitter(aes(y = mean_util),width = 0.2,alpha = 0.01)
util_mean_zero$rz_cut <- cut(util_mean_zero$rate_zero,c(0,0.2,0.8,1),c(0,0.2,0.8),include.lowest = T)
ggplot(util_mean_zero,aes(x = rz_cut)) + geom_boxplot(aes(y = mean_util),outlier.shape = NA) + geom_jitter(aes(y = mean_util),width = 0.2,alpha = 0.01)
ggplot(util_mean_zero,aes(x = rz_cut)) + geom_histogram()
ggplot(util_mean_zero,aes(x = rz_cut)) + geom_histogram()
ggplot(util_mean_zero,aes(x = fct2num(rz_cut))) + geom_histogram()
ggplot(util_mean_zero,aes(x = mean_util)) + geom_histogram()
ggplot(util_mean_zero,aes(x = mean_util)) + geom_histogram(binwidth = 1000)
a <- subset(sul,svrid == '9\')
)
}
9
455
)
quit
}
\
sum(x*(0:100))
()
[]
\
/
\'
\')
\\
m(list = ls());source('head.R')
gen_cut <- function(arr,cnt){
cut_arr <- quantile(arr,seq(0,1,1/cnt),na.rm = T)
dup_arr <- duplicated(cut_arr)
if(any(dup_arr) == T){
idx_upper <- min(which(dup_arr == T))
new_cut <- round(gen_cut(arr[arr > cut_arr[idx_upper]],cnt - idx_upper + 1))
return(c(cut_arr[1:(idx_upper-1)],new_cut))
}else{
return(cut_arr)
}
}
sta_util_coefficientVar_svrid <- function(df,thred = 1,numCut = 5){
cat(sprintf('id:%s\n',df$svrid[1]))
cut_util <- gen_cut(df$util,numCut)
idx <- !is.na(cut_util)
cut_util <- cut_util[idx]
names(cut_util) <- names(quantile(1,seq(0,1,1/numCut)))[idx]
df$util_cut <- fct2num(cut(df$util,breaks = cut_util,labels = cut_util[-length(cut_util)],right = F))
df$time_cut <- cut.POSIXt(df$time,seq.POSIXt(min(df$time),max(df$time),by = 'weeks'))
r <- do.call(rbind,tapply(df$util_cut,df$time_cut,function(x){
table_x <- melt(table(x))
if(nrow(table_x) == (length(cut_util)-1))return(t(table_x$value))
else{
table_x <- rbind(table_x,data.frame(x = setdiff(cut_util[-length(cut_util)],table_x$x),value = 0))
table_x <- table_x[order(table_x$x),]
return(t(table_x$value))
}
}))
return(list(sum(apply(r,2,function(x)sd(x)/mean(x)) > thred),cut_util))
}
sta_util_coefficientVar <- function(i){
load(file.path(dir_datatendcast,fname[i]))
dt_dcast <- iops_dcast_clear(dt_dcast)
splitDD <- split(dt_dcast[,c('svrid','time','util')],dt_dcast$svrid)
util_cv <- lapply(splitDD,sta_util_coefficientVar_svrid,thred = 1,numCut = 5)
}
fname <- list.files(dir_datatendcast)
rm(list = ls());source('head.R')
gen_cut <- function(arr,cnt){
cut_arr <- quantile(arr,seq(0,1,1/cnt),na.rm = T)
dup_arr <- duplicated(cut_arr)
if(any(dup_arr) == T){
idx_upper <- min(which(dup_arr == T))
new_cut <- round(gen_cut(arr[arr > cut_arr[idx_upper]],cnt - idx_upper + 1))
return(c(cut_arr[1:(idx_upper-1)],new_cut))
}else{
return(cut_arr)
}
}
sta_util_coefficientVar_svrid <- function(df,thred = 1,numCut = 5){
cat(sprintf('id:%s\n',df$svrid[1]))
cut_util <- gen_cut(df$util,numCut)
idx <- !is.na(cut_util)
cut_util <- cut_util[idx]
names(cut_util) <- names(quantile(1,seq(0,1,1/numCut)))[idx]
df$util_cut <- fct2num(cut(df$util,breaks = cut_util,labels = cut_util[-length(cut_util)],right = F))
df$time_cut <- cut.POSIXt(df$time,seq.POSIXt(min(df$time),max(df$time),by = 'weeks'))
r <- do.call(rbind,tapply(df$util_cut,df$time_cut,function(x){
table_x <- melt(table(x))
if(nrow(table_x) == (length(cut_util)-1))return(t(table_x$value))
else{
table_x <- rbind(table_x,data.frame(x = setdiff(cut_util[-length(cut_util)],table_x$x),value = 0))
table_x <- table_x[order(table_x$x),]
return(t(table_x$value))
}
}))
return(list(sum(apply(r,2,function(x)sd(x)/mean(x)) > thred),cut_util))
}
sta_util_coefficientVar <- function(i){
load(file.path(dir_datatendcast,fname[i]))
dt_dcast <- iops_dcast_clear(dt_dcast)
splitDD <- split(dt_dcast[,c('svrid','time','util')],dt_dcast$svrid)
util_cv <- lapply(splitDD,sta_util_coefficientVar_svrid,thred = 1,numCut = 5)
}
fname <- list.files(dir_datatendcast)
i = 28
load(file.path(dir_datatendcast,fname[i]))
dt_dcast <- iops_dcast_clear(dt_dcast)
splitDD <- split(dt_dcast[,c('svrid','time','util')],dt_dcast$svrid)
names(splitDD)
df <- splitDD[names(splitDD) == '478'][[1]]
load(file.path(dir_data,'r_sta.Rda'))
dt_dcast <- subset(dt_dcast,svrid %in% r_sta$svr_id[r_sta$Count > 300])
splitDD <- split(dt_dcast[,c('svrid','time','util')],dt_dcast$svrid)
names(splitDD)
View(df)
length(unique(as.Date(df$time)))
summary(df$util)
a <- subset(r_sta,svr_id == '478')
View(a)
r_sta_svrid <- melt(tapply(r_sta$date,r_sta$svr_id,length));names(r_sta_svrid) <- c('svrid','numDate')
dt_dcast <- subset(dt_dcast,svrid %in% r_sta_svrid$svr_id[r_sta_svrid$Count > 300])
load(file.path(dir_datatendcast,fname[i]))
dt_dcast <- iops_dcast_clear(dt_dcast)
dt_dcast <- subset(dt_dcast,svrid %in% r_sta_svrid$svrid[r_sta_svrid$Count > 300])
splitDD <- split(dt_dcast[,c('svrid','time','util')],dt_dcast$svrid)
names(splitDD)
dt_dcast <- iops_dcast_clear(dt_dcast)
load(file.path(dir_datatendcast,fname[i]))
dt_dcast <- iops_dcast_clear(dt_dcast)
dt_dcast <- subset(dt_dcast,svrid %in% r_sta_svrid$svrid[r_sta_svrid$numDate > 300])
splitDD <- split(dt_dcast[,c('svrid','time','util')],factor(dt_dcast$svrid))
dt_dcast <- factorX(subset(dt_dcast,svrid %in% r_sta_svrid$svrid[r_sta_svrid$numDate > 300]))
load(file.path(dir_datatendcast,fname[i]))
dt_dcast <- iops_dcast_clear(dt_dcast)
a <- dt_dcast
dt_dcast <- factorX(subset(dt_dcast,svrid %in% r_sta_svrid$svrid[r_sta_svrid$numDate > 300]))
dt_dcast <- a
dt_dcast <- factorX(subset(dt_dcast,svrid %in% r_sta_svrid$svrid[r_sta_svrid$numDate > 200]))
a <- r_sta_svrid[r_sta_svrid$svrid %in% dt_dcast$svrid]
a <- r_sta_svrid[r_sta_svrid$svrid %in% dt_dcast$svrid,]
View(a)
dt_dcast <- a
load(file.path(dir_datatendcast,fname[i]))
dt_dcast <- iops_dcast_clear(dt_dcast)
dt_dcast_bu <- dt_dcast
a <- r_sta_svrid[r_sta_svrid$svrid %in% dt_dcast$svrid,]
View(a)
summary(a$numDate)
summary(r_sta_svrid$numDate)
quantileX(r_sta_svrid$numDate)
dt_dcast <- factorX(subset(dt_dcast,svrid %in% r_sta_svrid$svrid[r_sta_svrid$numDate > 200]))
splitDD <- split(dt_dcast[,c('svrid','time','util')],factor(dt_dcast$svrid))
util_cv <- lapply(splitDD,sta_util_coefficientVar_svrid,thred = 1,numCut = 5)
sapply(util_cv,'[[',1)
df <- splitDD[names(splitDD) == 219][1]
df <- splitDD[names(splitDD) == 219][[1]]
thred = 1;numCut = 5
cat(sprintf('id:%s\n',df$svrid[1]))
cut_util <- gen_cut(df$util,numCut)
idx <- !is.na(cut_util)
cut_util <- cut_util[idx]
names(cut_util) <- names(quantile(1,seq(0,1,1/numCut)))[idx]
df$util_cut <- fct2num(cut(df$util,breaks = cut_util,labels = cut_util[-length(cut_util)],right = F))
df$time_cut <- cut.POSIXt(df$time,seq.POSIXt(min(df$time),max(df$time),by = 'weeks'))
r <- do.call(rbind,tapply(df$util_cut,df$time_cut,function(x){
table_x <- melt(table(x))
if(nrow(table_x) == (length(cut_util)-1))return(t(table_x$value))
else{
table_x <- rbind(table_x,data.frame(x = setdiff(cut_util[-length(cut_util)],table_x$x),value = 0))
table_x <- table_x[order(table_x$x),]
return(t(table_x$value))
}
}))
View(r)
sum(apply(r,2,function(x)sd(x)/mean(x)) > thred)
sd(r[,1])
df$util_cut <- fct2num(cut(df$util,breaks = cut_util,labels = cut_util[-length(cut_util)],right = T,include.lowest = T))
df$time_cut <- cut.POSIXt(df$time,seq.POSIXt(min(df$time),max(df$time),by = 'weeks'))
r <- do.call(rbind,tapply(df$util_cut,df$time_cut,function(x){
table_x <- melt(table(x))
if(nrow(table_x) == (length(cut_util)-1))return(t(table_x$value))
else{
table_x <- rbind(table_x,data.frame(x = setdiff(cut_util[-length(cut_util)],table_x$x),value = 0))
table_x <- table_x[order(table_x$x),]
return(t(table_x$value))
}
}))
sum(apply(r,2,function(x)sd(x)/mean(x)) > thred)
sta_util_coefficientVar_svrid <- function(df,thred = 1,numCut = 5){
cat(sprintf('id:%s\n',df$svrid[1]))
cut_util <- gen_cut(df$util,numCut)
idx <- !is.na(cut_util)
cut_util <- cut_util[idx]
names(cut_util) <- names(quantile(1,seq(0,1,1/numCut)))[idx]
df$util_cut <- fct2num(cut(df$util,breaks = cut_util,labels = cut_util[-length(cut_util)],right = T,include.lowest = T))
df$time_cut <- cut.POSIXt(df$time,seq.POSIXt(min(df$time),max(df$time),by = 'weeks'))
r <- do.call(rbind,tapply(df$util_cut,df$time_cut,function(x){
table_x <- melt(table(x))
if(nrow(table_x) == (length(cut_util)-1))return(t(table_x$value))
else{
table_x <- rbind(table_x,data.frame(x = setdiff(cut_util[-length(cut_util)],table_x$x),value = 0))
table_x <- table_x[order(table_x$x),]
return(t(table_x$value))
}
}))
eva <- apply(r,2,function(x)sd(x)/mean(x))
return(list(sum(eva > thred),mean(eva)))
}
splitDD <- split(dt_dcast[,c('svrid','time','util')],factor(dt_dcast$svrid))
util_cv <- lapply(splitDD,sta_util_coefficientVar_svrid,thred = 1,numCut = 5)
sta_util_coefficientVar_svrid <- function(df,thred = 1,numCut = 5){
cat(sprintf('id:%s\n',df$svrid[1]))
cut_util <- gen_cut(df$util,numCut)
idx <- !is.na(cut_util)
cut_util <- cut_util[idx]
names(cut_util) <- names(quantile(1,seq(0,1,1/numCut)))[idx]
df$util_cut <- fct2num(cut(df$util,breaks = cut_util,labels = cut_util[-length(cut_util)],right = T,include.lowest = T))
df$time_cut <- cut.POSIXt(df$time,seq.POSIXt(min(df$time),max(df$time),by = 'weeks'))
r <- do.call(rbind,tapply(df$util_cut,df$time_cut,function(x){
table_x <- melt(table(x))
if(nrow(table_x) == (length(cut_util)-1))return(t(table_x$value))
else{
table_x <- rbind(table_x,data.frame(x = setdiff(cut_util[-length(cut_util)],table_x$x),value = 0))
table_x <- table_x[order(table_x$x),]
return(t(table_x$value))
}
}))
eva <- apply(r,2,function(x)sd(x)/mean(x))
return(data.frame(sum = sum(eva > thred),mean = mean(eva)))
}
util_cv <- lapply(splitDD,sta_util_coefficientVar_svrid,thred = 1,numCut = 5)
util_cv <- do.call(rbind,util_cv)
View(util_cv)
source('~/Code/R/attrid/sta_util_coefficientVar.R')
