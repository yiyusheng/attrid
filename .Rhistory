svrid_ftime_2014_06_09 <- paste(f2014_06_09$svrid,f2014_06_09$ftime,sep='-')
svrid_ftime_2014 <- paste(f2014$svrid,f2014$ftime,sep='-')
length(intersect(svrid_ftime_2014_06_09,svrid_ftime_2014))
idx_dif <- match(setdiff(svrid_ftime_2014_06_09,svrid_ftime_2014),svrid_ftime_2014_06_09)
f2014_06_09_non_intersect <- factorX(f2014_06_09[idx_dif,])
f2013_no_disk_replacing <- factorX(f2013[!check_disk_replacement(f2013),])
f2013 <- check_disk_replacement(f2013)
fnum_month_2013 <- melt(table(cut.POSIXt(f2013$ftime,breaks = 'month')))
fnum_month_2014_06_09 <- melt(table(cut.POSIXt(f2014_06_09$ftime,breaks = 'month')))
fnum_month_2014 <- melt(table(cut.POSIXt(f2014$ftime,breaks = 'month')))
fnum_month_2015 <- melt(table(cut.POSIXt(f2015$ftime,breaks = 'month')))
rm(list = ls());setwd('~/Code/R/Disk_Workload/');source('~/rhead');
source('~/Code/R/Load_Data_Config_Failure/loadFunc.R')
#A.[09-13]
load(file.path(dir_dataCF,'uwork2013.Rda'))
#B.[2014_06-09]
load(file.path(dir_dataCF,'uwork2014_06_09.Rda'))
#C1.[2014]
load(file.path(dir_dataCF,'uwork2014.Rda'))
#C2.[2014M]
load(file.path(dir_dataCF,'merge_id_svrid.Rda'));f2014M <- merge_id_svrid;rm(merge_id_svrid);
names(f2014M) <- c('ftime','ftype','finfo','svrid','ip','tag','svrnum'); f2014M <- f2014M[,c('svrid','ftime','ftype','finfo','svrnum','ip','tag')]
#D.[2015]
load(file.path(dir_dataCF,'failRecord_1407-1506.Rda'));f2015 <- failRecord;rm(failRecord)
names(f2015) <- c('svrid','finfo','ftype','ftime');f2015 <- f2015[,c('svrid','ftime','ftype','finfo')]
# C1. compare B and C1/C2 in order to tell if disk failure of B is included by C1/C2. The Answer is YES.
f2014_06_09_vm <- factorX(f2014_06_09[check_vm(f2014_06_09$svrid),])
f2014_06_09 <- factorX(f2014_06_09[!check_vm(f2014_06_09$svrid),])
f2014_06_09_no_disk_replacing <- check_disk_replacement(f2014_06_09,valid = -1)
f2014_06_09 <- check_disk_replacement(f2014_06_09,valid = 1)
svrid_ftime_2014_06_09 <- paste(f2014_06_09$svrid,f2014_06_09$ftime,sep='-')
svrid_ftime_2014 <- paste(f2014$svrid,f2014$ftime,sep='-')
length(intersect(svrid_ftime_2014_06_09,svrid_ftime_2014))
idx_dif <- match(setdiff(svrid_ftime_2014_06_09,svrid_ftime_2014),svrid_ftime_2014_06_09)
f2014_06_09_non_intersect <- factorX(f2014_06_09[idx_dif,])
# C2. compare number of failure between [2013] and [2014_06_09]. They are very similar in number. But they are different to [2014] and [2015]
f2013_no_disk_replacing <- check_disk_replacement(f2013,valid = 0)
f2013 <- check_disk_replacement(f2013)
fnum_month_2013 <- melt(table(cut.POSIXt(f2013$ftime,breaks = 'month')))
fnum_month_2014_06_09 <- melt(table(cut.POSIXt(f2014_06_09$ftime,breaks = 'month')))
fnum_month_2014 <- melt(table(cut.POSIXt(f2014$ftime,breaks = 'month')))
fnum_month_2015 <- melt(table(cut.POSIXt(f2015$ftime,breaks = 'month')))
View(fnum_month_2014_06_09)
View(f2014_06_09)
rm(list = ls());source('~/rhead')
rm(list = ls());source('~/rhead')
display_svrid <- function(df,fn){
df.fr <- factorX(subset(failRecord,svrid == fct2ori(df$svrid[1])))
p1 <- ggplot(df,aes(x = time,y = util)) + geom_line() + geom_vline(xintercept = as.numeric(df.fr$f_time),size = 1,color = 'red',linetype = 3) + ggtitle(df$svrid[1])
p2 <- ggplot(df,aes(x = time,y = rps)) + geom_line() + geom_vline(xintercept = as.numeric(df.fr$f_time),size = 1,color = 'red',linetype = 3)
p3 <- ggplot(df,aes(x = time,y = wps)) + geom_line() + geom_vline(xintercept = as.numeric(df.fr$f_time),size = 1,color = 'red',linetype = 3)
p4 <- ggplot(df,aes(x = time,y = iopsr)) + geom_line()  + geom_vline(xintercept = as.numeric(df.fr$f_time),size = 1,color = 'red',linetype = 3)
p5 <- ggplot(df,aes(x = time,y = iopsw)) + geom_line()  + geom_vline(xintercept = as.numeric(df.fr$f_time),size = 1,color = 'red',linetype = 3)
p6 <- ggplot(df,aes(x = time,y = sizer)) + geom_line()  + geom_vline(xintercept = as.numeric(df.fr$f_time),size = 1,color = 'red',linetype = 3)
p7 <- ggplot(df,aes(x = time,y = sizew)) + geom_line()  + geom_vline(xintercept = as.numeric(df.fr$f_time),size = 1,color = 'red',linetype = 3)
png(filename = file.path(dir_figure,paste(gsub('\\.Rda','',fn),'-',df$svrid[1],'.png',sep='')),
width = 1920, height = 1080, bg = "white")
multiplot(p1,p2,p3,p4,p5,p6,p7,cols = 1)
dev.off()
}
plot_failure_iops <- function(i){
fn <- fname[i]
cat(sprintf('[%s]file %s START!!!\n',date(),fn))
load(file.path(dir_dataset,fn))
dd <- filter_badiops_NA(dt_dcast,attrName,fn)
dd$sizer <- dd$rps/dd$iopsr;dd$sizer[is.na(dd$sizer) | is.infinite(dd$sizer)] <- 0
dd$sizew <- dd$wps/dd$iopsw;dd$sizew[is.na(dd$sizew) | is.infinite(dd$sizew)] <- 0
dd <- factorX(dd)
splitDD <- split(dd,dd$svrid)
lapply(splitDD,display_svrid,fn)
cat(sprintf('[%s]file %s END!!!\n',date(),fn))
}
dir_dataset <- dir_data15D
dir_dataset <- dir_data15AD
dir_dataset <- dir_data15ADRC
dir_data15ADRC
attrName <- attrNameExtend
dayS <- as.p('2014-07-10');dayE <- as.p('2014-08-01')
load(file.path(dir_data,'failRecord_1407-1506.Rda'))
load(file.path(dir_dataSMT,'SD_replacing_fail_svrid.Rda'))
fname <- list.files(dir_dataset)
idx <- seq_len(length(fname))
dir_figure <- file.path(dir_data,'failureS_iops_1507');check_dir(dir_figure)
fn <- 'd1.Rda'
fn <- fname[i]
cat(sprintf('[%s]file %s START!!!\n',date(),fn))
load(file.path(dir_dataset,fn))
dd <- filter_badiops_NA(dt_dcast,attrName,fn)
dd$sizer <- dd$rps/dd$iopsr;dd$sizer[is.na(dd$sizer) | is.infinite(dd$sizer)] <- 0
dd$sizew <- dd$wps/dd$iopsw;dd$sizew[is.na(dd$sizew) | is.infinite(dd$sizew)] <- 0
dir_dataset <- dir_data15ADC
cat(sprintf('[%s]file %s START!!!\n',date(),fn))
load(file.path(dir_dataset,fn))
dd <- filter_badiops_NA(dt_dcast,attrName,fn)
dd <- filter_badiops_NA(DT,attrName,fn)
attrName
dd <- DT
dd$sizer <- dd$rps/dd$iopsr;dd$sizer[is.na(dd$sizer) | is.infinite(dd$sizer)] <- 0
rm(list = ls());source('~/rhead')
display_svrid <- function(df,fn){
df.fr <- factorX(subset(failRecord,svrid == fct2ori(df$svrid[1])))
col_iopsr <- names(df)[grepl('iopsr',names(df))]
col_iopsw <- names(df)[grepl('iopsw',names(df))]
p_util <- ggplot(df,aes(x = time,y = util)) + geom_line(color = cbPalette[[4]]) + geom_vline(xintercept = as.numeric(df.fr$f_time),size = 1,color = 'yellow') + ggtitle(df$svrid[1])
p_rps <- ggplot(df,aes(x = time,y = rps)) + geom_line(color = cbPalette[[4]]) + geom_vline(xintercept = as.numeric(df.fr$f_time),size = 1,color = 'yellow')
p_wps <- ggplot(df,aes(x = time,y = wps)) + geom_line(color = cbPalette[[4]]) + geom_vline(xintercept = as.numeric(df.fr$f_time),size = 1,color = 'yellow')
p_iopsr <- lapply(col_iopsr,function(cn){
df$tmp <- df[[cn]]
ggplot(df,aes(x = time,y = tmp)) + geom_line(color = cbPalette[[4]]) + geom_vline(xintercept = as.numeric(df.fr$f_time),size = 1,color = 'yellow') + ylab(cn)
})
p_iopsw <- lapply(col_iopsw,function(cn){
df$tmp <- df[[cn]]
ggplot(df,aes(x = time,y = tmp)) + geom_line(color = cbPalette[[4]]) + geom_vline(xintercept = as.numeric(df.fr$f_time),size = 1,color = 'yellow') + ylab(cn)
})
p <- c(list(p_util),list(p_rps),p_iopsr,list(p_util),list(p_wps),p_iopsw)
png(filename = file.path(dir_figure,paste(gsub('\\.Rda','',fn),'-',df$svrid[1],'.png',sep='')),
width = 1920*2, height = 1080*2, bg = "white")
multiplot(plotlist = p,cols = 2)
dev.off()
cat(sprintf('[%s]svrid %s from %s with %d failures DONE!!!\n',date(),df$svrid[1],fn,nrow(df.fr)))
return(0)
}
plot_svrid_iops_2015 <- function(i){
fn <- fname[i]
cat(sprintf('[%s]file %s START!!!\n',date(),fn))
load(file.path(dir_dataset,fn))
dd <- factorX(DT)
# dd <- subset(dd,svrid %in% levels(dd$svrid)[1:10])
splitDD <- split(dd,dd$svrid)
lapply(splitDD,display_svrid,fn)
cat(sprintf('[%s]file %s END!!!\n',date(),fn))
}
load(file.path(dir_data,'failRecord_1407-1506.Rda'))
dir_dataset <- dir_data15ADC
fname <- list.files(dir_dataset)
idx <- seq_len(length(fname))
dir_figure <- file.path(dir_data,'failureS_iops_1507')
check_dir(dir_figure)
load(file.path(dir_dataSMT,'SD_replacing_fail_svrid.Rda'))
View(SD_replacing_fail_svrid)
rm(list = ls());source('~/rhead')
display_svrid <- function(df,fn){
df.fr <- factorX(subset(failRecord,svrid == fct2ori(df$svrid[1])))
col_iopsr <- names(df)[grepl('iopsr',names(df))]
col_iopsw <- names(df)[grepl('iopsw',names(df))]
p_util <- ggplot(df,aes(x = time,y = util)) + geom_line(color = cbPalette[[4]]) + geom_vline(xintercept = as.numeric(df.fr$f_time),size = 1,color = 'yellow') + ggtitle(df$svrid[1])
p_rps <- ggplot(df,aes(x = time,y = rps)) + geom_line(color = cbPalette[[4]]) + geom_vline(xintercept = as.numeric(df.fr$f_time),size = 1,color = 'yellow')
p_wps <- ggplot(df,aes(x = time,y = wps)) + geom_line(color = cbPalette[[4]]) + geom_vline(xintercept = as.numeric(df.fr$f_time),size = 1,color = 'yellow')
p_iopsr <- lapply(col_iopsr,function(cn){
df$tmp <- df[[cn]]
ggplot(df,aes(x = time,y = tmp)) + geom_line(color = cbPalette[[4]]) + geom_vline(xintercept = as.numeric(df.fr$f_time),size = 1,color = 'yellow') + ylab(cn)
})
p_iopsw <- lapply(col_iopsw,function(cn){
df$tmp <- df[[cn]]
ggplot(df,aes(x = time,y = tmp)) + geom_line(color = cbPalette[[4]]) + geom_vline(xintercept = as.numeric(df.fr$f_time),size = 1,color = 'yellow') + ylab(cn)
})
p <- c(list(p_util),list(p_rps),p_iopsr,list(p_util),list(p_wps),p_iopsw)
png(filename = file.path(dir_figure,paste(gsub('\\.Rda','',fn),'-',df$svrid[1],'.png',sep='')),
width = 1920*2, height = 1080*2, bg = "white")
multiplot(plotlist = p,cols = 2)
dev.off()
cat(sprintf('[%s]svrid %s from %s with %d failures DONE!!!\n',date(),df$svrid[1],fn,nrow(df.fr)))
return(0)
}
plot_failureS_iops_1407 <- function(i){
fn <- fname[i]
cat(sprintf('[%s]file %s START!!!\n',date(),fn))
load(file.path(dir_dataset,fn))
dd <- factorX(DT,svrid %in% SD_replacing_fail_svrid$svrid)
# dd <- subset(dd,svrid %in% levels(dd$svrid)[1:10])
splitDD <- split(dd,dd$svrid)
lapply(splitDD,display_svrid,fn)
cat(sprintf('[%s]file %s END!!!\n',date(),fn))
}
load(file.path(dir_data,'failRecord_1407-1506.Rda'))
load(file.path(dir_dataSMT,'SD_replacing_fail_svrid.Rda'))
dir_dataset <- dir_data15ADC
fname <- list.files(dir_dataset)
idx <- seq_len(length(fname))
dir_figure <- file.path(dir_data,'plot_failureS_iops_1407')
check_dir(dir_figure)
r <- foreachX(idx,'plot_failureS_iops_1407')
rm(list = ls());source('~/rhead')
display_svrid <- function(df,fn){
df.fr <- factorX(subset(failRecord,svrid == fct2ori(df$svrid[1])))
col_iopsr <- names(df)[grepl('iopsr',names(df))]
col_iopsw <- names(df)[grepl('iopsw',names(df))]
p_util <- ggplot(df,aes(x = time,y = util)) + geom_line(color = cbPalette[[4]]) + geom_vline(xintercept = as.numeric(df.fr$f_time),size = 1,color = 'yellow') + ggtitle(df$svrid[1])
p_rps <- ggplot(df,aes(x = time,y = rps)) + geom_line(color = cbPalette[[4]]) + geom_vline(xintercept = as.numeric(df.fr$f_time),size = 1,color = 'yellow')
p_wps <- ggplot(df,aes(x = time,y = wps)) + geom_line(color = cbPalette[[4]]) + geom_vline(xintercept = as.numeric(df.fr$f_time),size = 1,color = 'yellow')
p_iopsr <- lapply(col_iopsr,function(cn){
df$tmp <- df[[cn]]
ggplot(df,aes(x = time,y = tmp)) + geom_line(color = cbPalette[[4]]) + geom_vline(xintercept = as.numeric(df.fr$f_time),size = 1,color = 'yellow') + ylab(cn)
})
p_iopsw <- lapply(col_iopsw,function(cn){
df$tmp <- df[[cn]]
ggplot(df,aes(x = time,y = tmp)) + geom_line(color = cbPalette[[4]]) + geom_vline(xintercept = as.numeric(df.fr$f_time),size = 1,color = 'yellow') + ylab(cn)
})
p <- c(list(p_util),list(p_rps),p_iopsr,list(p_util),list(p_wps),p_iopsw)
png(filename = file.path(dir_figure,paste(gsub('\\.Rda','',fn),'-',df$svrid[1],'.png',sep='')),
width = 1920*2, height = 1080*2, bg = "white")
multiplot(plotlist = p,cols = 2)
dev.off()
cat(sprintf('[%s]svrid %s from %s with %d failures DONE!!!\n',date(),df$svrid[1],fn,nrow(df.fr)))
return(0)
}
plot_failureS_iops_1407 <- function(i){
fn <- fname[i]
cat(sprintf('[%s]file %s START!!!\n',date(),fn))
load(file.path(dir_dataset,fn))
dd <- factorX(DT,svrid %in% SD_replacing_fail_svrid$svrid)
# dd <- subset(dd,svrid %in% levels(dd$svrid)[1:10])
splitDD <- split(dd,dd$svrid)
lapply(splitDD,display_svrid,fn)
cat(sprintf('[%s]file %s END!!!\n',date(),fn))
}
load(file.path(dir_data,'failRecord_1407-1506.Rda'))
load(file.path(dir_dataSMT,'SD_replacing_fail_svrid.Rda'))
dir_dataset <- dir_data15ADC
fname <- list.files(dir_dataset)
idx <- seq_len(length(fname))
dir_figure <- file.path(dir_data,'plot_failureS_iops_1407')
check_dir(dir_figure)
fn <- 'd1.Rda'
cat(sprintf('[%s]file %s START!!!\n',date(),fn))
load(file.path(dir_dataset,fn))
dd <- factorX(DT,svrid %in% SD_replacing_fail_svrid$svrid)
load(file.path(dir_dataCF,'merge_id_svrid.Rda'))
SD_replacing_fail_svrid$svrnum <- merge_id_svrid$sid[match(SD_replacing_fail_svrid$svrid,merge_id_svrid$svrid)]
dd <- factorX(DT,svrid %in% SD_replacing_fail_svrid$svrnum)
dd <- factorX(subset(DT,svrid %in% SD_replacing_fail_svrid$svrnum))
View(SD_replacing_fail_svrid)
fn <- 'd2.Rda'
cat(sprintf('[%s]file %s START!!!\n',date(),fn))
load(file.path(dir_dataset,fn))
dd <- factorX(subset(DT,svrid %in% SD_replacing_fail_svrid$svrnum))
splitDD <- split(dd,dd$svrid)
lapply(splitDD,display_svrid,fn)
dd <- factorX(subset(DT,svrid %in% SD_replacing_fail_svrid$svrnum & time > dayS & time < dayE))
dayS <- as.p('2014-07-10');dayE <- as.p('2014-08-01')
dd <- factorX(subset(DT,svrid %in% SD_replacing_fail_svrid$svrnum & time > dayS & time < dayE))
splitDD <- split(dd,dd$svrid)
lapply(splitDD,display_svrid,fn)
source('~/Code/R/Disk_Workload/Plot_Figure/plot_failureS_iops_1407.R')
a <- subset(failRecord,svrid %in% SD_replacing_fail$svrid)
a <- subset(failRecord,svrid %in% SD_replacing_fail_svrid$svrnum)
View(a)
View(SD_replacing_fail_svrid)
rm(list = ls());setwd('~/Code/R/Disk_Workload/');source('~/rhead')
gen_util_sta <- function(df){
tmp_count <- tapply(df$util,df$tag,length);tmp_count[is.na(tmp_count)] <- 0;names(tmp_count) <- paste('count',1:4,sep='')
tmp_sum <- tapply(df$util,df$tag,sum);tmp_sum[is.na(tmp_sum)] <- 0;names(tmp_sum) <- paste('sum',1:4,sep='')
r <- data.frame(svrid = df$svrid[1],
util_count = nrow(df),t(tmp_count),
util_sum = sum(df$util)/100,t(tmp_sum)/100)
}
duty_time_group <- function(i){
fn <- fname[i]
cat(sprintf('[%s]\tfile:%s\tSTART!!!\n',date(),fn))
load(file.path(dir_dataset,fn))
DT$time <- as.Date(DT$time)
tagSet <- c('idle','busy1','busy2','busy3')
DT$tag <- tagSet[1]
DT$tag[DT$rps > 0 & DT$wps <= 64] <- tagSet[2]
DT$tag[DT$rps == 0 & DT$wps > 64] <- tagSet[3]
DT$tag[DT$rps > 0 & DT$wps > 64] <- tagSet[4]
DT$tag <- factor(DT$tag,levels = tagSet)
splitDT <- split(DT,DT$svrid)
r <- lapplyX(splitDT,gen_util_sta)
row.names(r) <- NULL
r
# sta_svrid <- list2df(tapply(DT$tag,DT$svrid,table),n = tagSet)
# sta_day <- lapplyX(splitDT,function(df){
#   r <- list2df(tapply(df$tag,df$time,table),n = c(tagSet,'time'))
#   r$svrid <- df$svrid[1]
#   r})
# row.names(sta_day) <- NULL
# sta_day <- sta_day[,c('svrid','time',tagSet)]
cat(sprintf('[%s]\tfile:%s\tEND!!!\n',date(),fn))
r
}
dir_dataset <- dir_data14DC
cutList <- list(cut_util = sort(c(0,3,2^(0:6),95,101)))
fname <- list.files(dir_dataset)
idx <- seq_len(length(fname))
i = 1
cat(sprintf('[%s]\tfile:%s\tSTART!!!\n',date(),fn))
fn <- fname[i]
cat(sprintf('[%s]\tfile:%s\tSTART!!!\n',date(),fn))
load(file.path(dir_dataset,fn))
tagSet <- c('idle','busy1','busy2','busy3')
tagSet <- c('idle','busy1','busy2','busy3')
DT$tag <- tagSet[1]
DT$tag[DT$rps > 0 & DT$wps <= 64] <- tagSet[2]
DT$tag[DT$rps == 0 & DT$wps > 64] <- tagSet[3]
DT$tag[DT$rps > 0 & DT$wps > 64] <- tagSet[4]
DT$tag <- factor(DT$tag,levels = tagSet)
splitDT <- split(DT,DT$svrid)
df <- splitDT[[1]]
View(df)
tmp_count <- tapply(df$util,df$tag,length)
tmp_count[is.na(tmp_count)] <- 0
names(tmp_count) <- paste('count',1:4,sep='')
tmp_sum <- tapply(df$util,df$tag,sum)
tmp_sum[is.na(tmp_sum)] <- 0
names(tmp_sum) <- paste('sum',1:4,sep='')
a <- melt(quantileX(DT$util))
View(a)
cutList <- list(cut_util = sort(c(0,3,2^(0:6),95,101)))
cutList$cut_util
DT$util_level <- cut_level(DT$util,cutList$cut_util,T)
table(DT$util_level)
a <- table(DT$util_level)
array_rate(a)
splitDT <- split(DT,DT$svrid)
df <- splitDT[[1]]
melt_table(df$util_level,df$tag)
r1 <- melt_table(df$util_level,df$tag)
r1$svrid <- fct2ori(df$svrid[1])
View(r1)
gen_2d_class <- function(df,fn){
cat(sprintf('[%s]%s\n',date(),fn))
r1 <- melt_table(df$util_level,df$tag)
r1$svrid <- fct2ori(df$svrid[1])
r1$fn <- fn
return(r1)
}
r <- lapplyX(splitDT,gen_2d_class,fn)
gen_2d_class <- function(df,fn){
cat(sprintf('[%s]%s\n',date(),df$svrid[1]))
r1 <- melt_table(df$util_level,df$tag)
r1$svrid <- fct2ori(df$svrid[1])
r1$fn <- fn
return(r1)
}
r <- lapplyX(splitDT,gen_2d_class,fn)
DT$util_level <- cut_level(DT$util,cutList$cut_util,F)
splitDT <- split(DT,DT$svrid)
r <- lapply(splitDT[1:10],gen_2d_class,fn)
levels(DT$util_level)
df <- splitDT[1]
df <- splitDT[[1]]
r1 <- melt_table(df$util_level,df$tag)
table(df$util_level,df$tag)
r1 <- melt(table(df$util_level,df$tag))
r1$svrid <- fct2ori(df$svrid[1])
r1$fn <- fn
View(r1)
r <- lapply(splitDT[1:10],gen_2d_class)
gen_2d_class <- function(df){
# cat(sprintf('[%s]%s\n',date(),df$svrid[1]))
r1 <- melt(table(df$util_level,df$tag))
r1$svrid <- fct2ori(df$svrid[1])
return(r1)
}
r <- lapply(splitDT[1:10],gen_2d_class)
source('~/Code/R/Disk_Workload/duty_time/duty_time_group.R')
a <- lapply(duty_time_svrid,'[[',1)
length(a)
length(duty_time_svrid)
length(duty_time_svrid[[1]])
a <- c(duty_time_svrid)
a <- sapply(duty_time_svrid,function(x)x)
a <- unlist(duty_time_svrid,recursive = F)
a[1]
length(a)
a[[1]]
duty_time_svrid <- unlist(r,recursive = F)
save(duty_time_svrid,file = file.path(dir_data,'duty_time_group.Rda'))
df <- duty_time_svrid[[1]]
View(df)
dts_rate <- lapply(duty_time_svrid,function(df){
df$value <- array_rate(df$value)
names(df) <- c('util_level','tag_strength','rate','svrid')
return(df)
})
save(duty_time_svrid,dts_rate,file = file.path(dir_data,'duty_time_group.Rda'))
df <- dts_rate[[3333]]
View(df)
dts <- do.call(rbind,dts_rate)
df <- duty_time_svrid[[1]]
df$value <- array_rate(df$value)
names(df) <- c('util_level','tag_strength','rate','svrid')
rbind(t(df$rate),df$svrid[1])
cbind(t(df$rate),df$svrid[1])
View(df)
col_class <- paste(rep(tagSet,each = 10),rep(1:10,4),sep='')
col_class
col_class <- paste(rep(c('A','B','C','D'),each = 10),rep(1:10,4),sep='')
col_class <- c('svrid',paste(rep(c('A','B','C','D'),each = 10),rep(1:10,4),sep=''))
col_class
names(r) <- col_class
r <- cbind(df$svrid[1],t(df$rate))
names(r) <- col_class
View(r)
names(r) <- col_class
View(r)
names(r)
r
r <- data.frame(cbind(df$svrid[1],t(df$rate)))
names(r) <- col_class
r
dts_rate <- lapply(duty_time_svrid,function(df){
df$value <- array_rate(df$value)
names(df) <- c('util_level','tag_strength','rate','svrid')
r <- data.frame(cbind(df$svrid[1],t(df$rate)))
names(r) <- col_class
return(r)
})
df
df$value <- array_rate(df$value)
cbind(df$svrid[1],t(df$value))
df$svrid[1],t(df$value)
df$svrid[1]
t(df$value)
df$value
df <- duty_time_svrid[[2344]]
df$value <- array_rate(df$value)
cbind(df$svrid[1],t(df$value))
dts_rate <- lapply(duty_time_svrid[1:10],function(df){
df$value <- array_rate(df$value)
return(cbind(df$svrid[1],t(df$value)))
})
dts_rate <- sapply(duty_time_svrid[1:10],function(df){
df$value <- array_rate(df$value)
return(cbind(df$svrid[1],t(df$value)))
})
View(dts_rate)
class(dts_rate)
dts_rate[2,]
dts_rate <- sapply(duty_time_svrid[1:10],function(df){
df$value <- array_rate(df$value)
return(df$value))
})
dts_rate <- sapply(duty_time_svrid[1:10],function(df){
df$value <- array_rate(df$value)
return(df$value)
})
View(dts_rate)
?kmeans
dts_rate <- data.frame(t(dts_rate))
View(dts_rate)
names(dts_rate) <- col_class
col_class <- c(paste(rep(c('A','B','C','D'),each = 10),rep(1:10,4),sep=''))
names(dts_rate) <- col_class
save(duty_time_svrid,dts_rate,file = file.path(dir_data,'duty_time_group.Rda'))
1
View(dts_rate)
dts_rate <- sapply(duty_time_svrid,function(df)array_rate(df$value))
dts_rate <- data.frame(t(dts_rate))
names(dts_rate) <- col_class
save(duty_time_svrid,dts_rate,file = file.path(dir_data,'duty_time_group.Rda'))
system.time(model <- kmeans(dts_rate,centers = 10,nstart = 3,algorithm = 'Hartigan-Wong'))
summary(model)
table(model$cluster)
model$centers
roundX(model$centers)
colSums(roundX(model$centers))
system.time(model <- kmeans(dts_rate,centers = 7,nstart = 3,algorithm = 'Hartigan-Wong'))
model$centers
roundX(model$centers)
model$size
system.time(model <- kmeans(dts_rate,centers = 10,nstart = 3,algorithm = 'Hartigan-Wong'))
roundX(model$centers)
system.time(model <- kmeans(dts_rate,centers = 10,nstart = 10,algorithm = 'Hartigan-Wong'))
roundX(model$centers)
model$size
centers <- apply(model$centers,1,function(x)matrix(x,byrow = T,nrow = 4))
View(centers)
x <- model$centers[1,]
matrix(x,byrow = T,nrow = 4)
centers <- apply(model$centers,1,function(x)data.frame(matrix(x,byrow = T,nrow = 4)))
centers <- apply(model$centers,1,function(x)data.frame(roundX(matrix(x,byrow = T,nrow = 4))))
centers[[1]]
centers[[2]]
r <- data.frame(roundX(matrix(x,byrow = T,nrow = 4)))
centers <- apply(model$centers,1,function(x){
r <- data.frame(roundX(matrix(x,byrow = T,nrow = 4)))
r$rowS <- rowSums(r)
r <- rbind(r,colSums(r))
return(r)
})
centers[[1]]
centers[[2]]
centers[[3]]
centers[[4]]
centers[[5]]
centers[[6]]
centers[[7]]
centers[[8]]
centers[[9]]
centers[[10]]
model$size
svrid_centers <- data.frame(svrid = names(dts_rate),center = model$centers)
svrid_centers <- data.frame(svrid = names(dts_rate),center = model$cluster)
svrid_centers <- data.frame(svrid = row.names(dts_rate),center = model$cluster)
View(svrid_centers)
save(svrid_centers,model,centers,duty_time_svrid,dts_rate,file = file.path(dir_data,'duty_time_group.Rda'))
View(dts_rate)
View(svrid_centers)
rm(list = ls());setwd('~/Code/R/Disk_Workload/');source('~/rhead')
dir_dataset <- dir_data14DC
cutList <- list(cut_util = sort(c(0,3,2^(0:6),95,101)))
fname <- list.files(dir_dataset)
idx <- seq_len(length(fname))
i = 1
fn <- fname[i]
cat(sprintf('[%s]\tfile:%s\tSTART!!!\n',date(),fn))
load(file.path(dir_dataset,fn))
source('~/Code/R/Disk_Workload/duty_time/duty_time_groupby_mean.R')
View(DT_mean)
summary(DT_mean)
