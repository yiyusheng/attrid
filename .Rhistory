source('head.R')
source('iopsFunc.R')
dir_iops <- '/home/yiyusheng/Data/tencProcess/mergePartSvrid'
dir_datasource <- '/home/yiyusheng/Data/dataLoadforDiskAnalysis/'
load(file.path(dir_data,'locate_fail.Rda'))
# S1. load io dataset
load(file.path(dir_iops,'b6.Rda'))
load(file.path(dir_datasource,'load_ftr_attrid.Rda'))
dt <- data
names(dt)[names(dt) == 'svr_id'] <- 'sid'
aid <- c(902,903,999,36810:36857)
dt$svrid <- factor(merge_id_svrid$svrid[match(dt$sid,merge_id_svrid$sid)])
dir_ten <- "/home/yiyusheng/Data/tencProcess"
load(file.path(dir_ten,'merge_id_svrid.Rda'))
dt$svrid <- factor(merge_id_svrid$svrid[match(dt$sid,merge_id_svrid$sid)])
yk_disk <- pos_disk
ym_disk <- ext_disk
View(yk_disk)
yk_disk$dist_f_time <- abs(difftime(yk_disk$failed_time,yk_disk$f_time_new,units = 'days'))
yk_disk$dist_f_time <- as.numeric(abs(difftime(yk_disk$failed_time,yk_disk$f_time_new,units = 'days')))
hist(yk_disk$dist_f_time)
a <- cut(yk_disk$dist_f_time,seq(1,400,20))
table(a)
yk_disk_same_time <- subset(yk_disk,disk_f_time <= 5)
yk_disk_same_time <- subset(yk_disk,dist_f_time <= 5)
View(yk_disk_same_time)
hist(yk_disk_same_time$dist_f_time)
yk_disk_same_time$dev_class_id <- cmdb$dev_class_id[match(yk_disk_same_time$svrid,cmdb$svr_asset_id)]
View(yk_disk_same_time)
table(yk_disk_same_time$dev_class_id)
table(factor(yk_disk_same_time$dev_class_id))
yk_disk_c1 <- factorX(yk_disk_same_time,dev_class_id == 'C1')
yk_disk_c1 <- factorX(subset(yk_disk_same_time,dev_class_id == 'C1'))
View(yk_disk_c1)
smpIO <- subset(dt,svrid == yk_disk_c1$svrid[1])
# & date > 20141001 & date < 20141101)
smpIO$time <- as.POSIXct(as.character(smpIO$date),tz = 'UTC',format = '%Y%m%d') + smpIO$timepoint*300
smpIO$attrid <- paste('X',smpIO$attrid,sep='')
smpIO_dcast <- dcast(smpIO[,c('svrid','time','attrid','value')],svrid + time ~ attrid,value.var = 'value',fill = 0)
ggplot(smpIO_dcast,aes(x = time,y = X999)) + geom_line()
smpIO <- subset(dt,svrid == yk_disk_c1$svrid[1])
smpIO <- subset(dt,svrid == fct2ori(yk_disk_c1$svrid[1]))
yk_disk_c1$svrid[1]
yk_disk_c1 <- factorX(subset(yk_disk_same_time,dev_class_id == 'C1' & svrid %in% dt$svrid))
smpIO <- subset(dt,svrid == fct2ori(yk_disk_c1$svrid[1]))
View(yk_disk_c1)
smpIO$time <- as.POSIXct(as.character(smpIO$date),tz = 'UTC',format = '%Y%m%d') + smpIO$timepoint*300
smpIO$attrid <- paste('X',smpIO$attrid,sep='')
smpIO_dcast <- dcast(smpIO[,c('svrid','time','attrid','value')],svrid + time ~ attrid,value.var = 'value',fill = 0)
ggplot(smpIO_dcast,aes(x = time,y = X999)) + geom_line()
View(smpIO_dcast)
ggplot(smpIO_dcast,aes(x = time,y = X902)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X903)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X999)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36810)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36811)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36834)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36835)) + geom_line()
yk_disk <- pos_disk
yk_disk$dist_f_time <- as.numeric(abs(difftime(yk_disk$failed_time,yk_disk$f_time_new,units = 'days')))
yk_disk_same_time <- subset(yk_disk,dist_f_time <= 5 & svrid %in% dt$svrid)
yk_disk_same_time$dev_class_id <- cmdb$dev_class_id[match(yk_disk_same_time$svrid,cmdb$svr_asset_id)]
yk_disk_c1 <- factorX(subset(yk_disk_same_time))
View(yk_disk_c1)
smpIO <- subset(dt,svrid == fct2ori(yk_disk_c1$svrid[2]))
# & date > 20141001 & date < 20141101)
smpIO$time <- as.POSIXct(as.character(smpIO$date),tz = 'UTC',format = '%Y%m%d') + smpIO$timepoint*300
smpIO$attrid <- paste('X',smpIO$attrid,sep='')
smpIO_dcast <- dcast(smpIO[,c('svrid','time','attrid','value')],svrid + time ~ attrid,value.var = 'value',fill = 0)
ggplot(smpIO_dcast,aes(x = time,y = X902)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X903)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X999)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36810)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36811)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36834)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36835)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X902)) + geom_line()
View(smpIO_dcast)
ggplot(smpIO_dcast,aes(x = time,y = X903)) + geom_line()
smpIO <- subset(dt,svrid == fct2ori(yk_disk_c1$svrid[3]))
# & date > 20141001 & date < 20141101)
smpIO$time <- as.POSIXct(as.character(smpIO$date),tz = 'UTC',format = '%Y%m%d') + smpIO$timepoint*300
smpIO$attrid <- paste('X',smpIO$attrid,sep='')
smpIO_dcast <- dcast(smpIO[,c('svrid','time','attrid','value')],svrid + time ~ attrid,value.var = 'value',fill = 0)
ggplot(smpIO_dcast,aes(x = time,y = X902)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X903)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X999)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36810)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36811)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36834)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36835)) + geom_line()
smpIO <- subset(dt,svrid == fct2ori(yk_disk_c1$svrid[4]))
# & date > 20141001 & date < 20141101)
smpIO$time <- as.POSIXct(as.character(smpIO$date),tz = 'UTC',format = '%Y%m%d') + smpIO$timepoint*300
smpIO$attrid <- paste('X',smpIO$attrid,sep='')
smpIO_dcast <- dcast(smpIO[,c('svrid','time','attrid','value')],svrid + time ~ attrid,value.var = 'value',fill = 0)
ggplot(smpIO_dcast,aes(x = time,y = X902)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X903)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X999)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36810)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36811)) + geom_line()
smpIO <- subset(dt,svrid == fct2ori(yk_disk_c1$svrid[5]))
# & date > 20141001 & date < 20141101)
smpIO$time <- as.POSIXct(as.character(smpIO$date),tz = 'UTC',format = '%Y%m%d') + smpIO$timepoint*300
smpIO$attrid <- paste('X',smpIO$attrid,sep='')
smpIO_dcast <- dcast(smpIO[,c('svrid','time','attrid','value')],svrid + time ~ attrid,value.var = 'value',fill = 0)
ggplot(smpIO_dcast,aes(x = time,y = X902)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X903)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X999)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36810)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36811)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36834)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36835)) + geom_line()
a <- subset(smpIO_dcast,as.Date(time) == as.Date('2014-07-19'))
source('~/Code/R/attrid/find_relation_io_failure.R')
rm(list = ls())
source('head.R')
source('iopsFunc.R')
dir_iops <- '/home/yiyusheng/Data/tencProcess/mergePartSvrid'
dir_datasource <- '/home/yiyusheng/Data/dataLoadforDiskAnalysis/'
dir_ten <- "/home/yiyusheng/Data/tencProcess"
# S1. load io dataset
load(file.path(dir_iops,'b1.Rda'))
load(file.path(dir_datasource,'load_ftr_attrid.Rda'))
load(file.path(dir_ten,'merge_id_svrid.Rda'))
load(file.path(dir_data,'locate_fail.Rda'))
dt <- data
names(dt)[names(dt) == 'svr_id'] <- 'sid'
aid <- c(902,903,999,36810:36857)
dt$svrid <- factor(merge_id_svrid$svrid[match(dt$sid,merge_id_svrid$sid)])
yk_disk <- pos_disk
yk_disk$dist_f_time <- as.numeric(abs(difftime(yk_disk$failed_time,yk_disk$f_time_new,units = 'days')))
yk_disk_same_time <- subset(yk_disk,dist_f_time <= 5 & svrid %in% dt$svrid)
yk_disk_same_time$dev_class_id <- cmdb$dev_class_id[match(yk_disk_same_time$svrid,cmdb$svr_asset_id)]
yk_disk_c1 <- factorX(subset(yk_disk_same_time))
View(yk_disk_c1)
smpIO <- subset(dt,svrid == fct2ori(yk_disk_c1$svrid[5]))
smpIO$time <- as.POSIXct(as.character(smpIO$date),tz = 'UTC',format = '%Y%m%d') + smpIO$timepoint*300
smpIO$attrid <- paste('X',smpIO$attrid,sep='')
smpIO_dcast <- dcast(smpIO[,c('svrid','time','attrid','value')],svrid + time ~ attrid,value.var = 'value',fill = 0)
smpIO <- subset(dt,svrid == fct2ori(yk_disk_c1$svrid[1]))
smpIO$time <- as.POSIXct(as.character(smpIO$date),tz = 'UTC',format = '%Y%m%d') + smpIO$timepoint*300
smpIO$attrid <- paste('X',smpIO$attrid,sep='')
smpIO_dcast <- dcast(smpIO[,c('svrid','time','attrid','value')],svrid + time ~ attrid,value.var = 'value',fill = 0)
ggplot(smpIO_dcast,aes(x = time,y = X902)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X903)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X999)) + geom_line()
smpIO <- subset(dt,sid == yk_disk_c1$sid[1])
smpIO$time <- as.POSIXct(as.character(smpIO$date),tz = 'UTC',format = '%Y%m%d') + smpIO$timepoint*300
smpIO$attrid <- paste('X',smpIO$attrid,sep='')
smpIO_dcast <- dcast(smpIO[,c('svrid','time','attrid','value')],svrid + time ~ attrid,value.var = 'value',fill = 0)
ggplot(smpIO_dcast,aes(x = time,y = X902)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X999)) + geom_line()
a <- subset(smpIO_dast,abs(difftime(time,yk_disk_c1$failed_time[i],units = 'days')) < 5)
a <- subset(smpIO_dcast,abs(difftime(time,yk_disk_c1$failed_time[i],units = 'days')) < 5)
a <- subset(smpIO_dcast,abs(difftime(time,yk_disk_c1$failed_time[1],units = 'days')) < 5)
View(a)
smpIO_dcast <- subset(smpIO_dcast,abs(difftime(time,yk_disk_c1$failed_time[1],units = 'days')) < 5)
ggplot(smpIO_dcast,aes(x = time,y = X902)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X903)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X999)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36810)) + geom_line()
smpIO_dcast <- dcast(smpIO[,c('svrid','time','attrid','value')],svrid + time ~ attrid,value.var = 'value',fill = 0)
smpIO_dcast <- subset(smpIO_dcast,abs(difftime(time,yk_disk_c1$failed_time[1],units = 'days')) < 20)
ggplot(smpIO_dcast,aes(x = time,y = X902)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X903)) + geom_line()
smpIO_dcast <- dcast(smpIO[,c('svrid','time','attrid','value')],svrid + time ~ attrid,value.var = 'value',fill = 0)
smpIO_dcast <- subset(smpIO_dcast,abs(difftime(time,yk_disk_c1$failed_time[1],units = 'days')) < 10)
ggplot(smpIO_dcast,aes(x = time,y = X902)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X903)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X999)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36810)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36811)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36834)) + geom_line()
ydi <- yk_disk_inter[2,]
yk_disk_inter <- factorX(subset(yk_disk_same_time))
# smpIO <- subset(dt,svrid == fct2ori(yk_disk_c1$svrid[1]))
ydi <- yk_disk_inter[2,]
smpIO <- subset(dt,sid == ydi$sid)
smpIO$time <- as.POSIXct(as.character(smpIO$date),tz = 'UTC',format = '%Y%m%d') + smpIO$timepoint*300
smpIO$attrid <- paste('X',smpIO$attrid,sep='')
smpIO_dcast <- dcast(smpIO[,c('svrid','time','attrid','value')],svrid + time ~ attrid,value.var = 'value',fill = 0)
smpIO_dcast <- subset(smpIO_dcast,abs(difftime(time,ydi$failed_time,units = 'days')) < 10)
ggplot(smpIO_dcast,aes(x = time,y = X902)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X903)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X999)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36810)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36811)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36834)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36835)) + geom_line()
smpIO_dcast <- dcast(smpIO[,c('svrid','time','attrid','value')],svrid + time ~ attrid,value.var = 'value',fill = 0)
smpIO_dcast <- subset(smpIO_dcast,abs(difftime(time,ydi$failed_time,units = 'days')) < 5)
ggplot(smpIO_dcast,aes(x = time,y = X902)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X903)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X999)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36810)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36811)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36834)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36835)) + geom_line()
ydi <- yk_disk_inter[3,]
smpIO <- subset(dt,sid == ydi$sid)
smpIO$time <- as.POSIXct(as.character(smpIO$date),tz = 'UTC',format = '%Y%m%d') + smpIO$timepoint*300
smpIO$attrid <- paste('X',smpIO$attrid,sep='')
smpIO_dcast <- dcast(smpIO[,c('svrid','time','attrid','value')],svrid + time ~ attrid,value.var = 'value',fill = 0)
smpIO_dcast <- subset(smpIO_dcast,abs(difftime(time,ydi$failed_time,units = 'days')) < 5)
ggplot(smpIO_dcast,aes(x = time,y = X902)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X903)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X999)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36810)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36811)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36834)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36835)) + geom_line()
yk_disk_inter <- merge(yk_disk_inter,ext_disk,by = 'svrid')
View(yk_disk_inter)
yk_disk_inter <- factorX(subset(yk_disk_same_time))
yk_disk_inter <- merge(yk_disk_inter,ext_disk[,c('svrid','eventdescription')],by = 'svrid')
View(ext_disk)
source('~/Code/R/attrid/find_relation_io_failure.R')
ggplot(smpIO_dcast,aes(x = time,y = X902)) + geom_line()
View(yk_disk_inter)
ggplot(smpIO_dcast,aes(x = time,y = X903)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X999)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36810)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36811)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X902)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X903)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X999)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36810)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36811)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36834)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36835)) + geom_line()
source('~/Code/R/attrid/find_relation_io_failure.R')
View(yk_disk_inter)
ggplot(smpIO_dcast,aes(x = time,y = X902)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X903)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X999)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36810)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36811)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36834)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36835)) + geom_line()
ydi <- yk_disk_inter[2,]
smpIO <- subset(dt,sid == ydi$sid)
smpIO$time <- as.POSIXct(as.character(smpIO$date),tz = 'UTC',format = '%Y%m%d') + smpIO$timepoint*300
smpIO$attrid <- paste('X',smpIO$attrid,sep='')
smpIO_dcast <- dcast(smpIO[,c('svrid','time','attrid','value')],svrid + time ~ attrid,value.var = 'value',fill = 0)
smpIO_dcast <- subset(smpIO_dcast,abs(difftime(time,ydi$failed_time,units = 'days')) < 5)
ggplot(smpIO_dcast,aes(x = time,y = X902)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X903)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X999)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36810)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36811)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36834)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X36835)) + geom_line()
source('~/Code/R/attrid/find_relation_io_failure.R')
ggplot(smpIO_dcast,aes(x = time,y = X902)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X903)) + geom_line()
ggplot(smpIO_dcast,aes(x = time,y = X999)) + geom_line()
ydi <- yk_disk_inter[1,]
smpIO <- subset(dt,sid == ydi$sid)
smpIO$time <- as.POSIXct(as.character(smpIO$date),tz = 'UTC',format = '%Y%m%d') + smpIO$timepoint*300
smpIO$attrid <- paste('X',smpIO$attrid,sep='')
smpIO_dcast <- dcast(smpIO[,c('svrid','time','attrid','value')],svrid + time ~ attrid,value.var = 'value',fill = 0)
smpIO_dcast <- subset(smpIO_dcast,abs(difftime(time,ydi$failed_time,units = 'days')) < 5)
ydi <- yk_disk_inter[3,]
smpIO <- subset(dt,sid == ydi$sid)
smpIO$time <- as.POSIXct(as.character(smpIO$date),tz = 'UTC',format = '%Y%m%d') + smpIO$timepoint*300
smpIO$attrid <- paste('X',smpIO$attrid,sep='')
smpIO_dcast <- dcast(smpIO[,c('svrid','time','attrid','value')],svrid + time ~ attrid,value.var = 'value',fill = 0)
smpIO_dcast <- subset(smpIO_dcast,abs(difftime(time,ydi$failed_time,units = 'days')) < 5)
smpIO_dcast <- dcast(smpIO[,c('svrid','time','attrid','value')],svrid + time ~ attrid,value.var = 'value',fill = 0)
View(smpIO)
div <- seq.POSIXt(as.p('2014-07-01'),as.p('2015-07-01'),by = 300)
tail(div)
div <- seq.POSIXt(as.p('2014-07-01'),as.p('2015-07-01'),by = 300)
?seq.POSIXt
?seq
div <- seq.POSIXt(as.p('2014-07-01'),as.p('2015-07-01'),by = 300);div <- div[1:(length(div)-1)]
tmp <- data.frame(timepoint = div,fill = F)
tmp$fill[tmp$timepoint %in% smpIO$time] <- T
a <- subset(tmp.fill == F)
a <- subset(tmp,fill == F)
View(a)
unique(as.Date(a$timepoint))
tmp$fill[tmp$timepoint %in% smpIO_dcast$time] <- T
max_tp <- max(smpIO_dcast$time)
max_tp <- max(smpIO_dcast$time)
min_tp <- min(smpIO_dcast$time)
seq_tp <- seq.POSIXt(min_tp,max_tp,300)
seq_tp[as.Date(seq_tp) == as.Date('2014-10-27') | as.Date(seq_tp) == as.Date('2015-05-07')]
seq_tp[as.Date(seq_tp) == as.Date('2014-10-27') | as.Date(seq_tp) == as.Date('2015-05-07')] <- NULL
seq_tp[as.Date(seq_tp) == as.Date('2014-10-27') | as.Date(seq_tp) == as.Date('2015-05-07')] <- NULL
svr_iocheck <- data.frame(timepoint = seq_tp,check = F)
svr_iocheck$check[svr_iocheck$timepoint %in% smpIO_dcast$time] <- T
svr_iocheck_exist <- subset(svr_iocheck,check == T)
svr_iocheck_noexist <- subset(svr_iocheck,check == F)
View(svr_iocheck_noexist)
sum(as.Date(seq_tp) == as.Date('2014-10-27'))
seq_tp <- seq_tp[as.Date(seq_tp) != as.Date('2014-10-27') & as.Date(seq_tp) != as.Date('2015-05-07')]
max_tp <- max(smpIO$time)
min_tp <- min(smpIO$time)
nrow(seq_tp) == length(unqieu(smpIO$time))
nrow(seq_tp) == length(unique(smpIO$time))
length(unique(smpIO$time))
nrow(seq_tp)
length(seq_tp) == length(unique(smpIO$time))
fname <- list.files(dir_iops)
missing_svr <- function(sid){
smpIO <- subset(dt,svrid == sid)
max_tp <- max(smpIO$time)
min_tp <- min(smpIO$time)
seq_tp <- seq.POSIXt(min_tp,max_tp,300)
seq_tp <- seq_tp[as.Date(seq_tp) != as.Date('2014-10-27') & as.Date(seq_tp) != as.Date('2015-05-07')]
uni_tp <- unique(smpIO$time)
if(length(seq_tp) == length(uni_tp)){
return(NULL)
}else{
svr_iocheck <- data.frame(timepoint = seq_tp,check = F)
svr_iocheck$check[svr_iocheck$timepoint %in% uni_tp] <- T
svr_iocheck_noexist <- subset(svr_iocheck,check == F)
return(c(unique(as.Date(svr_iocheck_noexist$timepoint))))
}
}
missing_date <- function(i){
load(file.path(dir_iops,fname[i]))
dt <- data
names(dt)[names(dt) == 'svr_id'] <- 'sid'
dt$svrid <- factor(merge_id_svrid$svrid[match(dt$sid,merge_id_svrid$sid)])
uni_sid <- levels(dt$svrid)
missing_svr <- data.frame(svrid = uni_sid,
sapply(uni_sid,missing_svr))
}
r <- missing_data(10)
i = 10
load(file.path(dir_iops,fname[i]))
dt <- data
names(dt)[names(dt) == 'svr_id'] <- 'sid'
dt$svrid <- factor(merge_id_svrid$svrid[match(dt$sid,merge_id_svrid$sid)])
uni_sid <- levels(dt$svrid)
fname[10]
uni_sid <- levels(dt$svrid)[1:10]
missing_svr <- data.frame(svrid = uni_sid,
sapply(uni_sid,missing_svr))
missing_svr <- function(sid){
cat(sprintf('sid: %s',sid))
smpIO <- subset(dt,svrid == sid)
max_tp <- max(smpIO$time)
min_tp <- min(smpIO$time)
seq_tp <- seq.POSIXt(min_tp,max_tp,300)
seq_tp <- seq_tp[as.Date(seq_tp) != as.Date('2014-10-27') & as.Date(seq_tp) != as.Date('2015-05-07')]
uni_tp <- unique(smpIO$time)
if(length(seq_tp) == length(uni_tp)){
return(NULL)
}else{
svr_iocheck <- data.frame(timepoint = seq_tp,check = F)
svr_iocheck$check[svr_iocheck$timepoint %in% uni_tp] <- T
svr_iocheck_noexist <- subset(svr_iocheck,check == F)
return(c(unique(as.Date(svr_iocheck_noexist$timepoint))))
}
}
missing_svr <- data.frame(svrid = uni_sid,
sapply(uni_sid,missing_svr))
sid <- uni_sid[1]
cat(sprintf('sid: %s',sid))
smpIO <- subset(dt,svrid == sid)
missing_svr <- function(dt,sid){
cat(sprintf('sid: %s',sid))
smpIO <- subset(dt,svrid == sid)
max_tp <- max(smpIO$time)
min_tp <- min(smpIO$time)
seq_tp <- seq.POSIXt(min_tp,max_tp,300)
seq_tp <- seq_tp[as.Date(seq_tp) != as.Date('2014-10-27') & as.Date(seq_tp) != as.Date('2015-05-07')]
uni_tp <- unique(smpIO$time)
if(length(seq_tp) == length(uni_tp)){
return(NULL)
}else{
svr_iocheck <- data.frame(timepoint = seq_tp,check = F)
svr_iocheck$check[svr_iocheck$timepoint %in% uni_tp] <- T
svr_iocheck_noexist <- subset(svr_iocheck,check == F)
return(c(unique(as.Date(svr_iocheck_noexist$timepoint))))
}
}
sid
head(dt$svrid)
a <- subset(dt,svrid == levels(dt$svrid)[1])
b <- levels(dt$svrid)[1]
b
sid
smpIO <- subset(dt,svrid == sid)
smpIO <- subset(dt,svrid == levels(dt$svrid)[1])
sid
sid == levels(dt$svrid)[1]
smpIO <- subset(dt,svrid == sid)
sid = levels(dt$svrid)[1]
smpIO <- subset(dt,svrid == sid)
missing_svr <- function(dt,serverid){
cat(sprintf('sid: %s',serverid))
smpIO <- subset(dt,svrid == serverid)
max_tp <- max(smpIO$time)
min_tp <- min(smpIO$time)
seq_tp <- seq.POSIXt(min_tp,max_tp,300)
seq_tp <- seq_tp[as.Date(seq_tp) != as.Date('2014-10-27') & as.Date(seq_tp) != as.Date('2015-05-07')]
uni_tp <- unique(smpIO$time)
if(length(seq_tp) == length(uni_tp)){
return(NULL)
}else{
svr_iocheck <- data.frame(timepoint = seq_tp,check = F)
svr_iocheck$check[svr_iocheck$timepoint %in% uni_tp] <- T
svr_iocheck_noexist <- subset(svr_iocheck,check == F)
return(c(unique(as.Date(svr_iocheck_noexist$timepoint))))
}
}
missing_svr <- data.frame(svrid = uni_sid,
sapply(uni_sid,function(x)missing_svr(dt,x)))
serverid <- uni_sid[1]
cat(sprintf('sid: %s',serverid))
smpIO <- subset(dt,svrid == serverid)
max_tp <- max(smpIO$time)
min_tp <- min(smpIO$time)
seq_tp <- seq.POSIXt(min_tp,max_tp,300)
dt <- data
names(dt)[names(dt) == 'svr_id'] <- 'sid'
dt$time <- as.POSIXct(as.character(dt$date),tz = 'UTC',format = '%Y%m%d') + dt$timepoint*300
dt$svrid <- factor(merge_id_svrid$svrid[match(dt$sid,merge_id_svrid$sid)])
uni_sid <- levels(dt$svrid)[1:10]
missing_svr <- data.frame(svrid = uni_sid,
sapply(uni_sid,function(x)missing_svr(dt,x)))
uni_sid <- levels(dt$svrid)[1:3]
missing_svr <- function(dt,serverid){
cat(sprintf('sid: %s\n',serverid))
smpIO <- subset(dt,svrid == serverid)
max_tp <- max(smpIO$time)
min_tp <- min(smpIO$time)
seq_tp <- seq.POSIXt(min_tp,max_tp,300)
seq_tp <- seq_tp[as.Date(seq_tp) != as.Date('2014-10-27') & as.Date(seq_tp) != as.Date('2015-05-07')]
uni_tp <- unique(smpIO$time)
if(length(seq_tp) == length(uni_tp)){
return(NULL)
}else{
svr_iocheck <- data.frame(timepoint = seq_tp,check = F)
svr_iocheck$check[svr_iocheck$timepoint %in% uni_tp] <- T
svr_iocheck_noexist <- subset(svr_iocheck,check == F)
return(c(unique(as.Date(svr_iocheck_noexist$timepoint))))
}
}
missing_svr <- sapply(uni_sid,function(x)missing_svr(dt,x))
missing_svr <- function(dt,serverid){
cat(sprintf('sid: %s\n',serverid))
smpIO <- subset(dt,svrid == serverid)
max_tp <- max(smpIO$time)
min_tp <- min(smpIO$time)
seq_tp <- seq.POSIXt(min_tp,max_tp,300)
seq_tp <- seq_tp[as.Date(seq_tp) != as.Date('2014-10-27') & as.Date(seq_tp) != as.Date('2015-05-07')]
uni_tp <- unique(smpIO$time)
if(length(seq_tp) == length(uni_tp)){
return(NULL)
}else{
svr_iocheck <- data.frame(timepoint = seq_tp,check = F)
svr_iocheck$check[svr_iocheck$timepoint %in% uni_tp] <- T
svr_iocheck_noexist <- subset(svr_iocheck,check == F)
return(c(unique(as.Date(svr_iocheck_noexist$timepoint))))
}
}
missing_date <- function(i){
load(file.path(dir_iops,fname[i]))
dt <- data
names(dt)[names(dt) == 'svr_id'] <- 'sid'
dt$time <- as.POSIXct(as.character(dt$date),tz = 'UTC',format = '%Y%m%d') + dt$timepoint*300
dt$svrid <- factor(merge_id_svrid$svrid[match(dt$sid,merge_id_svrid$sid)])
uni_sid <- levels(dt$svrid)
missing_svr <- sapply(uni_sid,function(x)missing_svr(dt,x))
}
fname <- list.files(dir_iops)
require(doParallel)
idx <- seq_len(length(fname))
ck <- makeCluster(min(40,length(idx)),type = 'FORK',outfile = 'out_frif')
registerDoParallel(ck)
r <- foreach(i = idx,.verbose = F) %dopar% {
missing_date(i)
}
stopCluster(ck)
save(r,file = file.path(dir_data,'missing_date.Rda'))
idx
a <- r[[1]]
b <- unlist(a)
c <- melt(table(b))
View(c)
b[1]
c <- melt(table(as.Date(b,origin = '1970-01-01'))
)
sta_r <- sapply(r,unlist)
sta_r <- unlist(sapply(r,unlist))
head(sta_r)
sta_r <- unlist(unlist(r))
sta_r <- as.Date(unlist(unlist(r)),origin = '1970-01-01')
head(sta_r)
sta_r <- melt(table(as.Date(unlist(unlist(r)),origin = '1970-01-01'))
)
View(sta_r)
names(sta_r) <- c('date','missing_svr')
ggplot(sta_r,aes(x = date,y = missing_svr)) + geom_bar(stat = 'identity')
ggplot(sta_r,aes(x = date,y = sort(missing_svr))) + geom_bar(stat = 'identity')
ggplot(sta_r,aes(x = date,y = missing_svr)) + geom_bar(stat = 'identity')
mean(sta_r$missing_svr[sta_r$missing_svr < 1000])
length(unique(name(unlist(unlist(r)))))
length(unique(names(unlist(unlist(r)))))
a <- unlist(unlist(r))
head(names(a))
b <- unique(names(a))
head(a)
head(a,100)
22595/530
22595/365
